setlocal
chcp 437
chdir >> set=script
REM
color 2f

echo ********************************************************************  >> ..\%COMPUTERNAME%-result.txt
echo *                          Windows PC Checklist                            * >> ..\%COMPUTERNAME%-result.txt
echo ******************************************************************** >> ..\%COMPUTERNAME%-result.txt
echo Window Checking ======================================================== > ..\%COMPUTERNAME%-result.txt
echo ======== start time ========================================================= > ..\%COMPUTERNAME%-result.txt
date /t  >> ..\%COMPUTERNAME%-result.txt
time /t >> ..\%COMPUTERNAME%-result.txt
echo ============================================================================= >> ..\%COMPUTERNAME%-result.txt

echo ======== ipconfig /all ====================================================== >> ..\%COMPUTERNAME%-result.txt
ipconfig /all >> ..\%COMPUTERNAME%-result.txt
echo ============================================================================= >> ..\%COMPUTERNAME%-result.txt

echo ======== systeminfo ========================================================= >> ..\%COMPUTERNAME%-result.txt
psinfo >> ..\%COMPUTERNAME%-result.txt
echo ============================================================================= >> ..\%COMPUTERNAME%-result.txt

echo ======== netstat -an ======================================================== >> ..\%COMPUTERNAME%-result.txt
c:\windows\system32\netstat -an >> ..\%COMPUTERNAME%-result.txt
echo ============================================================================= >> ..\%COMPUTERNAME%-result.txt

echo ======== net start ======================================================== >> ..\%COMPUTERNAME%-result.txt
net start >> ..\%COMPUTERNAME%-result.txt
echo ============================================================================= >> ..\%COMPUTERNAME%-result.txt


echo ======== net start ======================================================== >> ..\%COMPUTERNAME%-result.txt
xp32-systeminfo >> ..\%COMPUTERNAME%-result.txt
xp32-systeminfo > systeminfo.txt   
echo ============================================================================= >> ..\%COMPUTERNAME%-result.txt

psservice > ..\%COMPUTERNAME%-Service-result.txt


type systeminfo.txt | find /i "x64-based" 

if NOT ERRORLEVEL 1 goto x64-based




echo ############################################################################################# >> ..\%COMPUTERNAME%-result.txt
echo ###################																			>> ..\%COMPUTERNAME%-result.txt
echo  ###################           windows 32bit   check                      						>> ..\%COMPUTERNAME%-result.txt
echo ####################																			>> ..\%COMPUTERNAME%-result.txt
echo #############################################################################################  >> ..\%COMPUTERNAME%-result.txt



echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
chcp 949



echo [PC-1] 패스워드의 주기적 변경 ========================================== >> ..\%COMPUTERNAME%-result.txt
echo "# net accounts | find /i "최대 암호""                                  >> ..\%COMPUTERNAME%-result.txt
echo "# net user"                                                              >> ..\%COMPUTERNAME%-result.txt
net accounts                                        >> ..\%COMPUTERNAME%-result.txt


net user   > user.txt
type user.txt | find /V "--" | find /V "실행했습니다." | find /V "사용자 계정" > usercheck.txt 
REM FOR /F "tokens=1" %%a in (user2.txt) do SET pc_TEMP=%%a



net accounts | find "Maximum password"							     >> ..\%COMPUTERNAME%-result.txt                                         
echo [PC-1] END                                                              >> ..\%COMPUTERNAME%-result.txt
echo [PC-1] 수동                                                             >> ..\%COMPUTERNAME%-result.txt

echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt

FOR /F "tokens=1" %%a IN (usercheck.txt) DO net user %%a | find /V "전체 이름" | find /V "설명" | find /V "사용자 설명" | find /V "국가 코드" | find /V "워크스테이션" | find /V "스크립트" | find /V "프로필" | find /V "디렉터리" | find /V "실행했습니다" | find /V "구성원" | find /V "허용된"  >> ..\%COMPUTERNAME%-result.txt    
FOR /F "tokens=2" %%b IN (usercheck.txt) DO net user %%b | find /V "전체 이름" | find /V "설명" | find /V "사용자 설명" | find /V "국가 코드" | find /V "워크스테이션" | find /V "스크립트" | find /V "프로필" | find /V "디렉터리" | find /V "실행했습니다" | find /V "구성원" | find /V "허용된"  >> ..\%COMPUTERNAME%-result.txt    
FOR /F "tokens=3" %%c IN (usercheck.txt) DO net user %%c | find /V "전체 이름" | find /V "설명" | find /V "사용자 설명" | find /V "국가 코드" | find /V "워크스테이션" | find /V "스크립트" | find /V "프로필" | find /V "디렉터리" | find /V "실행했습니다" | find /V "구성원" | find /V "허용된"  >> ..\%COMPUTERNAME%-result.txt    
FOR /F "tokens=4" %%d IN (usercheck.txt) DO net user %%d | find /V "전체 이름" | find /V "설명" | find /V "사용자 설명" | find /V "국가 코드" | find /V "워크스테이션" | find /V "스크립트" | find /V "프로필" | find /V "디렉터리" | find /V "실행했습니다" | find /V "구성원" | find /V "허용된"  >> ..\%COMPUTERNAME%-result.txt    
FOR /F "tokens=5" %%e IN (usercheck.txt) DO net user %%e | find /V "전체 이름" | find /V "설명" | find /V "사용자 설명" | find /V "국가 코드" | find /V "워크스테이션" | find /V "스크립트" | find /V "프로필" | find /V "디렉터리" | find /V "실행했습니다" | find /V "구성원" | find /V "허용된"  >> ..\%COMPUTERNAME%-result.txt    

chcp 437

del usercheck.txt

echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo 패스워드의 주기적 변경                                                               >> ..\%COMPUTERNAME%-result.txt
echo 최대 패스워드 사용일이 설정되어있다면 양호                                                   >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo.                                              >> ..\%COMPUTERNAME%-result.txt
echo.                                       
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt

REM 32-PC-2
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-2] 패스워드 정책이 해당기관의 보안정책에 적합하게 설정 ================= >> ..\%COMPUTERNAME%-result.txt
echo "# net accounts > net-accounts.txt"                                           >> ..\%COMPUTERNAME%-result.txt
echo "# type net-accounts.txt | find "length""                                     >> ..\%COMPUTERNAME%-result.txt
net accounts > net-accounts.txt  
type net-accounts.txt | find "length"						     > length.txt
FOR /F "tokens=4" %%k in (length.txt) do SET pc_TEMP=%%k

IF %pc_TEMP% GEQ 8 GOTO length-SETTING-OK

echo 패스워드 최소 암호길이기 8자리 미만으로 설정되어 있어 취약함                            >> ..\%COMPUTERNAME%-result.txt
net accounts | find "length" 						                                         >> ..\%COMPUTERNAME%-result.txt
echo [PC-2] END                                                                               >> ..\%COMPUTERNAME%-result.txt
echo [PC-2] 취약								                     >> ..\%COMPUTERNAME%-result.txt
goto length-end
:length-SETTING-OK
     
echo 패스워드 최소 암호길이가 8자리 이상으로 설정되어있어  양호함   >> ..\%COMPUTERNAME%-result.txt
net accounts | find "length"							     >> ..\%COMPUTERNAME%-result.txt
echo [PC-2] END                                                                               >> ..\%COMPUTERNAME%-result.txt
echo [PC-2] 양호                                                                               >> ..\%COMPUTERNAME%-result.txt

	   
	   
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
:length-end
set pc_TEMP=
del length.txt
del net-accounts.txt






echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo.                                              >> ..\%COMPUTERNAME%-result.txt
echo.                                                  >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt




REM 32-PC-3
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-3] 복구 콘솔에서 자동 로그온을 금지하도록 설정하여 사용하고 있는가? ================= >> ..\%COMPUTERNAME%-result.txt
echo "# HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Setup\RecoveryConsole | find /i "SecurityLevel""  >> ..\%COMPUTERNAME%-result.txt
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Setup\RecoveryConsole" | find /i "SecurityLevel" > SecurityLevel.txt 


type SecurityLevel.txt | find "1" 

IF ERRORLEVEL 1 ECHO 복구 콘솔에서 자동 로그온을 금지하도록 설정되어있어 양호함                                                            >> ..\%COMPUTERNAME%-result.txt
IF NOT ERRORLEVEL 1 ECHO 복구 콘솔에서 자동 로그온을 허용하고 있어 취약함                                                                         >> ..\%COMPUTERNAME%-result.txt

type SecurityLevel.txt                                                       >> ..\%COMPUTERNAME%-result.txt

echo [PC-3] END                                                              >> ..\%COMPUTERNAME%-result.txt
type SecurityLevel.txt | find "1"                                                       
IF ERRORLEVEL 1 ECHO [PC-3] 양호                                                           >> ..\%COMPUTERNAME%-result.txt
IF NOT ERRORLEVEL 1 ECHO [PC-3] 취약                                                             >> ..\%COMPUTERNAME%-result.txt



del SecurityLevel.txt


echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo 윈도우 XP CD부팅하여 복구시에도 적용됨                                   >> ..\%COMPUTERNAME%-result.txt
echo 윈도우 7 CD부팅하여 복구시에는 적용안됨(내부 복구콘솔만 해당)                 >> ..\%COMPUTERNAME%-result.txt
echo SecurityLevel = 0 (복구콘솔 관리자 자동 로그온 사용안함) -양호                               >> ..\%COMPUTERNAME%-result.txt
echo SecurityLevel = 1 (복구콘솔 관리자 자동 로그온 사용함) - 취약                                 >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo.                                              >> ..\%COMPUTERNAME%-result.txt
echo.                                                  >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt








REM 32-PC-4
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-4] 공유폴더 제거                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo "# net share"                                                                           >> ..\%COMPUTERNAME%-result.txt
echo 파일 공유 서비스인 server 구동상태 체크                                                          >> ..\%COMPUTERNAME%-result.txt
net start | findstr /v "A B C D E F G H I J K L M N O P Q R T U V W X Y Z a b c d f g h i j k l m n o p q t u w x y z" | findstr "Server"     >> ..\%COMPUTERNAME%-result.txt

net start | findstr /v "A B C D E F G H I J K L M N O P Q R T U V W X Y Z a b c d f g h i j k l m n o p q t u w x y z" | findstr "Server"

IF ERRORLEVEL 1 GOTO netshare-04 




echo. 불필요한 공유폴더 확인                                                                                       >> ..\%COMPUTERNAME%-result.txt
net share                                                                                >> ..\%COMPUTERNAME%-result.txt
echo [PC-4] END                                                                       >> ..\%COMPUTERNAME%-result.txt
echo [PC-4] 수동                                                                       >> ..\%COMPUTERNAME%-result.txt

net share   | FIND /i "c:\"                       > PC-4-netsharelist.txt  
net share  | FIND /i "d:\"                       >> PC-4-netsharelist.txt  
net share  | FIND /i "e:\"                       >> PC-4-netsharelist.txt  
net share   | FIND /i "f:\"                       >> PC-4-netsharelist.txt 
net share  | FIND /i "g:\"                       >> PC-4-netsharelist.txt 
net share  | FIND /i "h:\"                       >> PC-4-netsharelist.txt 
net share   | FIND /i "i:\"                       >> PC-4-netsharelist.txt 

FOR /F "tokens=1" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                                 >   PC-4-netsharelist2.txt 
FOR /F "tokens=2" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                                 >>  PC-4-netsharelist2.txt
FOR /F "tokens=3" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                                 >>  PC-4-netsharelist2.txt
FOR /F "tokens=4" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                                 >>  PC-4-netsharelist2.txt
FOR /F "tokens=5" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                                 >>  PC-4-netsharelist2.txt
FOR /F "tokens=6" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                                 >>  PC-4-netsharelist2.txt
FOR /F "tokens=7" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                                 >>  PC-4-netsharelist2.txt



FOR /F "tokens=1" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                         >> ..\%COMPUTERNAME%-result.txt
FOR /F "tokens=2" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                         >> ..\%COMPUTERNAME%-result.txt
FOR /F "tokens=3" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                         >> ..\%COMPUTERNAME%-result.txt
FOR /F "tokens=4" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                         >> ..\%COMPUTERNAME%-result.txt
FOR /F "tokens=5" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                         >> ..\%COMPUTERNAME%-result.txt
FOR /F "tokens=6" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                         >> ..\%COMPUTERNAME%-result.txt
FOR /F "tokens=7" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                         >> ..\%COMPUTERNAME%-result.txt

goto netshare-04-end

:netshare-04

echo "Server" 공유 서비스가 구동하지 않으므로 양호함 										>> ..\%COMPUTERNAME%-result.txt
echo [PC-4] END                                                                             >> ..\%COMPUTERNAME%-result.txt
echo [PC-4] 양호                                                                            >> ..\%COMPUTERNAME%-result.txt


:netshare-04-end





del PC-4-netsharelist.txt
del PC-4-netsharelist2.txt



echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo 공유폴더 제거                                             >> ..\%COMPUTERNAME%-result.txt
echo $표시된 기본 공유폴더가 존재하면 취약 그외 공유폴더 사용유무 및 공유폴더 권한 여부에 따라 판단            >> ..\%COMPUTERNAME%-result.txt
echo 공유디렉토리에 Everyone 계정 권한 확인(Everyone 그룹이 존재한다면 모든사용자 접속가능) >> ..\%COMPUTERNAME%-result.txt
echo 그외 불필요 사용자가 모든권한(F) 및 Write 권한이 있다면 판단후 취약          >> ..\%COMPUTERNAME%-result.txt
echo 양호 = Everyone 사용자 삭제, 사용자(Users그룹사용자)의 권한에 쓰기권한 거부                    >> ..\%COMPUTERNAME%-result.txt
echo 취약 = Everyone 사용자 존재, 사용자(Users그룹사용자)의 권한에 쓰기권한 허용                    >> ..\%COMPUTERNAME%-result.txt
echo 사용자 계정에 쓰기권한(F) 혹은 FILE_WRITE_DATA권한 존재한다면 취약             >> ..\%COMPUTERNAME%-result.txt
echo 서비스중 server 서비스를 중지시켯다면 공유기능을 사용하지 않기때문에 양호함       >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt



REM 32-PC-5
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-5] 불필요한 서비스 제거                                                             >> ..\%COMPUTERNAME%-result.txt
echo -----불필요 규정 서비스 구동중인 항목-------                                           >> ..\%COMPUTERNAME%-result.txt
net start | find "Alerter"                                             >> ..\%COMPUTERNAME%-result.txt
net start | find "Clipbook"                                             >> ..\%COMPUTERNAME%-result.txt
net start | find "Computer Browser"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "DHCP Client"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "FTP Publishing Service"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Internet Connection Sharing ICS"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Indexing Service"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Windows Firewall/Internet Connection Sharing"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Infared Monitor Service"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Fast User Switching Compatibility"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Messenger"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "NetLogon"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Network DDE"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Network DDE DSDM"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Netmeeting Remote Desktop Sharing"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Print spooler"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Remote Registry"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Routing and Remote Access"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Simple TCP/IP Service"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Simple Mail Transport Protocol"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Task Scheduler"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "TCP/IP NetBIOS Helper"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Terminal Services"                                 >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt


echo "#net start"                                                       >> ..\%COMPUTERNAME%-result.txt
net start                                                                >> ..\%COMPUTERNAME%-result.txt


echo [PC-5] END                                                                              >> ..\%COMPUTERNAME%-result.txt
echo [PC-5] 수동                                                                             >> ..\%COMPUTERNAME%-result.txt




echo.                                       
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo 불필요한 서비스 제거                                                                >> ..\%COMPUTERNAME%-result.txt
echo. Alerter(xp) 초기값(disable) = 서버에서 클라이언트로 경고메세지를 보냄                         >> ..\%COMPUTERNAME%-result.txt
echo. Clipbook(xp만존재) = 클립보드 공유 서비스                                             >> ..\%COMPUTERNAME%-result.txt
echo. Computer Browser(모든OS 존재) = 네트워크에 있는 모든 컴퓨터 목록을 갱신하고 관리하며 이 목록을 브라우저로 지정된 컴퓨터에 제공하는 서비스                               >> ..\%COMPUTERNAME%-result.txt
echo. 종료할경우 네트워크환경의 다른사용자와의 리스트가 보이지 않음                              >> ..\%COMPUTERNAME%-result.txt
echo. DHCP Client(모든OS 존재) = 자동으로 IP를 할당받는 DHCP서비스를 이용하기위해 사용됨   >> ..\%COMPUTERNAME%-result.txt
echo. FTP Publishing Service(설치시존재) = ftp 서버를 구동하는 서비스                                   >> ..\%COMPUTERNAME%-result.txt
echo. Internet Connection Sharing ICS(모든OS) = 홈 네트워크 또는 소규모 네트워크에 네트워크 주소 변환, 주소 지정, 이름 확인 및/또는 침입 방지 서비스를 제공하는 서비스    >> ..\%COMPUTERNAME%-result.txt
echo. xp에서는 sharing 서비스를 중지할시 방화벽이 구동안됨                                           >> ..\%COMPUTERNAME%-result.txt
echo. Indexing Service(win7이상) = 로컬 및 원격 컴퓨터에 있는 파일의 내용 및 속성을 인덱싱합니다. 융통성 있는 쿼리 언어를 통해 파일을 빠르게 액세스할 수 있습니다.
echo. Windows Firewall/Internet Connection Sharing(winxp) = 위와동일하나 중지시 방화벽 동작안함        >> ..\%COMPUTERNAME%-result.txt
echo. Infared Monitor Service(설치시 존재)= 
echo. Fast User Switching Compatibility(xp만존재) = 여러 사람이 공동으로 사용하는 컴퓨터에서 컴퓨터를 이용하던 이용자가 로그오프하지 않은 채 다른 사용자가 로그온하여 컴퓨터를 사용할 수 있게 한다.      >> ..\%COMPUTERNAME%-result.txt
echo. Messenger(xp만존재) = 네트워크상에서 메시지를 전달하는 기능을 하는 서비스로써, 성인광고 등의 스팸메시지가 이 서비스를 통해 보내어진다.                              >> ..\%COMPUTERNAME%-result.txt
echo. NetLogon(모든 OS) = 사용자 및 서비스를 인증하기 위해 이 컴퓨터와 도메인 컨트롤러 사이에 보안된 채널을 유지합니다. 이 서비스가 중지되면 컴퓨터에서 사용자 및 서비스를 인증할 수 없고 도메인 컨트롤러에서 DNS 레코드를 등록할 수 없게 됨. >> ..\%COMPUTERNAME%-result.txt
echo. 이 서비스가 사용할 수 없게 설정되면 이 서비스에 종속성이 있는 모든 서비스는 시작할 수 없게 됨  >> ..\%COMPUTERNAME%-result.txt
echo. Network DDE(winxp) = 동일한 컴퓨터나 다른 컴퓨터에서 실행되는 프로그램의 DDE에 대한 네트워크 전송 및 보안을 제공함, 서비스를 중지하면, DDE 전송 및 보안을 사용할 수 없음                       >> ..\%COMPUTERNAME%-result.txt
echo. Network DDE DSDM(winxp) = 동적 DDE 네트워크 공유를 관리. 서비스를 중지하면, DDE 네트워크 공유를 사용할 수 없음. 서비스를 사용하지 않도록 설정하면, 관련된 모든 서비스를 사용할 수 없음   >> ..\%COMPUTERNAME%-result.txt
echo. Netmeeting Remote Desktop Sharing(xp만 존재) = 자신의 컴퓨터에 원격으로 접근할 수 있도록 허용하고 다른 컴퓨터와 바탕 화면 원격 공유를 사용할 수 있게 하는 서비스                               >> ..\%COMPUTERNAME%-result.txt
echo. Print spooler(모든OS) = 나중에 인쇄할 수 있도록 파일을 메모리에 로드                                                      >> ..\%COMPUTERNAME%-result.txt
echo. Remote Registry(모든os) = 원격 사용자가 이 컴퓨터에서 레지스트리 설정을 수정할 수 있도록 설정합니다. 서비스를 중지하면, 이 컴퓨터의 사용자만이 레지스트리를 수정할 수 있습니다. 서비스를 사용하지 않도록 설정하면, 관련된 모든 서비스를 사용할 수 없음 >> ..\%COMPUTERNAME%-result.txt
echo. Routing and Remote Access(모든os) = 로컬 영역 및 광역 네트워크 환경에 있는 사업체에 라우팅 서비스를 제공함              >> ..\%COMPUTERNAME%-result.txt
echo. Simple TCP/IP Service(설치시 존재) = Echo, Discard, Character Generator, Daytime, Quote of the Day 사용함                 >> ..\%COMPUTERNAME%-result.txt
echo. Simple Mail Transport Protocol (SMTP)(설치시 존재) =  
echo. Task Scheduler = 예약된 작업을 실행하는 서비스      >> ..\%COMPUTERNAME%-result.txt
echo. TCP/IP NetBIOS Helper = 사용자가 파일을 인쇄, 공유, 로그인할때 사용함                      >> ..\%COMPUTERNAME%-result.txt
echo. Terminal Services(xp) = 원격 컴퓨터의 데스크톱 디스플레이와 응용 프로그램에 연결할 수 있을 뿐만 아니라 여러 사용자가 한 컴퓨터에 대화형으로 연결할 수 있게 해줌 원격 데스크톱(관리자용 RD 포함), 빠른 사용자 전환, 원격 지원 및 터미널 서버의 기초가 됨        >> ..\%COMPUTERNAME%-result.txt
echo. 유의사항 = 검색어에 해당 단어를 포함하는 서비스가 있을경우 오탐가능성있으니 확인 요망 .                            >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt





REM 32-PC-6
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-6] Windows Messenger(MSN, .NET 메신저 등)와 같은 상용 메신저의 사용 금지  >> ..\%COMPUTERNAME%-result.txt
echo "# HKLM\SOFTWARE\Policies\Microsoft\Messenger\Client | find "PreventRun""         >> ..\%COMPUTERNAME%-result.txt
reg query "HKLM\SOFTWARE\Policies\Microsoft\Messenger\Client" | find "PreventRun" > Messenger-check.txt

type Messenger-check.txt | find "1"

IF NOT ERRORLEVEL 1 ECHO Windows Messenger 를 실행하지 않음으로 설정하여 양호         >> ..\%COMPUTERNAME%-result.txt
IF ERRORLEVEL 1 ECHO Windows Messenger 를 통제하지 않으므로 취약함                           >> ..\%COMPUTERNAME%-result.txt
type Messenger-check.txt | find /i "PreventRun"                                                                    >> ..\%COMPUTERNAME%-result.txt


echo [PC-6] END                                                                              >> ..\%COMPUTERNAME%-result.txt

type Messenger-check.txt | find "1"
IF NOT ERRORLEVEL 1 ECHO [PC-6] 양호                                                           >> ..\%COMPUTERNAME%-result.txt
IF ERRORLEVEL 1 ECHO [PC-6] 취약                                                             >> ..\%COMPUTERNAME%-result.txt



del Messenger-check.txt


echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                           >> ..\%COMPUTERNAME%-result.txt
echo Windows Messenger(MSN, .NET 메신저 등)와 같은 상용 메신저의 사용 금지                   >> ..\%COMPUTERNAME%-result.txt
echo windows 7이상 = 정책과 상관없이 메신져 Default 설치되지 않음                            >> ..\%COMPUTERNAME%-result.txt
echo windows xp    = 버전에 따라 디폴트로 메신져가 탑재되는 OS가 존재하나 구분할수없으므로 전부 정책 반영   >> ..\%COMPUTERNAME%-result.txt
echo PreventRun = 0 (Windows Messnger 사용금지기능 사용안함) - 취약                          >> ..\%COMPUTERNAME%-result.txt
echo PreventRun = 1 (Windows Messnger 사용금지기능 사용함) - 양호                            >> ..\%COMPUTERNAME%-result.txt
echo 레지스트리값 없음 = 취약(값이 없으면 해당없음 으로 체크됨)                               >> ..\%COMPUTERNAME%-result.txt
echo 해당 항목이 나온 취지는 다음과 같다. Windows패키지중 K 버전과 KN 버전이 존재한다.       >> ..\%COMPUTERNAME%-result.txt
echo K버전은 윈도우 미디어플레이 및 윈도우 메신져가 포함된 버전이었지만 국내에서 불공정      >> ..\%COMPUTERNAME%-result.txt
echo 거래로 판매를 금지하여 KN버전은 이렇한 프로그램들이 포함되지 않은 버전이다.              >> ..\%COMPUTERNAME%-result.txt
echo 즉 windows xp 에서는 이렇한 윈도우 메신져 프로그램이 기본적으로 설치되어 구동하며       >> ..\%COMPUTERNAME%-result.txt
echo 프로그램 추가/제거로 지울수도 없다. 즉 OS에 기본적으로 내장된 윈도우 메신져를 막기위한   >> ..\%COMPUTERNAME%-result.txt
echo 방안으로 탄생된 항목이다. windows 7 에서는 메신져가 설치되지 않으므로  해당설정을      >> ..\%COMPUTERNAME%-result.txt
echo 하지 않아도 양호로 판단하며 xp 에서만 해당 조취를 취하면 된다.  win7은 메신져가 포함되지 않음 >> ..\%COMPUTERNAME%-result.txt
echo 상용메신져는 수동으로 확인                                                                  >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt




REM 32-PC-7
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-7] 파일 시스템이 NTFS 포맷으로 되어 있는가?                                     >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo "# cacls c:\ | find "(OI)""                                                              >> ..\%COMPUTERNAME%-result.txt
cacls c:\ | find "(OI)" >nul 
IF NOT ERRORLEVEL 1 ECHO ntfs 파일시스템을 사용함으로 양호함                                                            >> ..\%COMPUTERNAME%-result.txt
IF ERRORLEVEL 1 ECHO ntfs 파일시스템을 사용하지 않으므로 취약함                                                              >> ..\%COMPUTERNAME%-result.txt
cacls c:\                      				                                     >> ..\%COMPUTERNAME%-result.txt
echo [PC-7] END                                                                              >> ..\%COMPUTERNAME%-result.txt
cacls c:\ | find "(OI)" >nul    
IF NOT ERRORLEVEL 1 ECHO [PC-7] 양호                                                           >> ..\%COMPUTERNAME%-result.txt
IF ERRORLEVEL 1 ECHO [PC-7] 취약                                                             >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt


echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo 파일 및 디렉토리 보호                                               >> ..\%COMPUTERNAME%-result.txt
echo cacls 명령어의 OI권한은 ntfs만 존재함으로                  >> ..\%COMPUTERNAME%-result.txt
echo OI권한이 있으면 양호 없으면 취약                                            >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt



REM ###############################8번 항목 8-분기점 ###################################################################

type systeminfo.txt | find /i "windows xp" 


IF NOT ERRORLEVEL 1 goto 32-bit-xp-8-check 

type systeminfo.txt | find /i "windows 7"

IF NOT ERRORLEVEL 1 goto 32-bit-win7-8-check



REM 32-PC-8-WIN7
:32-bit-win7-8-check


echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-8] 대상 시스템이 windows 서버를 제외한 다른 OS로 멀티 부팅이 가능하지 않도록 설정하여 사용하는가?  >> ..\%COMPUTERNAME%-result.txt
echo "# bcdedit"                                                                                               >> ..\%COMPUTERNAME%-result.txt
bcdedit                                                                                       >> ..\%COMPUTERNAME%-result.txt
echo [PC-8] END                                                                              >> ..\%COMPUTERNAME%-result.txt
echo.[PC-8] 수동                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt


echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo                                                >> ..\%COMPUTERNAME%-result.txt
echo                   >> ..\%COMPUTERNAME%-result.txt
echo                                             >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt




goto 32-bit-8-check-end 



:32-bit-xp-8-check 


REM 32-PC-8-XP
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-8] 대상 시스템이 windows 서버를 제외한 다른 OS로 멀티 부팅이 가능하지 않도록 설정하여 사용하는가?  >> ..\%COMPUTERNAME%-result.txt
echo "# more c:\boot.ini"                                                                               >> ..\%COMPUTERNAME%-result.txt
more c:\boot.ini                                                                                         >> ..\%COMPUTERNAME%-result.txt
echo [PC-8] END                                                                              >> ..\%COMPUTERNAME%-result.txt
echo.[PC-8] 수동                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt


echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo                                                >> ..\%COMPUTERNAME%-result.txt
echo                   >> ..\%COMPUTERNAME%-result.txt
echo                                             >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt




:32-bit-8-check-end 






REM 32-PC-9
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-9] 브라우저 종료 시 임시 인터넷 파일 폴더의 내용을 삭제하도록 설정하여 사용하는가?  >> ..\%COMPUTERNAME%-result.txt
echo "# HKLM\SOFTWARE\Policies\Microsoft\Windows\CurrentVersion\Internet Settings\Cache | find /i "Persistent""   >> ..\%COMPUTERNAME%-result.txt
reg query "HKLM\SOFTWARE\Policies\Microsoft\Windows\CurrentVersion\Internet Settings\Cache" | find /i "Persistent" > internet.txt

type internet.txt | find "x0" 


IF NOT ERRORLEVEL 1 echo 브라우저 종료 시 임시 인터넷 파일 폴더내용 삭제하도록 설정되어있어 양호함    >> ..\%COMPUTERNAME%-result.txt
IF ERRORLEVEL 1 echo 브라우저 종료 시 임시 인터넷 파일 폴더내용을 삭제하지 않도록 설정되어있어 취약함    >> ..\%COMPUTERNAME%-result.txt

type internet.txt  >> ..\%COMPUTERNAME%-result.txt


echo [PC-9] END                                                                                           >> ..\%COMPUTERNAME%-result.txt
type internet.txt | find "x0" 
IF NOT ERRORLEVEL 1 echo [PC-9] 양호    >> ..\%COMPUTERNAME%-result.txt
IF ERRORLEVEL 1 echo [PC-9] 취약    >> ..\%COMPUTERNAME%-result.txt



echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                           >> ..\%COMPUTERNAME%-result.txt
echo 브라우저 종료 시 임시 인터넷 파일 폴더의 내용을 삭제하도록 설정하여 사용하는가?         >> ..\%COMPUTERNAME%-result.txt                                       >> ..\%COMPUTERNAME%-result.txt
echo Persistent = 0x0 (사용함) - 양호                                                        >> ..\%COMPUTERNAME%-result.txt
echo Persistent = 0x1 (사용안함) - 취약                                                      >> ..\%COMPUTERNAME%-result.txt
echo 레지스트리값 = 없음 (구성되지 않음) - 취약                                              >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt



REM 32-PC-10
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-10] HOT FIX 등 최신 보안패치 적용                                                   >> ..\%COMPUTERNAME%-result.txt
echo 최신보안패치 및 Hotfix 적용 점검                                  >> ..\%COMPUTERNAME%-result.txt
                                           
                                          
echo "# wmic"                                                                          >> ..\%COMPUTERNAME%-result.txt
wmic QFE Get HotFixID,InstalledOn | find " "                                                         >> ..\%COMPUTERNAME%-result.txt
echo [PC-10] END  >> ..\%COMPUTERNAME%-result.txt
echo [PC-10] 수동   >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.   






REM 32-PC-11
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-11] 최신 서비스팩 적용                                                   >> ..\%COMPUTERNAME%-result.txt
echo 최신서비스팩 적용점검                                >> ..\%COMPUTERNAME%-result.txt
                                           
						   
echo "# type systeminfo.txt | find /i "os name"" 			 >> ..\%COMPUTERNAME%-result.txt  
echo "# type systeminfo.txt | find /i "version" | find /V "BIOS"" 	>> ..\%COMPUTERNAME%-result.txt						   
										   
type systeminfo.txt | find /i "os name" 				    >> ..\%COMPUTERNAME%-result.txt    						   
type systeminfo.txt | find /i "version" | find /V "BIOS"  >> ..\%COMPUTERNAME%-result.txt

echo [PC-11] END  >> ..\%COMPUTERNAME%-result.txt
echo [PC-11] 수동   >> ..\%COMPUTERNAME%-result.txt


echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo 서비스팩 및 Hotfix 적용 점검                                                                       >> ..\%COMPUTERNAME%-result.txt
echo HOTFIX 수량 및 최신 핫픽스 체크       >> ..\%COMPUTERNAME%-result.txt
echo                                     >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt




REM 32-PC-12
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-12] MS-Office, 구글, 어도브 아크로뱃 등의 응용 프로그램에 대한 최신 보안 패치 및 벤더 권고사항 적용            >> ..\%COMPUTERNAME%-result.txt
echo --한글2007 체크--                  >> ..\%COMPUTERNAME%-result.txt
echo "# HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\HNC\Shared\HncUpdate" | find "LastUpdate""                              >> ..\%COMPUTERNAME%-result.txt
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\HNC\Shared\HncUpdate" | find "LastUpdate" > hwp2007.txt 
type hwp2007.txt  >> ..\%COMPUTERNAME%-result.txt


echo -- 오피스 체크 (윈도우 자동업데이트 항목) --    >> ..\%COMPUTERNAME%-result.txt                                         

reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update" | find "AUOptions" > autoupdate.txt

type autoupdate.txt   >> ..\%COMPUTERNAME%-result.txt
										   

echo [PC-12] END  >> ..\%COMPUTERNAME%-result.txt
echo [PC-12] 수동   >> ..\%COMPUTERNAME%-result.txt


echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo MS-Office, 구글, 어도브 아크로뱃 등의 응용 프로그램에 대한 최신 보안 패치 및 벤더 권고사항 적용                                                                      >> ..\%COMPUTERNAME%-result.txt
echo 한글2007 = 16진수값(0x를 제외한)을 10진수로 변환하면 마지막 업데이트 날짜 확인        >> ..\%COMPUTERNAME%-result.txt
echo 오피스군 = 윈도우 자동업데이트시 오피스군도 포함됨(아래 참조)                                      >> ..\%COMPUTERNAME%-result.txt
echo AUOptions = 1 (업데이트를 확인하지 않음(권장하지 않음)                                                                        >> ..\%COMPUTERNAME%-result.txt
echo AUOptions = 2 (업데이트를 확인하지만 다운로드 및 설치 여부는 직접 선택)                                                                       >> ..\%COMPUTERNAME%-result.txt
echo AUOptions = 3 (업데이트를 다운로드하지만 설치 여부는 직접 선택)                        >> ..\%COMPUTERNAME%-result.txt
echo AUOptions = 4 (업데이트 자동설치(권장)                                                                       >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt






chcp 949

REM 32-PC-13
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-13] 바이러스 백신 프로그램 설치 및 주기적 업데이트	                                                             >> ..\%COMPUTERNAME%-result.txt
echo "# net start | findstr /i "v3 ahnlab""                                          >> ..\%COMPUTERNAME%-result.txt
echo "# net start | findstr /i "alyac""                                              >> ..\%COMPUTERNAME%-result.txt
echo "# net start | find /i "virobot""                                                >> ..\%COMPUTERNAME%-result.txt
echo "# net start | find /i "norton""                                            >> ..\%COMPUTERNAME%-result.txt
echo. 수동진단(net start 결과확인)                 
echo -----안렙 v3 체크 -------                                                                   >> ..\%COMPUTERNAME%-result.txt
echo 구동여부 체크                                                     >> ..\%COMPUTERNAME%-result.txt
echo -----------------------------------                                 >> ..\%COMPUTERNAME%-result.txt
net start | findstr /i "v3 ahnlab"                                      >> ..\%COMPUTERNAME%-result.txt
echo -----------------------------------                               >> ..\%COMPUTERNAME%-result.txt
reg query "HKLM\SOFTWARE\AhnLab\V3Lite" > anti-virus.txt
reg query "HKLM\SOFTWARE\AhnLab\V3Pro" >>  anti-virus.txt
reg query "HKLM\SOFTWARE\AhnLab\V3NET60" >> anti-virus.txt
reg query "HKLM\SOFTWARE\AhnLab\V3NET70" >> anti-virus.txt
reg query "HKLM\SOFTWARE\AhnLab\V3NET80" >> anti-virus.txt
reg query "HKLM\SOFTWARE\AhnLab\V3NET90" >> anti-virus.txt
reg query "HKLM\SOFTWARE\AhnLab" | FIND "V3" |FIND /v "V3Filter"			     >> ..\%COMPUTERNAME%-result.txt
type anti-virus.txt | FIND /I "ProductName"						     >> ..\%COMPUTERNAME%-result.txt
type anti-virus.txt | FIND /I "V3EngineDate"						     >> ..\%COMPUTERNAME%-result.txt
type anti-virus.txt | FIND /I "dbUpdateDate"						     >> ..\%COMPUTERNAME%-result.txt
echo -----알약 체크 -----                                               >> ..\%COMPUTERNAME%-result.txt
reg query "HKLM\SOFTWARE\ESTsoft\ALYac" >> anti-virus.txt
echo 구동여부 체크                                                     >> ..\%COMPUTERNAME%-result.txt
echo -----------------------------------                                 >> ..\%COMPUTERNAME%-result.txt
net start | findstr /i "alyac"                                        >> ..\%COMPUTERNAME%-result.txt
echo -----------------------------------                               >> ..\%COMPUTERNAME%-result.txt
type anti-virus.txt | FIND /I "Licensetype"						     >> ..\%COMPUTERNAME%-result.txt
type anti-virus.txt | FIND /I "dbUpdateDate"						     >> ..\%COMPUTERNAME%-result.txt
type anti-virus.txt | FIND /I "updateDate"                               >> ..\%COMPUTERNAME%-result.txt
echo -----바이로봇 체크 ----                                           >> ..\%COMPUTERNAME%-result.txt
echo 구동여부 체크                                                     >> ..\%COMPUTERNAME%-result.txt
echo -----------------------------------                                 >> ..\%COMPUTERNAME%-result.txt
net start | find /i "virobot"                                           >> ..\%COMPUTERNAME%-result.txt
echo -----------------------------------                                 >> ..\%COMPUTERNAME%-result.txt
type "C:\Program Files\HAURI\Common\Update\hUpdate.exe.log" > hauri.txt 
type hauri.txt | find /i "time" | find /v "INFO" | find /v "Attrib"    >> ..\%COMPUTERNAME%-result.txt
echo -----노턴 백신 체크 ----                                           >> ..\%COMPUTERNAME%-result.txt
echo 구동여부 체크                                                     >> ..\%COMPUTERNAME%-result.txt
echo -----------------------------------                                 >> ..\%COMPUTERNAME%-result.txt
net start | find /i "norton"                                            >> ..\%COMPUTERNAME%-result.txt
echo ----MS 백신 체크----                                               >> ..\%COMPUTERNAME%-result.txt
echo 구동여부 체크                                                     >> ..\%COMPUTERNAME%-result.txt
net start | find /i "Microsoft Antimalware Service"                  >> ..\%COMPUTERNAME%-result.txt


echo [PC-13] END                                                                              >> ..\%COMPUTERNAME%-result.txt
echo [PC-13] 수동						                     >> ..\%COMPUTERNAME%-result.txt
del anti-virus.txt
echo.				                                                             >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt



chcp 437






echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo 백신 업데이트 여부                                             >> ..\%COMPUTERNAME%-result.txt
echo 아무값도 나오지 않으면 백신 설치여부 항목  및 인터뷰를 통해 진단             >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt




REM 32-PC-14
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-14] 바이러스 백신 프로그램에서 제공하는 실시간 감시 기능 활성화            >> ..\%COMPUTERNAME%-result.txt
echo 백신 실시간 감시 가능 체크                                >> ..\%COMPUTERNAME%-result.txt
echo "# HKEY_LOCAL_MACHINE\SOFTWARE\Ahnlab\V3Lite\SystemSec" | find "MonitorType""      >> ..\%COMPUTERNAME%-result.txt
echo "# HKEY_LOCAL_MACHINE\SOFTWARE\Ahnlab\V3IS80\sysmon" | find "sysmon""              >> ..\%COMPUTERNAME%-result.txt
echo "# HKEY_LOCAL_MACHINE\SOFTWARE\Hauri\VRIS2011" | find "State""                     >> ..\%COMPUTERNAME%-result.txt
echo "# HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft Antimalware\Real-Time Protection" | find "DisableRealtimeMonitoring"" >> ..\%COMPUTERNAME%-result.txt

echo ----v3-Lite 체크-----             >> ..\%COMPUTERNAME%-result.txt
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Ahnlab\V3Lite\SystemSec" | find "MonitorType" > v3-lite.txt
type v3-lite.txt | find "40000009"  
IF NOT ERRORLEVEL 1 echo "v3-lite 실시간 감시 기능 사용중"     >> ..\%COMPUTERNAME%-result.txt
IF ERRORLEVEL 1 echo "v3-lite 실시간 감시 기능 미사용"        >> ..\%COMPUTERNAME%-result.txt
type v3-lite.txt        >> ..\%COMPUTERNAME%-result.txt

echo ----v3 Internet Security V8 체크 --                 >> ..\%COMPUTERNAME%-result.txt
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Ahnlab\V3IS80\sysmon" | find "sysmon" > v3-internetV8.txt 
type v3-internetV8.txt | find "x1" 
IF NOT ERRORLEVEL 1 echo "v3-internet-security8 실시간 감시 기능 사용"  >> ..\%COMPUTERNAME%-result.txt
IF ERRORLEVEL 1 echo "v3-internet-security8 실시간 감시 미사용"         >> ..\%COMPUTERNAME%-result.txt
type v3-internetV8.txt        >> ..\%COMPUTERNAME%-result.txt


echo -----알약 체크 -------      >> ..\%COMPUTERNAME%-result.txt
tasklist | find /i "AYRTSrv"     >> ..\%COMPUTERNAME%-result.txt
echo 실시간 감시미사용:16.384k 사용:16.384k이상 >> ..\%COMPUTERNAME%-result.txt

echo -----바이로봇 체크 ----   >> ..\%COMPUTERNAME%-result.txt
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Hauri\VRIS2011" | find "State" > hauri.txt 
type hauri.txt | find "1122111"
IF NOT ERRORLEVEL 1 echo 하우리 백신 실시간 감시모드 사용중  >> ..\%COMPUTERNAME%-result.txt
IF ERRORLEVEL 1 echo 하우리 백신 실시간 감시 기능 미사용      >> ..\%COMPUTERNAME%-result.txt
type hauri.txt                                                >> ..\%COMPUTERNAME%-result.txt             
						   
echo ---마이크로소프트 Security Essentials 체크  --          >> ..\%COMPUTERNAME%-result.txt 
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft Antimalware\Real-Time Protection" | find "DisableRealtimeMonitoring" > ms-security.txt
type ms-security.txt | find "x0" 
IF NOT ERRORLEVEL 1 echo MS 백신 실시간 감시모드 사용중 	>> ..\%COMPUTERNAME%-result.txt
IF ERRORLEVEL 1 echo MS 백신 실시간 감시모드 미사용 		>> ..\%COMPUTERNAME%-result.txt
type ms-security.txt                                       >> ..\%COMPUTERNAME%-result.txt

						   
echo [PC-14] END  >> ..\%COMPUTERNAME%-result.txt
echo [PC-14] 수동   >> ..\%COMPUTERNAME%-result.txt


echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo 바이러스 백신 프로그램에서 제공하는 실시간 감시 기능 활성화                                                                       >> ..\%COMPUTERNAME%-result.txt
echo 안철수연구소 v3-lite = MonitorType = 40000009 (실시간 감시사용)       >> ..\%COMPUTERNAME%-result.txt
echo 안철수연구소 v3-internet-security = sysmon = 1 (실시간 감시 사용)        >> ..\%COMPUTERNAME%-result.txt
echo 알약실시간감시 프로세스 = AYRTSrv 미사용시 메모리크기 = 16.384k             >> ..\%COMPUTERNAME%-result.txt
echo 바이로봇 = state = 1122111 (실시간 감시사용)                             >> ..\%COMPUTERNAME%-result.txt
echo 마이크로소프트 백신 = DisableRealtimeMonitoring = 0 (실시간 감시 사용)     >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt





REM PC-15번 분기점 ############################



type systeminfo.txt | find /i "windows xp" 


IF NOT ERRORLEVEL 1 goto 32-bit-xp-15-check 

type systeminfo.txt | find /i "windows 7"

IF NOT ERRORLEVEL 1 goto 32-bit-win7-15-check




:32-bit-xp-15-check

REM 32-PC-15-XP
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-15] OS에서 제공하는 침입차단 기능 활성화            >> ..\%COMPUTERNAME%-result.txt

echo "# HKLM\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\StandardProfile | find /i "EnableFirewall""    >> ..\%COMPUTERNAME%-result.txt
reg query "HKLM\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\StandardProfile" | find /i "EnableFirewall" > firewall.txt

type firewall.txt | find "x1" 


IF NOT ERRORLEVEL 1 echo OS 에서 제공하는 방화벽이 활성화 되어있어 양호함    >> ..\%COMPUTERNAME%-result.txt
IF ERRORLEVEL 1 echo OS 에서 제공하는 방화벽이 비활성화 되어있어 취약함    >> ..\%COMPUTERNAME%-result.txt

type firewall.txt  >> ..\%COMPUTERNAME%-result.txt


echo [PC-15] END                                                                                           >> ..\%COMPUTERNAME%-result.txt
type firewall.txt | find "x1" 
IF NOT ERRORLEVEL 1 echo [PC-15] 양호    >> ..\%COMPUTERNAME%-result.txt
IF ERRORLEVEL 1 echo [PC-15] 취약    >> ..\%COMPUTERNAME%-result.txt

del firewall.txt
										   
goto 32-bit-15-end






:32-bit-win7-15-check


REM 32-PC-15-WIN7
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-15] OS에서 제공하는 침입차단 기능 활성화            >> ..\%COMPUTERNAME%-result.txt

echo "# HKLM\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\StandardProfile" | find /i "EnableFirewall""     >> ..\%COMPUTERNAME%-result.txt
echo "# HKLM\SYSTEM\CurrentControlSet\services\SharedAccess\Parameters\FirewallPolicy\PublicProfile" | find /i "EnableFirewall""        >> ..\%COMPUTERNAME%-result.txt
reg query "HKLM\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\StandardProfile" | find /i "EnableFirewall" > firewall.txt

reg query "HKLM\SYSTEM\CurrentControlSet\services\SharedAccess\Parameters\FirewallPolicy\PublicProfile" | find /i "EnableFirewall" > firewall2.txt

type firewall.txt | find "x1" 

if ERRORLEVEL 1 goto 32-bit-win7-15-fail

type firewall2.txt | find "x1" 

if ERRORLEVEL 1 goto 32-bit-win7-15-fail


echo OS 에서 제공하는 방화벽이 활성화 되어있어 양호함    >> ..\%COMPUTERNAME%-result.txt
echo --홈 또는 회사(개인)네트워크 방화벽체크--   >> ..\%COMPUTERNAME%-result.txt
type firewall.txt  >> ..\%COMPUTERNAME%-result.txt
echo --공용 네트워크 방화벽체크--    >> ..\%COMPUTERNAME%-result.txt
type firewall2.txt  >> ..\%COMPUTERNAME%-result.txt

echo [PC-15] END                                                                                           >> ..\%COMPUTERNAME%-result.txt

echo [PC-15] 양호    >> ..\%COMPUTERNAME%-result.txt

goto 32-bit-15-end

:32-bit-win7-15-fail


echo OS 에서 제공하는 방화벽이 비활성화 되어있어 취약함    >> ..\%COMPUTERNAME%-result.txt
echo --홈 또는 회사(개인)네트워크 방화벽체크--    >> ..\%COMPUTERNAME%-result.txt
type firewall.txt  >> ..\%COMPUTERNAME%-result.txt
echo --공용 네트워크 방화벽체크--               >> ..\%COMPUTERNAME%-result.txt
type firewall2.txt  >> ..\%COMPUTERNAME%-result.txt
echo [PC-15] END     >> ..\%COMPUTERNAME%-result.txt
echo [PC-15] 취약    >> ..\%COMPUTERNAME%-result.txt




:32-bit-15-end						   

del firewall.txt
del firewall2.txt
		
		
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo OS에서 제공하는 침입차단 기능 활성화  >> ..\%COMPUTERNAME%-result.txt
echo EnableFirewall = x0 - (방화벽 미사용)취약       >> ..\%COMPUTERNAME%-result.txt
echo EnableFirewall = x1 - (방화벽 사용)양호          >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt


del servicepack.txt




REM 32-PC-16
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-16] 화면 보호기 대기 시간 설정 점검                                                 >> ..\%COMPUTERNAME%-result.txt
echo "# HKCU\Control Panel\Desktop" | find "ScreenSaveTimeOut""                              >> ..\%COMPUTERNAME%-result.txt

echo "ScreenSaveActive 결과 값"							    > pc-16_TEMP.txt                  
reg query "HKCU\Control Panel\Desktop" | findstr /i "ScreenSaveActive" 			>> pc-16_TEMP.txt                  
echo "ScreenSaverlsSecure 결과 값"			    				>> pc-16_TEMP.txt                  
reg query "HKCU\Control Panel\Desktop" | findstr /i "ScreenSaverIsSecure"    		>> pc-16_TEMP.txt                  
echo "ScreenSaveTimeout 결과 값"			    				>> pc-16_TEMP.txt                  
reg query "HKCU\Control Panel\Desktop" | findstr /i "ScreenSaveTimeOut"    		>> pc-16_TEMP.txt   
echo "다시 시작할 때 로그온 화면 푯' 결과 값"			    				>> pc-16_TEMP.txt                  
reg query "HKCU\Control Panel\Desktop" | findstr /i "ScreenSaverlsSecure"    		>> pc-16_TEMP.txt                  
type pc-16_TEMP.txt 																			>> ..\%COMPUTERNAME%-result.txt



:PC-16_END
echo [PC-16] END                                                                            	  >> ..\%COMPUTERNAME%-result.txt
echo [PC-16] 수동점검                                                                             >> ..\%COMPUTERNAME%-result.txt
del pc-16_TEMP.txt  



echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo 화면 보호기 대기 시간 설정 점검      
echo ScreenSaveActive = 화면보호기 동작 여부 확인                                                    >> ..\%COMPUTERNAME%-result.txt
echo ScreenSaverIsSecure = 화면보호기 해제시 암호사용 여부 확인                                            >> ..\%COMPUTERNAME%-result.txt
echo ScreenSaveTimeOut = 대기 시간 설정 초 단위                                            >> ..\%COMPUTERNAME%-result.txt
echo 레지스트리값 3개중 1개라도 없을시 취약판정                                              >> ..\%COMPUTERNAME%-result.txt       
echo ==양호기준==                                                   >> ..\%COMPUTERNAME%-result.txt
echo ScreenSaveActive = 1                                                    >> ..\%COMPUTERNAME%-result.txt
echo ScreenSaverIsSecure = 1                                            >> ..\%COMPUTERNAME%-result.txt
echo ScreenSaveTimeOut = 600 이하                                            >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt



REM 32-PC-17
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
chcp 949

echo [PC-17] CD, DVD, USB메모리 등과 같은 미디어의 자동실행 방지 등 이동식 미디어에 대한 보안대책 수립   >> ..\%COMPUTERNAME%-result.txt
echo ---레지스트리에서 자동실행 체크---- (@SYS:DoesNotExist , @SYS:NoWhere)       >> ..\%COMPUTERNAME%-result.txt                                  
echo "# HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\IniFileMapping\Autorun.inf"       >> ..\%COMPUTERNAME%-result.txt
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\IniFileMapping\Autorun.inf"   >> ..\%COMPUTERNAME%-result.txt
						
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt

echo "로컬그룹정책에서의 자동실행 방지설정 여부 체크 확인"                                                   >> ..\%COMPUTERNAME%-result.txt
echo "# HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer"        >> ..\%COMPUTERNAME%-result.txt
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer"      >> ..\%COMPUTERNAME%-result.txt
						

echo [PC-17] END  >> ..\%COMPUTERNAME%-result.txt
echo [PC-17] 수동   >> ..\%COMPUTERNAME%-result.txt

chcp 437
echo.                                                                                      				  >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                        				  >> ..\%COMPUTERNAME%-result.txt
echo CD, DVD, USB메모리 등과 같은 미디어의 자동실행 방지 등 이동식 미디어에 대한 보안대책 2가지 방안                                                                       >> ..\%COMPUTERNAME%-result.txt
echo 1. Autorun.inf의 기본값 : @SYS:DoesNotExist 또는 @SYS:NoWhere 값이 들어가있으면 양호      			 >> ..\%COMPUTERNAME%-result.txt
echo 1.  @SYS:DoesNotExist 또는 @SYS:NoWhere 값이 미출력될시 = 취약 
echo 2. 로컬그룹정책에서의 자동실행 방지설정 여부 체크 확인에 값이 출력될경우  = 양호                                      >> ..\%COMPUTERNAME%-result.txt
echo 2. 로컬그룹정책에서의 자동실행 방지설정 여부 체크 확인에 값이 출력되지 않을경우 = 취약                                  >> ..\%COMPUTERNAME%-result.txt
echo 윈도우 home 버전은 로컬그룹정책이 없기때문에 1번항목을 봐야함                                		    >> ..\%COMPUTERNAME%-result.txt
echo 윈도우7은 결과값만 출력되면 양호이며 윈도우 xp 버전은 로컬그룹정책 결과값이 0xff 로 나와야함 (모든드라이브 자동실행사용안함)    >> ..\%COMPUTERNAME%-result.txt
echo 둘중 한가지라도 설정되어있으면 양호함(안행부 2014-01 가이드라인 이미지를 참조할것)               				  >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                         			 >> ..\%COMPUTERNAME%-result.txt







REM 32-PC-18
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-18] PC 내부의 미사용(3개월) ActiveX 제거       >> ..\%COMPUTERNAME%-result.txt
dir /OD "%systemroot%\Downloaded Program Files"	|find "-"    >> ..\%COMPUTERNAME%-result.txt
                                       										   
echo [PC-18] END  >> ..\%COMPUTERNAME%-result.txt
echo [PC-18] 수동   >> ..\%COMPUTERNAME%-result.txt


echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo PC 내부의 미사용(3개월) ActiveX 제거                                                                       >> ..\%COMPUTERNAME%-result.txt
echo ActiveX 설치 디렉토리 및 파일이 랜덤함으로 자동진단 불가       >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt





REM 32-PC-19
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-19] 시스템 부팅 시 Windows Messenger가 자동으로 시작되지 않도록 설정되어 있는가?    >> ..\%COMPUTERNAME%-result.txt
echo "# HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Messenger\Client | find "PreventAutoRun"" >> ..\%COMPUTERNAME%-result.txt                           
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Messenger\Client" | find "PreventAutoRun" > Messenger.txt 

type Messenger.txt | find "x1"

IF NOT ERRORLEVEL 1 echo 시스템 부팅시 Windows Messenger을 시작되지 않도록 설정되어있어 양호함    >> ..\%COMPUTERNAME%-result.txt
IF ERRORLEVEL 1 echo 시스템 부팅시 Windows Messenger을 시작하도록 설정되어있어 취약함            >> ..\%COMPUTERNAME%-result.txt
					
type Messenger.txt          >> ..\%COMPUTERNAME%-result.txt

echo [PC-19] END             >> ..\%COMPUTERNAME%-result.txt

IF NOT ERRORLEVEL 1 echo [PC-19] 양호         >> ..\%COMPUTERNAME%-result.txt
IF ERRORLEVEL 1 echo [PC-19] 취약              >> ..\%COMPUTERNAME%-result.txt
					 

					



echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo 시스템 부팅 시 Windows Messenger가 자동으로 시작되지 않도록 설정되어 있는가?                                                                       >> ..\%COMPUTERNAME%-result.txt
echo PreventAutoRun = x0 사용안함(취약)       >> ..\%COMPUTERNAME%-result.txt
echo PreventAutoRun = x1 사용(양호)                                     >> ..\%COMPUTERNAME%-result.txt
echo home 은 해당사항없음 home 외에 값이 없으면 취약                         >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt


del servicepack.txt


REM ###############################20번 항목 분기점 ###################################################################

type systeminfo.txt | find /i "windows xp" 


IF NOT ERRORLEVEL 1 goto 32-bit-xp-20-check 

type systeminfo.txt | find /i "windows 7"

IF NOT ERRORLEVEL 1 goto 32-bit-win7-20-check





REM 32-PC-20-XP
:32-bit-xp-20-check

echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-20] 원격 지원을 금지하도록 정책이 설정되어 사용되는가?                                          >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo fAllowUnsolicited 결과값이 1일 경우 취약  >> ..\%COMPUTERNAME%-result.txt
echo "# HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server"                               >> ..\%COMPUTERNAME%-result.txt
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services" | find /I "fAllowUnsolicited"	  >> ..\%COMPUTERNAME%-result.txt

echo [PC-20] END                                                         >> ..\%COMPUTERNAME%-result.txt

IF ERRORLEVEL 1 echo [PC-20] 양호                                >> ..\%COMPUTERNAME%-result.txt
IF NOT ERRORLEVEL 1 echo [PC-20] 취약                         >> ..\%COMPUTERNAME%-result.txt


echo.                                                                           >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo fAllowUnsolicited = 0 (해당 PC를 원격 데스크톱 사용안함)-양호                                                >> ..\%COMPUTERNAME%-result.txt
echo fAllowUnsolicited = 1 (해당 PC를 원격 데스크톱 사용함)-취약                                              >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                   >> ..\%COMPUTERNAME%-result.txt
echo.                                                                           >> ..\%COMPUTERNAME%-result.txt
echo.                                                                           >> ..\%COMPUTERNAME%-result.txt



goto 32-bit-[PC-20]-end





:32-bit-win7-20-check

REM 32-PC-20-WIN7
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-20] 원격 지원을 금지하도록 정책이 설정되어 사용되는가?                                          >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo fAllowUnsolicited 결과값이 1일 경우 취약  >> ..\%COMPUTERNAME%-result.txt
echo "# HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server"                               >> ..\%COMPUTERNAME%-result.txt
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services" | find /I "fAllowUnsolicited"	  >> ..\%COMPUTERNAME%-result.txt

echo [PC-20] END                                                         >> ..\%COMPUTERNAME%-result.txt

IF ERRORLEVEL 1 echo [PC-20] 양호                                >> ..\%COMPUTERNAME%-result.txt
IF NOT ERRORLEVEL 1 echo [PC-20] 취약                         >> ..\%COMPUTERNAME%-result.txt


echo.                                                                           >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo fAllowUnsolicited = 0 (해당 PC를 원격 데스크톱 사용안함)-양호                                                >> ..\%COMPUTERNAME%-result.txt
echo fAllowUnsolicited = 1 (해당 PC를 원격 데스크톱 사용함)-취약                                              >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                   >> ..\%COMPUTERNAME%-result.txt
echo.                                                                           >> ..\%COMPUTERNAME%-result.txt
echo.                                                                           >> ..\%COMPUTERNAME%-result.txt
















:32-bit-[PC-20]-end






goto end-pc-check



:x64-based

echo ############################################################################################# >> ..\%COMPUTERNAME%-result.txt
echo ###################																			>> ..\%COMPUTERNAME%-result.txt
echo  ###################           windows 64bit   check                      						>> ..\%COMPUTERNAME%-result.txt
echo ####################																			>> ..\%COMPUTERNAME%-result.txt
echo #############################################################################################  >> ..\%COMPUTERNAME%-result.txt

chcp 949


REM 64-PC-1
echo 64비트를 체크해봅시다.    >> ..\%COMPUTERNAME%-result.txt
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo [PC-1] 패스워드의 주기적 변경 ========================================== >> ..\%COMPUTERNAME%-result.txt
echo "# accounts | find /i "최대 암호""                                      >> ..\%COMPUTERNAME%-result.txt
net accounts                                           >> ..\%COMPUTERNAME%-result.txt


net user   > user.txt
type user.txt | find /V "--" | find /V "실행했습니다." | find /V "사용자 계정" > usercheck.txt 
REM FOR /F "tokens=1" %%a in (user2.txt) do SET pc_TEMP=%%a



net accounts | find "Maximum password"							     >> ..\%COMPUTERNAME%-result.txt                                         
echo [PC-1] END                                                              >> ..\%COMPUTERNAME%-result.txt
echo [PC-1] 수동                                                             >> ..\%COMPUTERNAME%-result.txt

echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt

FOR /F "tokens=1" %%a IN (usercheck.txt) DO net user %%a | find /V "전체 이름" | find /V "설명" | find /V "사용자 설명" | find /V "국가 코드" | find /V "워크스테이션" | find /V "스크립트" | find /V "프로필" | find /V "디렉터리" | find /V "실행했습니다" | find /V "구성원" | find /V "허용된"  >> ..\%COMPUTERNAME%-result.txt    
FOR /F "tokens=2" %%b IN (usercheck.txt) DO net user %%b | find /V "전체 이름" | find /V "설명" | find /V "사용자 설명" | find /V "국가 코드" | find /V "워크스테이션" | find /V "스크립트" | find /V "프로필" | find /V "디렉터리" | find /V "실행했습니다" | find /V "구성원" | find /V "허용된"  >> ..\%COMPUTERNAME%-result.txt    
FOR /F "tokens=3" %%c IN (usercheck.txt) DO net user %%c | find /V "전체 이름" | find /V "설명" | find /V "사용자 설명" | find /V "국가 코드" | find /V "워크스테이션" | find /V "스크립트" | find /V "프로필" | find /V "디렉터리" | find /V "실행했습니다" | find /V "구성원" | find /V "허용된"  >> ..\%COMPUTERNAME%-result.txt    
FOR /F "tokens=4" %%d IN (usercheck.txt) DO net user %%d | find /V "전체 이름" | find /V "설명" | find /V "사용자 설명" | find /V "국가 코드" | find /V "워크스테이션" | find /V "스크립트" | find /V "프로필" | find /V "디렉터리" | find /V "실행했습니다" | find /V "구성원" | find /V "허용된"  >> ..\%COMPUTERNAME%-result.txt    
FOR /F "tokens=5" %%e IN (usercheck.txt) DO net user %%e | find /V "전체 이름" | find /V "설명" | find /V "사용자 설명" | find /V "국가 코드" | find /V "워크스테이션" | find /V "스크립트" | find /V "프로필" | find /V "디렉터리" | find /V "실행했습니다" | find /V "구성원" | find /V "허용된"  >> ..\%COMPUTERNAME%-result.txt    

chcp 437

del usercheck.txt

echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          	>> ..\%COMPUTERNAME%-result.txt
echo 패스워드의 주기적 변경                                                              			 >> ..\%COMPUTERNAME%-result.txt
echo 최대 패스워드 사용일이 설정되어있다면 양호                                                 		>> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo.                                          												    >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt


REM 64-PC-2
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-2] 패스워드 정책이 해당기관의 보안정책에 적합하게 설정 								>> ..\%COMPUTERNAME%-result.txt
echo "# net accounts"                                                            >> ..\%COMPUTERNAME%-result.txt
net accounts > net-accounts.txt  
type net-accounts.txt | find "length"						     > length.txt
FOR /F "tokens=4" %%k in (length.txt) do SET pc_TEMP=%%k

IF %pc_TEMP% GEQ 8 GOTO 64-length-SETTING-OK

echo 패스워드 최소 암호길이기 8자리 미만으로 설정되어 있어 취약함                         					   >> ..\%COMPUTERNAME%-result.txt
net accounts | find "length" 						                                         >> ..\%COMPUTERNAME%-result.txt
echo [PC-2] END                                                                               >> ..\%COMPUTERNAME%-result.txt
echo [PC-2] 취약								                   								  >> ..\%COMPUTERNAME%-result.txt
goto 64-length-end
:64-length-SETTING-OK
     
echo 패스워드 최소 암호길이가 8자리 이상으로 설정되어있어  양호함  											 >> ..\%COMPUTERNAME%-result.txt
net accounts | find "length"							   									  >> ..\%COMPUTERNAME%-result.txt
echo [PC-2] END                                                                               >> ..\%COMPUTERNAME%-result.txt
echo [PC-2] 양호                                                                               >> ..\%COMPUTERNAME%-result.txt
	   
	   
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
:64-length-end
set pc_TEMP=
del length.txt
del net-accounts.txt


echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt



REM 64-PC-3
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-3] 복구 콘솔에서 자동 로그온을 금지하도록 설정하여 사용하고 있는가? ================= >> ..\%COMPUTERNAME%-result.txt

echo "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Setup\RecoveryConsole | find /i "SecurityLevel""  >> ..\%COMPUTERNAME%-result.txt
win7-64-reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Setup\RecoveryConsole" | find /i "SecurityLevel" > SecurityLevel.txt 


type SecurityLevel.txt | find "1" 

IF ERRORLEVEL 1 ECHO 복구 콘솔에서 자동 로그온을 금지하도록 설정되어있어 양호함                                                            >> ..\%COMPUTERNAME%-result.txt
IF NOT ERRORLEVEL 1 ECHO 복구 콘솔에서 자동 로그온을 허용하고 있어 취약함                                                                         >> ..\%COMPUTERNAME%-result.txt

type SecurityLevel.txt                                      >> ..\%COMPUTERNAME%-result.txt

echo [PC-3] END                                                              >> ..\%COMPUTERNAME%-result.txt
type SecurityLevel.txt | find "1"                                                       
IF ERRORLEVEL 1 ECHO [PC-3] 양호                                                           >> ..\%COMPUTERNAME%-result.txt
IF NOT ERRORLEVEL 1 ECHO [PC-3] 취약                                                             >> ..\%COMPUTERNAME%-result.txt

echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo 윈도우 XP CD부팅하여 복구시에도 적용됨                                   >> ..\%COMPUTERNAME%-result.txt
echo 윈도우 7 CD부팅하여 복구시에는 적용안됨(내부 복구콘솔만 해당)                 >> ..\%COMPUTERNAME%-result.txt
echo SecurityLevel = 0 (복구콘솔 관리자 자동 로그온 사용안함) -양호                               >> ..\%COMPUTERNAME%-result.txt
echo SecurityLevel = 1 (복구콘솔 관리자 자동 로그온 사용함) - 취약                                 >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo.                                              >> ..\%COMPUTERNAME%-result.txt
echo.                                                  >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt


del SecurityLevel.txt




REM 64-PC-4
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo [PC-4] 공유폴더 제거                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo "# net share"                                                                            >> ..\%COMPUTERNAME%-result.txt
echo 파일 공유 서비스인 server 구동상태 체크                                                          >> ..\%COMPUTERNAME%-result.txt
net start | findstr /v "A B C D E F G H I J K L M N O P Q R T U V W X Y Z a b c d f g h i j k l m n o p q t u w x y z" | findstr "Server"     >> ..\%COMPUTERNAME%-result.txt

net start | findstr /v "A B C D E F G H I J K L M N O P Q R T U V W X Y Z a b c d f g h i j k l m n o p q t u w x y z" | findstr "Server"

IF ERRORLEVEL 1 GOTO netshare-64-04 

echo. 불필요한 공유폴더 확인                                                                                       >> ..\%COMPUTERNAME%-result.txt
net share                                                                                >> ..\%COMPUTERNAME%-result.txt
echo [PC-4] END                                                                       >> ..\%COMPUTERNAME%-result.txt
echo [PC-4] 수동                                                                       >> ..\%COMPUTERNAME%-result.txt

net share   | FIND /i "c:\"                       > PC-4-netsharelist.txt  
net share  | FIND /i "d:\"                       >> PC-4-netsharelist.txt  
net share  | FIND /i "e:\"                       >> PC-4-netsharelist.txt  
net share   | FIND /i "f:\"                       >> PC-4-netsharelist.txt 
net share  | FIND /i "g:\"                       >> PC-4-netsharelist.txt 
net share  | FIND /i "h:\"                       >> PC-4-netsharelist.txt 
net share   | FIND /i "i:\"                       >> PC-4-netsharelist.txt 

FOR /F "tokens=1" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                                 >   PC-4-netsharelist2.txt 
FOR /F "tokens=2" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                                 >>  PC-4-netsharelist2.txt
FOR /F "tokens=3" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                                 >>  PC-4-netsharelist2.txt
FOR /F "tokens=4" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                                 >>  PC-4-netsharelist2.txt
FOR /F "tokens=5" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                                 >>  PC-4-netsharelist2.txt
FOR /F "tokens=6" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                                 >>  PC-4-netsharelist2.txt
FOR /F "tokens=7" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                                 >>  PC-4-netsharelist2.txt



FOR /F "tokens=1" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                         >> ..\%COMPUTERNAME%-result.txt
FOR /F "tokens=2" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                         >> ..\%COMPUTERNAME%-result.txt
FOR /F "tokens=3" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                         >> ..\%COMPUTERNAME%-result.txt
FOR /F "tokens=4" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                         >> ..\%COMPUTERNAME%-result.txt
FOR /F "tokens=5" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                         >> ..\%COMPUTERNAME%-result.txt
FOR /F "tokens=6" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                         >> ..\%COMPUTERNAME%-result.txt
FOR /F "tokens=7" %%j IN (PC-4-netsharelist.txt) DO cacls %%j                         >> ..\%COMPUTERNAME%-result.txt




del PC-4-netsharelist.txt
del PC-4-netsharelist2.txt


goto netshare-64-04-end

:netshare-64-04

echo "Server" 공유 서비스가 구동하지 않으므로 양호함 										>> ..\%COMPUTERNAME%-result.txt
echo [PC-4] END                                                                             >> ..\%COMPUTERNAME%-result.txt
echo [PC-4] 양호                                                                            >> ..\%COMPUTERNAME%-result.txt


:netshare-64-04-end





echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo 공유폴더 제거                                             >> ..\%COMPUTERNAME%-result.txt
echo $표시된 기본 공유폴더가 존재하면 취약 그외 공유폴더 사용유무 및 공유폴더 권한 여부에 따라 판단            >> ..\%COMPUTERNAME%-result.txt
echo 공유디렉토리에 Everyone 계정 권한 확인(Everyone 그룹이 존재한다면 모든사용자 접속가능) >> ..\%COMPUTERNAME%-result.txt
echo 그외 불필요 사용자가 모든권한(F) 및 Write 권한이 있다면 판단후 취약          >> ..\%COMPUTERNAME%-result.txt
echo 양호 = Everyone 사용자 삭제, 사용자(Users그룹사용자)의 권한에 쓰기권한 거부                    >> ..\%COMPUTERNAME%-result.txt
echo 취약 = Everyone 사용자 존재, 사용자(Users그룹사용자)의 권한에 쓰기권한 허용                    >> ..\%COMPUTERNAME%-result.txt
echo 사용자 계정에 쓰기권한(F) 혹은 FILE_WRITE_DATA권한 존재한다면 취약             >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt



REM 64-PC-5

echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-5] 불필요한 서비스 제거                                                             >> ..\%COMPUTERNAME%-result.txt
echo -----불필요 규정 서비스 구동중인 항목-------                                           >> ..\%COMPUTERNAME%-result.txt
net start | find "Alerter"                                             >> ..\%COMPUTERNAME%-result.txt
net start | find "Clipbook"                                             >> ..\%COMPUTERNAME%-result.txt
net start | find "Computer Browser"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "DHCP Client"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "FTP Publishing Service"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Internet Connection Sharing ICS"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Indexing Service"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Windows Firewall/Internet Connection Sharing"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Infared Monitor Service"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Fast User Switching Compatibility"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Messenger"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "NetLogon"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Network DDE"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Network DDE DSDM"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Netmeeting Remote Desktop Sharing"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Print spooler"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Remote Registry"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Routing and Remote Access"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Simple TCP/IP Service"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Simple Mail Transport Protocol"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Task Scheduler"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "TCP/IP NetBIOS Helper"                                 >> ..\%COMPUTERNAME%-result.txt
net start | find "Terminal Services"                                 >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt


echo "#net start"                                                       >> ..\%COMPUTERNAME%-result.txt
net start                                                                >> ..\%COMPUTERNAME%-result.txt


echo [PC-5] END                                                                              >> ..\%COMPUTERNAME%-result.txt
echo [PC-5] 수동                                                                             >> ..\%COMPUTERNAME%-result.txt




echo.                                       
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo 불필요한 서비스 제거                                                                >> ..\%COMPUTERNAME%-result.txt
echo. Alerter(xp) 초기값(disable) = 서버에서 클라이언트로 경고메세지를 보냄                         >> ..\%COMPUTERNAME%-result.txt
echo. Clipbook(xp만존재) = 클립보드 공유 서비스                                             >> ..\%COMPUTERNAME%-result.txt
echo. Computer Browser(모든OS 존재) = 네트워크에 있는 모든 컴퓨터 목록을 갱신하고 관리하며 이 목록을 브라우저로 지정된 컴퓨터에 제공하는 서비스                               >> ..\%COMPUTERNAME%-result.txt
echo. 종료할경우 네트워크환경의 다른사용자와의 리스트가 보이지 않음                              >> ..\%COMPUTERNAME%-result.txt
echo. DHCP Client(모든OS 존재) = 자동으로 IP를 할당받는 DHCP서비스를 이용하기위해 사용됨   >> ..\%COMPUTERNAME%-result.txt
echo. FTP Publishing Service(설치시존재) = ftp 서버를 구동하는 서비스                                   >> ..\%COMPUTERNAME%-result.txt
echo. Internet Connection Sharing ICS(모든OS) = 홈 네트워크 또는 소규모 네트워크에 네트워크 주소 변환, 주소 지정, 이름 확인 및/또는 침입 방지 서비스를 제공하는 서비스    >> ..\%COMPUTERNAME%-result.txt
echo. xp에서는 sharing 서비스를 중지할시 방화벽이 구동안됨                                           >> ..\%COMPUTERNAME%-result.txt
echo. Indexing Service(win7이상) = 로컬 및 원격 컴퓨터에 있는 파일의 내용 및 속성을 인덱싱합니다. 융통성 있는 쿼리 언어를 통해 파일을 빠르게 액세스할 수 있습니다.
echo. Windows Firewall/Internet Connection Sharing(winxp) = 위와동일하나 중지시 방화벽 동작안함        >> ..\%COMPUTERNAME%-result.txt
echo. Infared Monitor Service(설치시 존재)= 
echo. Fast User Switching Compatibility(xp만존재) = 여러 사람이 공동으로 사용하는 컴퓨터에서 컴퓨터를 이용하던 이용자가 로그오프하지 않은 채 다른 사용자가 로그온하여 컴퓨터를 사용할 수 있게 한다.      >> ..\%COMPUTERNAME%-result.txt
echo. Messenger(xp만존재) = 네트워크상에서 메시지를 전달하는 기능을 하는 서비스로써, 성인광고 등의 스팸메시지가 이 서비스를 통해 보내어진다.                              >> ..\%COMPUTERNAME%-result.txt
echo. NetLogon(모든 OS) = 사용자 및 서비스를 인증하기 위해 이 컴퓨터와 도메인 컨트롤러 사이에 보안된 채널을 유지합니다. 이 서비스가 중지되면 컴퓨터에서 사용자 및 서비스를 인증할 수 없고 도메인 컨트롤러에서 DNS 레코드를 등록할 수 없게 됨. >> ..\%COMPUTERNAME%-result.txt
echo. 이 서비스가 사용할 수 없게 설정되면 이 서비스에 종속성이 있는 모든 서비스는 시작할 수 없게 됨  >> ..\%COMPUTERNAME%-result.txt
echo. Network DDE(winxp) = 동일한 컴퓨터나 다른 컴퓨터에서 실행되는 프로그램의 DDE에 대한 네트워크 전송 및 보안을 제공함, 서비스를 중지하면, DDE 전송 및 보안을 사용할 수 없음                       >> ..\%COMPUTERNAME%-result.txt
echo. Network DDE DSDM(winxp) = 동적 DDE 네트워크 공유를 관리. 서비스를 중지하면, DDE 네트워크 공유를 사용할 수 없음. 서비스를 사용하지 않도록 설정하면, 관련된 모든 서비스를 사용할 수 없음   >> ..\%COMPUTERNAME%-result.txt
echo. Netmeeting Remote Desktop Sharing(xp만 존재) = 자신의 컴퓨터에 원격으로 접근할 수 있도록 허용하고 다른 컴퓨터와 바탕 화면 원격 공유를 사용할 수 있게 하는 서비스                               >> ..\%COMPUTERNAME%-result.txt
echo. Print spooler(모든OS) = 나중에 인쇄할 수 있도록 파일을 메모리에 로드                                                      >> ..\%COMPUTERNAME%-result.txt
echo. Remote Registry(모든os) = 원격 사용자가 이 컴퓨터에서 레지스트리 설정을 수정할 수 있도록 설정합니다. 서비스를 중지하면, 이 컴퓨터의 사용자만이 레지스트리를 수정할 수 있습니다. 서비스를 사용하지 않도록 설정하면, 관련된 모든 서비스를 사용할 수 없음 >> ..\%COMPUTERNAME%-result.txt
echo. Routing and Remote Access(모든os) = 로컬 영역 및 광역 네트워크 환경에 있는 사업체에 라우팅 서비스를 제공함              >> ..\%COMPUTERNAME%-result.txt
echo. Simple TCP/IP Service(설치시 존재) = Echo, Discard, Character Generator, Daytime, Quote of the Day 사용함                 >> ..\%COMPUTERNAME%-result.txt
echo. Simple Mail Transport Protocol (SMTP)(설치시 존재) =  
echo. Task Scheduler = 예약된 작업을 실행하는 서비스      >> ..\%COMPUTERNAME%-result.txt
echo. TCP/IP NetBIOS Helper = 사용자가 파일을 인쇄, 공유, 로그인할때 사용함                      >> ..\%COMPUTERNAME%-result.txt
echo. Terminal Services(xp) = 원격 컴퓨터의 데스크톱 디스플레이와 응용 프로그램에 연결할 수 있을 뿐만 아니라 여러 사용자가 한 컴퓨터에 대화형으로 연결할 수 있게 해줌 원격 데스크톱(관리자용 RD 포함), 빠른 사용자 전환, 원격 지원 및 터미널 서버의 기초가 됨        >> ..\%COMPUTERNAME%-result.txt
echo. 유의사항 = 검색어에 해당 단어를 포함하는 서비스가 있을경우 오탐가능성있으니 확인 요망 .                            >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt





REM 64-PC-6
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-6] Windows Messenger(MSN, .NET 메신저 등)와 같은 상용 메신저의 사용 금지  >> ..\%COMPUTERNAME%-result.txt
echo "# Windows Messenger 이외에 상용메신져 수동확인 "                                                                   >> ..\%COMPUTERNAME%-result.txt
echo "# HKLM\SOFTWARE\Policies\Microsoft\Messenger\Client | find "PreventRun""     >> ..\%COMPUTERNAME%-result.txt
win7-64-reg query "HKLM\SOFTWARE\Policies\Microsoft\Messenger\Client" | find "PreventRun" > Messenger-check.txt

type Messenger-check.txt | find "1"

IF NOT ERRORLEVEL 1 ECHO Windows Messenger 를 실행하지 않음으로 설정하여 양호         >> ..\%COMPUTERNAME%-result.txt
IF ERRORLEVEL 1 ECHO Windows Messenger 를 통제하지 않으므로 취약함                           >> ..\%COMPUTERNAME%-result.txt
type Messenger-check.txt | find "PreventRun"                                                                    >> ..\%COMPUTERNAME%-result.txt


echo [PC-6] END                                                                              >> ..\%COMPUTERNAME%-result.txt

type Messenger-check.txt | find "1"
IF NOT ERRORLEVEL 1 ECHO [PC-6] 양호                                                           >> ..\%COMPUTERNAME%-result.txt
IF ERRORLEVEL 1 ECHO [PC-6] 취약                                                             >> ..\%COMPUTERNAME%-result.txt



del Messenger-check.txt



echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                           >> ..\%COMPUTERNAME%-result.txt
echo Windows Messenger(MSN, .NET 메신저 등)와 같은 상용 메신저의 사용 금지                   >> ..\%COMPUTERNAME%-result.txt
echo windows 7이상 = 정책과 상관없이 메신져 Default 설치되지 않음                            >> ..\%COMPUTERNAME%-result.txt
echo windows xp    = 버전에 따라 디폴트로 메신져가 탑재되는 OS가 존재하나 구분할수없으므로 전부 정책 반영   >> ..\%COMPUTERNAME%-result.txt
echo PreventRun = 0 (Windows Messnger 사용금지기능 사용안함) - 취약                          >> ..\%COMPUTERNAME%-result.txt
echo PreventRun = 1 (Windows Messnger 사용금지기능 사용함) - 양호                            >> ..\%COMPUTERNAME%-result.txt
echo 레지스트리값 없음 = 취약(값이 없으면 해당없음 으로 체크됨)                               >> ..\%COMPUTERNAME%-result.txt
echo 해당 항목이 나온 취지는 다음과 같다. Windows패키지중 K 버전과 KN 버전이 존재한다.       >> ..\%COMPUTERNAME%-result.txt
echo K버전은 윈도우 미디어플레이 및 윈도우 메신져가 포함된 버전이었지만 국내에서 불공정      >> ..\%COMPUTERNAME%-result.txt
echo 거래로 판매를 금지하여 KN버전은 이렇한 프로그램들이 포함되지 않은 버전이다.              >> ..\%COMPUTERNAME%-result.txt
echo 즉 windows xp 에서는 이렇한 윈도우 메신져 프로그램이 기본적으로 설치되어 구동하며       >> ..\%COMPUTERNAME%-result.txt
echo 프로그램 추가/제거로 지울수도 없다. 즉 OS에 기본적으로 내장된 윈도우 메신져를 막기위한   >> ..\%COMPUTERNAME%-result.txt
echo 방안으로 탄생된 항목이다. windows 7 에서는 메신져가 설치되지 않으므로  해당설정을      >> ..\%COMPUTERNAME%-result.txt
echo 하지 않아도 양호로 판단하며 xp 에서만 해당 조취를 취하면 된다.  win7은 메신져가 포함되지 않음 >> ..\%COMPUTERNAME%-result.txt
echo 상용메신져는 수동으로 확인                                                                  >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo 윈도우10이상부터 Windows Messenger 사용x                                                                                       >> ..\%COMPUTERNAME%-result.txt









REM 64-PC-7
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-7] 파일 시스템이 NTFS 포맷으로 되어 있는가?                                     >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo "# cacls c:\ | find "(OI)""                                                       >> ..\%COMPUTERNAME%-result.txt
cacls c:\ | find "(OI)" >nul 
IF NOT ERRORLEVEL 1 ECHO ntfs 파일시스템을 사용함으로 양호함                                                            >> ..\%COMPUTERNAME%-result.txt
IF ERRORLEVEL 1 ECHO ntfs 파일시스템을 사용하지 않으므로 취약함                                                              >> ..\%COMPUTERNAME%-result.txt
cacls c:\                      				                                     >> ..\%COMPUTERNAME%-result.txt
echo [PC-7] END                                                                              >> ..\%COMPUTERNAME%-result.txt
cacls c:\ | find "(OI)" >nul    
IF NOT ERRORLEVEL 1 ECHO [PC-7] 양호                                                           >> ..\%COMPUTERNAME%-result.txt
IF ERRORLEVEL 1 ECHO [PC-7] 취약                                                             >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt


echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo 파일 및 디렉토리 보호                                               >> ..\%COMPUTERNAME%-result.txt
echo cacls 명령어의 OI권한은 ntfs만 존재함으로                  >> ..\%COMPUTERNAME%-result.txt
echo OI권한이 있으면 양호 없으면 취약                                            >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt





REM ###############################8번 항목 8-분기점 ###################################################################

type systeminfo.txt | find /i "windows xp" 


IF NOT ERRORLEVEL 1 goto 64-bit-xp-8-check 

type systeminfo.txt | find /i "windows 7"

IF NOT ERRORLEVEL 1 goto 64-bit-win7-8-check




:64-bit-win7-8-check

REM 64-PC-8-WIN7
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-8] 대상 시스템이 windows 서버를 제외한 다른 OS로 멀티 부팅이 가능하지 않도록 설정하여 사용하는가?  >> ..\%COMPUTERNAME%-result.txt
echo "# bcdedit"                                                                                               >> ..\%COMPUTERNAME%-result.txt
bcdedit                                                                                       >> ..\%COMPUTERNAME%-result.txt
echo [PC-8] END                                                                              >> ..\%COMPUTERNAME%-result.txt
echo.[PC-8] 수동                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt


echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo                                                >> ..\%COMPUTERNAME%-result.txt
echo                   >> ..\%COMPUTERNAME%-result.txt
echo                                             >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt

goto 64-bit-8-check-end 



:64-bit-xp-8-check 


REM 64-PC-8-XP
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-8] 대상 시스템이 windows 서버를 제외한 다른 OS로 멀티 부팅이 가능하지 않도록 설정하여 사용하는가?  >> ..\%COMPUTERNAME%-result.txt
echo "# more c:\boot.ini"                                                                                   >> ..\%COMPUTERNAME%-result.txt
more c:\boot.ini                                                                                         >> ..\%COMPUTERNAME%-result.txt
echo [PC-8] END                                                                              >> ..\%COMPUTERNAME%-result.txt
echo.[PC-8] 수동                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt


:64-bit-8-check-end 



REM 64-PC-9
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-9] 브라우저 종료 시 임시 인터넷 파일 폴더의 내용을 삭제하도록 설정하여 사용하는가?  >> ..\%COMPUTERNAME%-result.txt
echo "# HKLM\SOFTWARE\Policies\Microsoft\Windows\CurrentVersion\Internet Settings\Cache | find /i "Persistent"" >> ..\%COMPUTERNAME%-result.txt
win7-64-reg query "HKLM\SOFTWARE\Policies\Microsoft\Windows\CurrentVersion\Internet Settings\Cache" | find /i "Persistent" > internet.txt

type internet.txt | find "1" 


IF ERRORLEVEL 1 echo 브라우저 종료 시 임시 인터넷 파일 폴더내용 삭제하도록 설정되어있어 양호함    >> ..\%COMPUTERNAME%-result.txt
IF NOT ERRORLEVEL 1 echo 브라우저 종료 시 임시 인터넷 파일 폴더내용을 삭제하지 않도록 설정되어있어 취약함    >> ..\%COMPUTERNAME%-result.txt

type internet.txt  >> ..\%COMPUTERNAME%-result.txt


echo [PC-9] END                                                                                           >> ..\%COMPUTERNAME%-result.txt
type internet.txt | find "1" 
IF ERRORLEVEL 1 echo [PC-9] 양호    >> ..\%COMPUTERNAME%-result.txt
IF NOT ERRORLEVEL 1 echo [PC-9] 취약    >> ..\%COMPUTERNAME%-result.txt



echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo 파일 및 디렉토리 보호                                               >> ..\%COMPUTERNAME%-result.txt
echo cacls 명령어의 OI권한은 ntfs만 존재함으로                  >> ..\%COMPUTERNAME%-result.txt
echo OI권한이 있으면 양호 없으면 취약                                            >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt


REM 64-PC-10
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-10] HOT FIX 등 최신 보안패치 적용                                                   >> ..\%COMPUTERNAME%-result.txt
echo 최신보안패치 및 Hotfix 적용 점검                                  >> ..\%COMPUTERNAME%-result.txt
                                           
echo "# wmic"                                                                          >> ..\%COMPUTERNAME%-result.txt
wmic QFE Get HotFixID,InstalledOn | find " "                                                         >> ..\%COMPUTERNAME%-result.txt
echo [PC-10] END  >> ..\%COMPUTERNAME%-result.txt
echo [PC-10] 수동   >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt


echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo 서비스팩 및 Hotfix 적용 점검                                                                       >> ..\%COMPUTERNAME%-result.txt
echo HOTFIX 수량 및 최신 핫픽스 체크       >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt





REM 64-PC-11
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-11] 최신 서비스팩 적용                                                   >> ..\%COMPUTERNAME%-result.txt
echo 최신서비스팩 적용점검                                >> ..\%COMPUTERNAME%-result.txt
                                           
echo "# type systeminfo.txt | find /i "os name"" 			>> ..\%COMPUTERNAME%-result.txt 
echo "# type systeminfo.txt | find /i "version" | find /V "BIOS"" >> ..\%COMPUTERNAME%-result.txt  			   
										   
										   
type systeminfo.txt | find /i "os name" 				    >> ..\%COMPUTERNAME%-result.txt    						   
type systeminfo.txt | find /i "version" | find /V "BIOS"  >> ..\%COMPUTERNAME%-result.txt

echo [PC-11] END  >> ..\%COMPUTERNAME%-result.txt
echo [PC-11] 수동   >> ..\%COMPUTERNAME%-result.txt


echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo OS 별 최신 서비스팩 확인 후 진단                                                 	     >> ..\%COMPUTERNAME%-result.txt
echo OS 별 서비스팩 상이함                             				 					  >> ..\%COMPUTERNAME%-result.txt
echo 윈10이상 서비스팩X -> HoxFix 사용                              					  >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt




REM 64-PC-12
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-12] MS-Office, 구글, 어도브 아크로뱃 등의 응용 프로그램에 대한 최신 보안 패치 및 벤더 권고사항 적용            >> ..\%COMPUTERNAME%-result.txt
echo --한글2007  한글2010 체크--                  >> ..\%COMPUTERNAME%-result.txt
echo "# HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\HNC\Shared\HncUpdate | find "LastUpdate""                            >> ..\%COMPUTERNAME%-result.txt
win7-64-reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\HNC\Shared\HncUpdate" | find "LastUpdate" > hwp2007.txt 
type hwp2007.txt  >> ..\%COMPUTERNAME%-result.txt


echo -- 오피스 체크 (윈도우 자동업데이트 항목) --    >> ..\%COMPUTERNAME%-result.txt                                         
echo "# HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update | find "AUOptions""   >> ..\%COMPUTERNAME%-result.txt
win7-64-reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update" | find "AUOptions" > autoupdate.txt

type autoupdate.txt   >> ..\%COMPUTERNAME%-result.txt
										   

echo [PC-12] END  >> ..\%COMPUTERNAME%-result.txt
echo [PC-12] 수동   >> ..\%COMPUTERNAME%-result.txt


echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo MS-Office, 구글, 어도브 아크로뱃 등의 응용 프로그램에 대한 최신 보안 패치 및 벤더 권고사항 적용                                                                      >> ..\%COMPUTERNAME%-result.txt
echo 한글2007 = 16진수값(0x를 제외한)을 10진수로 변환하면 마지막 업데이트 날짜 확인        >> ..\%COMPUTERNAME%-result.txt
echo 오피스군 = 윈도우 자동업데이트시 오피스군도 포함됨(아래 참조)                                      >> ..\%COMPUTERNAME%-result.txt
echo AUOptions = 1 (업데이트를 확인하지 않음(권장하지 않음)                                                                        >> ..\%COMPUTERNAME%-result.txt
echo AUOptions = 2 (업데이트를 확인하지만 다운로드 및 설치 여부는 직접 선택)                                                                       >> ..\%COMPUTERNAME%-result.txt
echo AUOptions = 3 (업데이트를 다운로드하지만 설치 여부는 직접 선택)                        >> ..\%COMPUTERNAME%-result.txt
echo AUOptions = 4 (업데이트 자동설치(권장)                                                                       >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt






REM 64-PC-13
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-13] 바이러스 백신 프로그램 설치 및 주기적 업데이트	                                                             >> ..\%COMPUTERNAME%-result.txt
chcp 949
echo. 수동진단(net start 결과확인)                 
echo -----안렙 v3 체크 -------                                                                   >> ..\%COMPUTERNAME%-result.txt
echo 구동여부 체크                                                     >> ..\%COMPUTERNAME%-result.txt
echo -----------------------------------                                 >> ..\%COMPUTERNAME%-result.txt
net start | findstr /i "v3 ahnlab"                                      >> ..\%COMPUTERNAME%-result.txt
echo -----------------------------------                               >> ..\%COMPUTERNAME%-result.txt
win7-64-reg query "HKLM\SOFTWARE\AhnLab\V3Lite" > anti-virus.txt
win7-64-reg query "HKLM\SOFTWARE\AhnLab\V3Pro" >>  anti-virus.txt
win7-64-reg query "HKLM\SOFTWARE\AhnLab\V3NET60" >> anti-virus.txt
win7-64-reg query "HKLM\SOFTWARE\AhnLab\V3NET70" >> anti-virus.txt
win7-64-reg query "HKLM\SOFTWARE\AhnLab\V3NET80" >> anti-virus.txt
win7-64-reg query "HKLM\SOFTWARE\AhnLab\V3NET90" >> anti-virus.txt
win7-64-reg query "HKLM\SOFTWARE\AhnLab" | FIND "V3" |FIND /v "V3Filter"			     >> ..\%COMPUTERNAME%-result.txt
type anti-virus.txt | FIND /I "ProductName"						     >> ..\%COMPUTERNAME%-result.txt
type anti-virus.txt | FIND /I "V3EngineDate"						     >> ..\%COMPUTERNAME%-result.txt
type anti-virus.txt | FIND /I "dbUpdateDate"						     >> ..\%COMPUTERNAME%-result.txt
echo -----알약 체크 -----                                               >> ..\%COMPUTERNAME%-result.txt
win7-64-reg query "HKLM\SOFTWARE\ESTsoft\ALYac" >> anti-virus.txt
echo 구동여부 체크                                                     >> ..\%COMPUTERNAME%-result.txt
echo -----------------------------------                                 >> ..\%COMPUTERNAME%-result.txt
net start | findstr /i "alyac"                                        >> ..\%COMPUTERNAME%-result.txt
echo -----------------------------------                               >> ..\%COMPUTERNAME%-result.txt
type anti-virus.txt | FIND /I "Licensetype"						     >> ..\%COMPUTERNAME%-result.txt
type anti-virus.txt | FIND /I "dbUpdateDate"						     >> ..\%COMPUTERNAME%-result.txt
type anti-virus.txt | FIND /I "updateDate"                               >> ..\%COMPUTERNAME%-result.txt
echo -----바이로봇 체크 ----                                           >> ..\%COMPUTERNAME%-result.txt
echo 구동여부 체크                                                     >> ..\%COMPUTERNAME%-result.txt
echo -----------------------------------                                 >> ..\%COMPUTERNAME%-result.txt
net start | find /i "virobot"                                           >> ..\%COMPUTERNAME%-result.txt
echo -----------------------------------                                 >> ..\%COMPUTERNAME%-result.txt
type "C:\Program Files\HAURI\Common\Update\hUpdate.exe.log" > hauri.txt 
type hauri.txt | find /i "time" | find /v "INFO" | find /v "Attrib"    >> ..\%COMPUTERNAME%-result.txt
echo -----노턴 백신 체크 ----                                           >> ..\%COMPUTERNAME%-result.txt
echo 구동여부 체크                                                     >> ..\%COMPUTERNAME%-result.txt
echo -----------------------------------                                 >> ..\%COMPUTERNAME%-result.txt
net start | find /i "norton"                                            >> ..\%COMPUTERNAME%-result.txt
echo -----------------------------------                                 >> ..\%COMPUTERNAME%-result.txt
echo ----MS 백신 체크----                                               >> ..\%COMPUTERNAME%-result.txt
echo 구동여부 체크                                                     >> ..\%COMPUTERNAME%-result.txt
net start | find /i "Microsoft Antimalware Service"                  >> ..\%COMPUTERNAME%-result.txt

chcp 437





echo [PC-13] END                                                                              >> ..\%COMPUTERNAME%-result.txt
echo [PC-13] 수동						                     >> ..\%COMPUTERNAME%-result.txt
del anti-virus.txt
del hauri.txt
echo.				                                                             >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt






echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo 백신 업데이트 여부                                             >> ..\%COMPUTERNAME%-result.txt
echo 아무값도 나오지 않으면 백신 설치여부 항목  및 인터뷰를 통해 진단             >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt




REM 64-PC-14
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-14] 바이러스 백신 프로그램에서 제공하는 실시간 감시 기능 활성화            >> ..\%COMPUTERNAME%-result.txt
echo 백신 실시간 감시 가능 체크                                >> ..\%COMPUTERNAME%-result.txt

echo ----v3-Lite 체크-----             >> ..\%COMPUTERNAME%-result.txt
win7-64-reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Ahnlab\V3Lite\SystemSec" | find "MonitorType" > v3-lite.txt
type v3-lite.txt | find "40000009"  
IF NOT ERRORLEVEL 1 echo "v3-lite 실시간 감시 기능 사용중"     >> ..\%COMPUTERNAME%-result.txt
IF ERRORLEVEL 1 echo "v3-lite 실시간 감시 기능 미사용"        >> ..\%COMPUTERNAME%-result.txt
type v3-lite.txt        >> ..\%COMPUTERNAME%-result.txt

echo ----v3 Internet Security V8 체크 --                 >> ..\%COMPUTERNAME%-result.txt
win7-64-reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Ahnlab\V3IS80\sysmon" | find "sysmon" > v3-internetV8.txt 
type v3-internetV8.txt | find "x1" 
IF NOT ERRORLEVEL 1 echo "v3-internet-security8 실시간 감시 기능 사용"  >> ..\%COMPUTERNAME%-result.txt
IF ERRORLEVEL 1 echo "v3-internet-security8 실시간 감시 미사용"         >> ..\%COMPUTERNAME%-result.txt
type v3-internetV8.txt        >> ..\%COMPUTERNAME%-result.txt


echo -----알약 체크 -------      >> ..\%COMPUTERNAME%-result.txt
tasklist | find /i "AYRTSrv"     >> ..\%COMPUTERNAME%-result.txt
echo 실시간 감시미사용:16.384k 사용:16.384k이상 >> ..\%COMPUTERNAME%-result.txt

echo -----바이로봇 체크 ----   >> ..\%COMPUTERNAME%-result.txt
win7-64-reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Hauri\VRIS2011" | find "State" > hauri.txt 
type hauri.txt | find "1122111"
IF NOT ERRORLEVEL 1 echo 하우리 백신 실시간 감시모드 사용중  >> ..\%COMPUTERNAME%-result.txt
IF ERRORLEVEL 1 echo 하우리 백신 실시간 감시 기능 미사용      >> ..\%COMPUTERNAME%-result.txt
type hauri.txt                                                >> ..\%COMPUTERNAME%-result.txt             
						   
echo ---마이크로소프트 Security Essentials 체크  --          >> ..\%COMPUTERNAME%-result.txt 
win7-64-reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft Antimalware\Real-Time Protection" | find "DisableRealtimeMonitoring" > ms-security.txt
type ms-security.txt | find "x0" 
IF NOT ERRORLEVEL 1 echo MS 백신 실시간 감시모드 사용중 	>> ..\%COMPUTERNAME%-result.txt
IF ERRORLEVEL 1 echo MS 백신 실시간 감시모드 미사용 		>> ..\%COMPUTERNAME%-result.txt
type ms-security.txt                                       >> ..\%COMPUTERNAME%-result.txt

						   
echo [PC-14] END  >> ..\%COMPUTERNAME%-result.txt
echo [PC-14] 수동   >> ..\%COMPUTERNAME%-result.txt


echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo 바이러스 백신 프로그램에서 제공하는 실시간 감시 기능 활성화                                                                       >> ..\%COMPUTERNAME%-result.txt
echo 안철수연구소 v3-lite = MonitorType = 40000009 (실시간 감시사용)       >> ..\%COMPUTERNAME%-result.txt
echo 안철수연구소 v3-internet-security = sysmon = 1 (실시간 감시 사용)        >> ..\%COMPUTERNAME%-result.txt
echo 알약실시간감시 프로세스 = AYRTSrv 미사용시 메모리크기 = 16.384k             >> ..\%COMPUTERNAME%-result.txt
echo 바이로봇 = state = 1122111 (실시간 감시사용)                             >> ..\%COMPUTERNAME%-result.txt
echo 마이크로소프트 백신 = DisableRealtimeMonitoring = 0 (실시간 감시 사용)     >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt



REM PC-15번 분기점 ############################



type systeminfo.txt | find /i "windows xp" 


IF NOT ERRORLEVEL 1 goto 64-bit-xp-15-check 

type systeminfo.txt | find /i "windows 7"

IF NOT ERRORLEVEL 1 goto 64-bit-win7-15-check



REM 64-PC-15-XP
:64-bit-xp-15-check


echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-15] OS에서 제공하는 침입차단 기능 활성화            >> ..\%COMPUTERNAME%-result.txt

echo "# HKLM\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\StandardProfile | find /i "EnableFirewall""  >> ..\%COMPUTERNAME%-result.txt
reg query "HKLM\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\StandardProfile" | find /i "EnableFirewall" > firewall.txt

type firewall.txt | find "x1" 


IF NOT ERRORLEVEL 1 echo OS 에서 제공하는 방화벽이 활성화 되어있어 양호함    >> ..\%COMPUTERNAME%-result.txt
IF ERRORLEVEL 1 echo OS 에서 제공하는 방화벽이 비활성화 되어있어 취약함    >> ..\%COMPUTERNAME%-result.txt

type firewall.txt  >> ..\%COMPUTERNAME%-result.txt


echo [PC-15] END                                                                                           >> ..\%COMPUTERNAME%-result.txt
type firewall.txt | find "x1" 
IF NOT ERRORLEVEL 1 echo [PC-15] 양호    >> ..\%COMPUTERNAME%-result.txt
IF ERRORLEVEL 1 echo [PC-15] 취약    >> ..\%COMPUTERNAME%-result.txt

del firewall.txt
										   
goto 64-bit-15-end






:64-bit-win7-15-check

REM 64-PC-15-WIN7

echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-15] OS에서 제공하는 침입차단 기능 활성화            >> ..\%COMPUTERNAME%-result.txt

echo "# HKLM\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\StandardProfile | find /i "EnableFirewall""   >> ..\%COMPUTERNAME%-result.txt
echo "# HKLM\SYSTEM\CurrentControlSet\services\SharedAccess\Parameters\FirewallPolicy\PublicProfile | find /i "EnableFirewall""      >> ..\%COMPUTERNAME%-result.txt
reg query "HKLM\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\StandardProfile" | find /i "EnableFirewall" > firewall.txt

reg query "HKLM\SYSTEM\CurrentControlSet\services\SharedAccess\Parameters\FirewallPolicy\PublicProfile" | find /i "EnableFirewall" > firewall2.txt

type firewall.txt | find "x1" 

if ERRORLEVEL 1 goto 64-bit-win7-15-fail

type firewall2.txt | find "x1" 

if ERRORLEVEL 1 goto 64-bit-win7-15-fail


echo OS 에서 제공하는 방화벽이 활성화 되어있어 양호함    >> ..\%COMPUTERNAME%-result.txt
echo --홈 또는 회사(개인)네트워크 방화벽체크--   >> ..\%COMPUTERNAME%-result.txt
type firewall.txt  >> ..\%COMPUTERNAME%-result.txt
echo --공용 네트워크 방화벽체크--    >> ..\%COMPUTERNAME%-result.txt
type firewall2.txt  >> ..\%COMPUTERNAME%-result.txt

echo [PC-15] END                                                                                           >> ..\%COMPUTERNAME%-result.txt

echo [PC-15] 양호    >> ..\%COMPUTERNAME%-result.txt

goto 64-bit-15-end

:64-bit-win7-15-fail


echo OS 에서 제공하는 방화벽이 비활성화 되어있어 취약함    >> ..\%COMPUTERNAME%-result.txt
echo --홈 또는 회사(개인)네트워크 방화벽체크--    >> ..\%COMPUTERNAME%-result.txt
type firewall.txt  >> ..\%COMPUTERNAME%-result.txt
echo --공용 네트워크 방화벽체크--               >> ..\%COMPUTERNAME%-result.txt
type firewall2.txt  >> ..\%COMPUTERNAME%-result.txt
echo [PC-15] END     >> ..\%COMPUTERNAME%-result.txt
echo [PC-15] 취약    >> ..\%COMPUTERNAME%-result.txt




:64-bit-15-end						   

del firewall.txt
del firewall2.txt
		
		
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo OS에서 제공하는 침입차단 기능 활성화  >> ..\%COMPUTERNAME%-result.txt
echo EnableFirewall = x0 - (방화벽 미사용)취약       >> ..\%COMPUTERNAME%-result.txt
echo EnableFirewall = x1 - (방화벽 사용)양호          >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt


del servicepack.txt



REM 64-PC-16

echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-16] 화면 보호기 대기 시간 설정 점검                                                                 >> ..\%COMPUTERNAME%-result.txt


reg query "HKCU\Control Panel\Desktop" | find "ScreenSaveActive"     > PC-16_64_temp.txt
reg query "HKCU\Control Panel\Desktop" | find "ScreenSaverIsSecure"  >> PC-16_64_temp.txt
reg query "HKCU\Control Panel\Desktop" | find "ScreenSaveTimeOut"    >> PC-16_64_temp.txt
TYPE PC-16_64_temp.txt                                                                       >> ..\%COMPUTERNAME%-result.txt
echo [PC-16] END                                                                              >> ..\%COMPUTERNAME%-result.txt
DEL PC-16_64_temp.txt

echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo 화면 보호기 대기 시간 설정 점검                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ScreenSaveTimeOut   = 대기 시간 설정 초 단위                                            >> ..\%COMPUTERNAME%-result.txt
echo ScreenSaveTimeOut값은 600이하 양호                                                      >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt



echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt


REM 64-PC-17
chcp 949
echo [PC-17] CD, DVD, USB메모리 등과 같은 미디어의 자동실행 방지 등 이동식 미디어에 대한 보안대책 수립   >> ..\%COMPUTERNAME%-result.txt
echo ---자동실행 체크---- (@SYS:DoesNotExist , @SYS:NoWhere)       >> ..\%COMPUTERNAME%-result.txt                                  
echo "# HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\IniFileMapping\Autorun.inf"     >> ..\%COMPUTERNAME%-result.txt
win7-64-reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\IniFileMapping\Autorun.inf"   >> ..\%COMPUTERNAME%-result.txt

echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt

echo "로컬그룹정책에서의 자동실행 방지설정 여부 체크 확인"                                                   >> ..\%COMPUTERNAME%-result.txt
echo "# HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer"        >> ..\%COMPUTERNAME%-result.txt
win7-64-reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer"      >> ..\%COMPUTERNAME%-result.txt


echo [PC-17] END  >> ..\%COMPUTERNAME%-result.txt
echo [PC-17] 수동   >> ..\%COMPUTERNAME%-result.txt

chcp 437

echo ---------- [참고] ---------------------------                                        				  >> ..\%COMPUTERNAME%-result.txt
echo CD, DVD, USB메모리 등과 같은 미디어의 자동실행 방지 등 이동식 미디어에 대한 보안대책 2가지 방안                                                                       >> ..\%COMPUTERNAME%-result.txt
echo 1. Autorun.inf의 기본값 : @SYS:DoesNotExist 또는 @SYS:NoWhere 값이 들어가있으면 양호      			 >> ..\%COMPUTERNAME%-result.txt
echo 1.  @SYS:DoesNotExist 또는 @SYS:NoWhere 값이 미출력될시 = 취약 
echo 2. 로컬그룹정책에서의 자동실행 방지설정 여부 체크 확인에 값 NoDriveTypeAutoRun 출력될경우  = 양호                                      >> ..\%COMPUTERNAME%-result.txt
echo 2. 로컬그룹정책에서의 자동실행 방지설정 여부 체크 확인에 값 NoDriveTypeAutoRun 이없을경우(다른값은 의미없음)   = 취약                                  >> ..\%COMPUTERNAME%-result.txt
echo 윈도우 home 버전은 로컬그룹정책이 없기때문에 1번항목을 봐야함                                		    >> ..\%COMPUTERNAME%-result.txt
echo NoDriveTypeAutoRun 결과값이 0xff 로 나와야함 (모든드라이브 자동실행사용안함)    >> ..\%COMPUTERNAME%-result.txt
echo NoDriveTypeAutoRun 결과값이 0xb5 로 나오면 취약함 (CD-ROM은 자동실행허용함)    >> ..\%COMPUTERNAME%-result.txt
echo 둘중 한가지라도 설정되어있으면 양호함(안행부 2014-01 가이드라인 PC-17 이미지를 참조할것)               				  >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                         			 >> ..\%COMPUTERNAME%-result.txt





REM 64-PC-18
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-18] PC 내부의 미사용(3개월) ActiveX 제거       >> ..\%COMPUTERNAME%-result.txt
dir /OD "%systemroot%\Downloaded Program Files"	|find "-"    >> ..\%COMPUTERNAME%-result.txt
                                       										   
echo [PC-18] END  >> ..\%COMPUTERNAME%-result.txt
echo [PC-18] 수동   >> ..\%COMPUTERNAME%-result.txt


echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo PC 내부의 미사용(3개월) ActiveX 제거                                                                       >> ..\%COMPUTERNAME%-result.txt
echo ActiveX 설치 디렉토리 및 파일이 랜덤함으로 자동진단 불가       >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt



REM 64-PC-19
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-19] 시스템 부팅 시 Windows Messenger가 자동으로 시작되지 않도록 설정되어 있는가?    >> ..\%COMPUTERNAME%-result.txt
echo "# HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Messenger\Client | find "PreventAutoRun""  >> ..\%COMPUTERNAME%-result.txt                                          
win7-64-reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Messenger\Client" | find "PreventAutoRun" > Messenger.txt 

type Messenger.txt | find "x1"

IF NOT ERRORLEVEL 1 echo 시스템 부팅시 Windows Messenger을 시작되지 않도록 설정되어있어 양호함    >> ..\%COMPUTERNAME%-result.txt
IF ERRORLEVEL 1 echo 시스템 부팅시 Windows Messenger을 시작하도록 설정되어있어 취약함            >> ..\%COMPUTERNAME%-result.txt
					
type Messenger.txt          >> ..\%COMPUTERNAME%-result.txt

echo [PC-19] END             >> ..\%COMPUTERNAME%-result.txt

IF NOT ERRORLEVEL 1 echo [PC-19] 양호               >> ..\%COMPUTERNAME%-result.txt
IF ERRORLEVEL 1 echo [PC-19] 취약                    >> ..\%COMPUTERNAME%-result.txt

echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                           >> ..\%COMPUTERNAME%-result.txt
echo 시스템 부팅 시 Windows Messenger가 자동으로 시작되지 않도록 설정되어 있는가?                                                                       >> ..\%COMPUTERNAME%-result.txt
echo windows 7이상 = 정책과 상관없이 메신져 Default 설치되지 않음                            >> ..\%COMPUTERNAME%-result.txt
echo windows xp    = 버전에 따라 디폴트로 메신져가 탑재되는 OS가 존재하나 구분할수없으므로 전부 정책 반영   >> ..\%COMPUTERNAME%-result.txt
echo PreventAutoRun = x0 사용안함(취약)       >> ..\%COMPUTERNAME%-result.txt
echo PreventAutoRun = x1 사용(양호)                                     >> ..\%COMPUTERNAME%-result.txt
echo home 은 해당사항없음 home 외에 값이 없으면 취약                         >> ..\%COMPUTERNAME%-result.txt
echo 해당 항목이 나온 취지는 다음과 같다. Windows패키지중 K 버전과 KN 버전이 존재한다.       >> ..\%COMPUTERNAME%-result.txt
echo K버전은 윈도우 미디어플레이 및 윈도우 메신져가 포함된 버전이었지만 국내에서 불공정      >> ..\%COMPUTERNAME%-result.txt
echo 거래로 판매를 금지하여 KN버전은 이렇한 프로그램들이 포함되지 않은 버전이다.              >> ..\%COMPUTERNAME%-result.txt
echo 즉 windows xp 에서는 이렇한 윈도우 메신져 프로그램이 기본적으로 설치되어 구동하며       >> ..\%COMPUTERNAME%-result.txt
echo 프로그램 추가/제거로 지울수도 없다. 즉 OS에 기본적으로 내장된 윈도우 메신져를 막기위한   >> ..\%COMPUTERNAME%-result.txt
echo 방안으로 탄생된 항목이다. windows 7 에서는 메신져가 설치되지 않으므로  해당설정을      >> ..\%COMPUTERNAME%-result.txt
echo 하지 않아도 양호로 판단하며 xp 에서만 해당 조취를 취하면 된다.  win7은 메신져가 포함되지 않음 >> ..\%COMPUTERNAME%-result.txt
echo 상용메신져는 수동으로 확인                                                                  >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt




REM ###############################20번 항목 분기점 ###################################################################

type systeminfo.txt | find /i "windows xp" 


IF NOT ERRORLEVEL 1 goto 64-bit-xp-20-check 

type systeminfo.txt | find /i "windows 7"

IF NOT ERRORLEVEL 1 goto 64-bit-win7-20-check






:64-bit-xp-20-check

REM 64-PC-20-XP
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-20] 원격 지원을 금지하도록 정책이 설정되어 사용되는가?                                          >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo fAllowUnsolicited 결과값이 1일 경우 취약  >> ..\%COMPUTERNAME%-result.txt
echo "# HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server"                               >> ..\%COMPUTERNAME%-result.txt
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services" | find /I "fAllowUnsolicited"	  >> ..\%COMPUTERNAME%-result.txt

echo [PC-20] END                                                         >> ..\%COMPUTERNAME%-result.txt

IF ERRORLEVEL 1 echo [PC-20] 양호                                >> ..\%COMPUTERNAME%-result.txt
IF NOT ERRORLEVEL 1 echo [PC-20] 취약                         >> ..\%COMPUTERNAME%-result.txt


echo.                                                                           >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo fAllowUnsolicited = 0 (해당 PC를 원격 데스크톱 사용안함)-양호                                                >> ..\%COMPUTERNAME%-result.txt
echo fAllowUnsolicited = 1 (해당 PC를 원격 데스크톱 사용함)-취약                                              >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                   >> ..\%COMPUTERNAME%-result.txt
echo.                                                                           >> ..\%COMPUTERNAME%-result.txt
echo.                                                                           >> ..\%COMPUTERNAME%-result.txt

GOTO 64-bit-[PC-20]-end




:64-bit-win7-20-check

REM 64-PC-20-WIN7
echo ####################################################################################### >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo [PC-20] 원격 지원을 금지하도록 정책이 설정되어 사용되는가?                                          >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo fAllowUnsolicited 결과값이 1일 경우 취약  >> ..\%COMPUTERNAME%-result.txt
echo "# HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server"                               >> ..\%COMPUTERNAME%-result.txt
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services" | find /I "fAllowUnsolicited"	  >> ..\%COMPUTERNAME%-result.txt

echo [PC-20] END                                                         >> ..\%COMPUTERNAME%-result.txt

IF ERRORLEVEL 1 echo [PC-20] 양호                                >> ..\%COMPUTERNAME%-result.txt
IF NOT ERRORLEVEL 1 echo [PC-20] 취약                         >> ..\%COMPUTERNAME%-result.txt


echo.                                                                           >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo ---------- [참고] ---------------------------                                          >> ..\%COMPUTERNAME%-result.txt
echo fAllowUnsolicited = 0 (해당 PC를 원격 데스크톱 사용안함)-양호                                                >> ..\%COMPUTERNAME%-result.txt
echo fAllowUnsolicited = 1 (해당 PC를 원격 데스크톱 사용함)-취약                                              >> ..\%COMPUTERNAME%-result.txt
echo ----------------------------------------------                   >> ..\%COMPUTERNAME%-result.txt
echo.                                                                           >> ..\%COMPUTERNAME%-result.txt
echo.                                                                           >> ..\%COMPUTERNAME%-result.txt







:64-bit-[PC-20]-end


echo PW01  >> ..\%COMPUTERNAME%-result.txt
secedit /export /CFG securitypolicy.txt >> ..\%COMPUTERNAME%-result.txt
echo security_policy 파일이 생성되었습니다. >> ..\%COMPUTERNAME%-result.txt

secedit /EXPORT /CFG ..\secedit.txt



echo PM01  >> ..\%COMPUTERNAME%-result.txt
reg query "HKLM\SOFTWARE\Microsoft\WindowsUpdate\UpdatePolicy\Settings" | findstr PausedFeatureStatus >> ..\%COMPUTERNAME%-result.txt
echo Windows OS 업데이트 확인 완료 >> ..\%COMPUTERNAME%-result.txt

echo PM03 인터넷 익스플로러 버전  >> ..\%COMPUTERNAME%-result.txt
reg query "HKLM\SOFTWARE\Microsoft\Internet Explorer" | findstr Version >> ..\%COMPUTERNAME%-result.txt
echo 인터넷 익스플로러 버전 확인 완료 >> ..\%COMPUTERNAME%-result.txt







:end-pc-check




del *.txt

									            
:END
echo ####################################   END Time  ####################################   >> ..\%COMPUTERNAME%-result.txt
date /t                                                                                      >> ..\%COMPUTERNAME%-result.txt
time /t                                                                                      >> ..\%COMPUTERNAME%-result.txt

echo ################################   APPLY SCRIPT CREATION  ###########################  
chcp 949



Echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt
echo.                                                                                        >> ..\%COMPUTERNAME%-result.txt

del %COMPUTERNAME%-result.xml
del ..\set
@echo off



echo.
echo.
echo.
echo.
echo #################################################################
echo ###                                                           ###
echo ###        Windows DeskTop Security Check is Finished          ###
echo ###                                                           ###
echo #################################################################
echo.
echo.
echo.
echo.
echo.
echo.
pause
EXIT


