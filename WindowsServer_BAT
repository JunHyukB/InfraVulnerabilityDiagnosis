::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:::::::::::::::::::::::::::::::::::::::::::::::: 공통 부분 시작:::::::::::::::::::::::::::::::::::::::::::
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

@echo off

setlocal
set script=script

TITLE Windosws Security Check

::실제 버전 확인 시작
ver > ver.txt
for /f "delims=[ tokens=2" %%i in (ver.txt) do set MV=%%i
del ver.txt 2> nul

if exist %windir%\SysWOW64 (
	set WinBit=64
) else (
	set WinBit=32
)

:: windows 2000
if "%MV:~8,3%"=="5.0" (
	set WinVer=1
	set WinVer_name=2000
	echo Windows 2000 %WinBit%bit                                                            > real_ver.txt
)

:: windows 2003
if "%MV:~8,3%"=="5.2" (
	set WinVer=2
	set WinVer_name=2003
	echo Windows 2003 %WinBit%bit                                                            > real_ver.txt
)

:: windows 2008
if "%MV:~8,3%"=="6.0" (
	set WinVer=3
	set WinVer_name=2008
	echo Windows 2008 %WinBit%bit                                                            > real_ver.txt
)

:: windows 2008 r2
if "%MV:~8,3%"=="6.1" (
	set WinVer=4
	set WinVer_name=2008_R2
	echo Windows 2008 R2 %WinBit%bit                                                         > real_ver.txt
)

:: windows 2012
if "%MV:~8,3%"=="6.2" (
	set WinVer=5
	set WinVer_name=2012
	echo Windows 2012 %WinBit%bit                                                            > real_ver.txt
)

:: windows 2012 r2
if "%MV:~8,3%"=="6.3" (
	set WinVer=6
	set WinVer_name=2012_R2
	echo Windows 2012 R2 %WinBit%bit                                                         > real_ver.txt
)

:: windows 2016
if "%MV:~8,7%"=="10.0.14" (
	set WinVer=7
	set WinVer_name=2016
	echo Windows 2016 %WinBit%bit                                                         	 > real_ver.txt
)

:: windows 2019
if "%MV:~8,7%"=="10.0.17" (
	set WinVer=8
	set WinVer_name=2019
	echo Windows 2019 %WinBit%bit                                                         	 > real_ver.txt
)

if "%MV:~8,7%"=="10.0.19" (
	set WinVer=9
	set WinVer_name=10
	echo Windows 10 %WinBit%bit                                                         	 > real_ver.txt
)

type real_ver.txt > %COMPUTERNAME%-%WinVer_name%-result.txt

:: windows 2008 이상버전은 icacls
if %WinVer% geq 3 (
	doskey cacls=icacls $*
)


::실제 버전 확인 끝


set SCRIPT_LAST_UPDATE=2020.10.25
echo ======================================================================================= >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■■■■■■■■■■■■■■■■■■■      Windows %WinVer_name% Security Check      ■■■■■■■■■■■■■■■■■■■■ >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ======================================================================================= >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo LAST_UPDATE %SCRIPT_LAST_UPDATE%                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■  Start Time  ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
date /t                                                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
time /t                                                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt     
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
::sysinfo 한글(chcp 437이후 한글 ??로 깨짐 현상 방지)
echo [+] Gathering systeminfo...
systeminfo																					 > systeminfo_ko.txt 2>nul

::영문으로 변경
chcp 437

::sysinfo 영문
systeminfo																					 > systeminfo.txt 2>nul


::시스템 정보 출력 시작
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ###############################  Interface Information  ############################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
ipconfig /all                                                                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ###############################  System Information  ################################## >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt


:: winver = 2000
if %WinVer% equ 1 (
	%script%\psinfo                                                                          > systeminfo.txt
	echo Hotfix:                                                                             >> systeminfo.txt
	reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion" | find /I "HotFix"            >> systeminfo.txt
	type systeminfo.txt                                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)

:: winver >= 2003
if %WinVer% geq 2 (
	type systeminfo_ko.txt                                                        	 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ###############################  tasklist Information  ################################ >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: winver = 2000
if %WinVer% equ 1 (
	%script%\pslist                                                                          > tasklist.txt
	type tasklist.txt	                                                             	 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt	
)

:: winver >= 2003
if %WinVer% geq 2 (
	tasklist																				 > tasklist.txt 2>nul
	type tasklist.txt	                                                             	 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt	
)
::시스템 정보 출력 끝


::백신 V3 존재여부 확인
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo #################################  AhnLab V3 Path Check  ################################## >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

IF EXIST "C:\Program Files\AhnLab\V3NET90" (
	::cacls C:\Program Files\AhnLab\V3NET90                                                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	dir "C:\Program Files\AhnLab\V3NET90"                                                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
) ELSE (
	echo C:\Program Files\AhnLab\V3NET90 디렉터리가 존재하지 않음.                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)

echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

::백신 V3 존재여부 확인 끝

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:::::::::::::::::::::::::::::::::::::::::::::::: 공통 부분 끝:::::::::::::::::::::::::::::::::::::::::::::
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::



::취약점 진단 항목 스크립트 시작

::1. 계정 관리 시작
echo [+] Windows Security Check is start
echo.
echo [+] 1. Account management
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##########################         1. 계정 관리        ################################ >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-01 START                                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-01
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################        Administrator 계정 이름 바꾸기         ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: Administrator 계정 이름을 변경하여 사용하는 경우 양호                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net localgroup Administrators | findstr /V "Comment Members completed" | findstr .           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-01 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-02 START                                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-02
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo #################               GUEST 계정 상태                ######################## >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: Guest 계정 비활성화일 경우 양호                                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net user guest | find "User name"                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net user guest | find "Account active"                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-02 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-03 START                                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-03
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################              불필요한 계정 제거               ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 불필요한 계정이 존재하지 않을 경우                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ****************************  User Accounts List  *****************************         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net user | find /V "successfully" | findstr .                                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo *****************************  Account Information  ***************************         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        > account.txt 2>nul
FOR /F "tokens=1,2,3 skip=4" %%i IN ('net user') DO (
echo -------------------------------------------------------------------------------         >> account.txt 2>nul
net user %%i >> account.txt 2>nul
echo -------------------------------------------------------------------------------         >> account.txt 2>nul
net user %%j >> account.txt 2>nul
echo -------------------------------------------------------------------------------         >> account.txt 2>nul
net user %%k >> account.txt 2>nul
)
findstr "User active Comment Last --" account.txt                                            > account_temp1.txt
findstr /v "change profile Memberships User's" account_temp1.txt                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-03 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-04 START                                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-04
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################            계정 잠금 임계값 설정             ####################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 로그온 실패 수를 제한하는 계정 잠금 임계값 설정이 5번 이하인 경우 양호          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net accounts > net-accounts.txt 
type net-accounts.txt | find "Lockout threshold"                                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-04 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-05 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-05
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################    해독 가능한 암호화를 사용하여 암호 저장    ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: "해독 가능한 암호화를 사용하여 암호 저장" 정책이 "사용안함"으로 설정된 경우 양호 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (ClearTextPassword = 0 일 경우 양호)                                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
secedit /EXPORT /CFG Local_Security_Policy.txt >nul
type Local_Security_Policy.txt | Find /I "ClearTextPassword"                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-05 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-06 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-06
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################      관리자 그룹에 최소한의 사용자 포함        ##################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: Administratios 그룹에 불필요한 계정이 존재 하지 않을 경우 양호                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net localgroup Administrators | findstr /V "Comment Members completed" | findstr .           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        > admin-account.txt 2>nul
echo *********************  Administrators Account Information  ********************         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
FOR /F "tokens=1,2,3,4 skip=6" %%j IN ('net localgroup administrators') DO (
net user %%j %%k %%l %%m >> admin-account.txt 2>nul
echo -------------------------------------------------------------------------------         >> admin-account.txt 2>nul
)
findstr c/:"User name | Account active | Last logon | -----" admin-account.txt               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-06 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-46 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-46
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ################     Everyone 사용 권한을 익명 사용자에게 적용          ############### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준 : “Everyone 사용 권한을 익명 사용자에게 적용” 정책이 “사용안함” 으로 되어 있을 경우 양호 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo 		: (EveryoneIncludesAnonymous=4,0 이면 양호)                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: winver = 2000
if %WinVer% equ 1 (
	echo Win 2000 해당사항 없음                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: winver >= 2003
if %WinVer% geq 2 (
	type Local_Security_Policy.txt | Find /I "EveryoneIncludesAnonymous"                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-46 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-47 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-47
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo #################              계정 잠금 기간 설정              ####################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 계정 잠금 기간 60분, 계정 잠금 기간 원래대로 설정 60분                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
type net-accounts.txt | find "Lockout duration"                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
type net-accounts.txt | find "Lockout observation"                                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-47 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-48 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-48
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo #################             패스워드 복잡성 설정              ####################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: "암호는 복잡성을 만족해야 함" 정책이 "사용" 으로 되어 있을 경우 양호            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (PasswordComplexity = 1 일 경우 양호)                                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
type Local_Security_Policy.txt | Find /I "PasswordComplexity"                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-48 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-49 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-49
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo #################            패스워드 최소 암호 길이            ####################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 최소 암호 길이 설정이 8자 이상인 경우 양호                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
type net-accounts.txt | find "length"                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-49 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-50 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-50
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo #################            패스워드 최대 사용 기간           ######################## >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 최대 암호 사용 기간 설정이 90일 이하인 경우 양호                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 	: 할성화된 계정(Account active:Yes)의 암호 만료 날짜가 (Password expires:Never) 일 경우 취약             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
type net-accounts.txt | find "Maximum password"                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
type account.txt | findstr "User active expires Last --"                        			 > account_temp2.txt
type account_temp2.txt | findstr /v "change profile Memberships User's" | findstr "User active Password Last --" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-50 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-51 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-51
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo #################           패스워드 최소 사용 기간            ######################## >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 계정의 패스워드 사용기간이 최소 1일 이상일 경우 양호                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
type net-accounts.txt | find "Minimum password age"                                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-51 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-52 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-52
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo #################         마지막 사용자 이름 표시 안함         ######################## >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: "마지막 사용자 이름 표시 안함" 정책이 "사용"으로 설정되어 있을 경우 양호        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (DontDisplayLastuserName = 1 일 경우 양호)                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" | find /I "DontDisplayLastuserName" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-52 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-53 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-53
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################               로컬 로그온 허용               ####################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: "로컬 로그온 허용" 정책에 "Administrators", "IUSR_" 만 존재할 경우 양호         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (Administrators = *S-1-5-32-544), (IUSR = *S-1-5-17)                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (Users = *S-1-5-32-545), (Guests = *S-1-5-132-546)                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (Power Users = *S-1-5-32-547), (Backup Opertators = *S-1-5-32-551)           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
type Local_Security_Policy.txt | Find /I "SeInteractiveLogonRight"                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-53 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-54 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-54
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################           익명 SID/이름 변환 허용            ####################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: "익명 SID/이름 변환 허용" 정책이 "사용 안 함" 으로 되어 있을 경우 양호          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (LSAAnonymousNameLookup = 0 일 경우 양호)                                     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: winver = 2000
if %WinVer% equ 1 (
	echo Win 2000 해당사항 없음                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: winver >= 2003
if %WinVer% geq 2 (
	type Local_Security_Policy.txt | Find /I "LSAAnonymousNameLookup"                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-54 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-55 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-55
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################                최근 암호 기억                ####################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 계정의 최근 사용한 패스워드 기억 설정이 12개 이상인 경우 양호                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
type net-accounts.txt | find "history"                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-55 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-56 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-56
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################  콘솔 로그온 시 로컬 계정에서 빈 암호 사용 제한  ################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: "콘솔 로그온 시 로컬 계정에서 빈 암호 사용 제한" 정책이 "사용"으로 되어 있을 경우 양호 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (LimitBlankPasswordUse = 4,1 일 경우 양호)                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
rem 결과 값이 존재하지 않으면 Default 설정 적용(Default 설정: LimitBlankPasswordUse 1 양호)
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: winver = 2000
if %WinVer% equ 1 (
	echo Win 2000 해당사항 없음                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: winver >= 2003
if %WinVer% geq 2 (
	type Local_Security_Policy.txt | Find /I "LimitBlankPasswordUse"                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-56 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-57 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-57
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################    원격터미널 접속 가능한 사용자 그룹 제한    ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 원격 터미널 접속이 가능한 Administrators그룹과 Remote Desktop Users그룹에       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : 불필요한 계정이 등록되어 있지 않은 경우 양호                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: winver = 2000
if %WinVer% equ 1 (
	echo Win 2000 해당사항 없음                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: winver >= 2008_R2
if %WinVer% geq 4 (
	net start | find /i "Remote Desktop Services" >nul
	IF NOT ERRORLEVEL 1 (
		echo ☞ Remote Desktop Services Enable                                          	>> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo.                                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo ☞ 원격 터미널 접속 허용 계정                                                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		net localgroup "Administrators" | findstr /V "Comment Members completed" | findstr .         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		net localgroup "Remote Desktop Users" | findstr /V "Comment Members completed" | findstr .   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		)
	IF ERRORLEVEL 1 (
		echo ☞ Remote Desktop Services Disable                                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		)
) else (
	NET START | FIND "Terminal Service" > NUL
	IF NOT ERRORLEVEL 1 (
		echo ☞ Terminal Service Enable                                          			>> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo.                                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo ☞ 원격 터미널 접속 허용 계정                                                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		net localgroup "Administrators" | findstr /V "Comment Members completed" | findstr .         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		net localgroup "Remote Desktop Users" | findstr /V "Comment Members completed" | findstr .   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		)
	IF ERRORLEVEL 1 (
		echo ☞ Terminal Service Disable                                             		 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		)
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-57 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
::1. 계정 관리 끝

::2. 서비스 관리 시작
echo.
echo [+] 2. Service management
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##########################        2. 서비스 관리       ################################ >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-07 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-07
chcp 949
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################          공유 권한 및 사용자 그룹 설정        ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 일반공유 디렉터가 없거나 공유 디렉토리 접근 권한에 Everyone이 없을 경우 양호    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net share | find /v "$" | find /v "명령"			                                      	 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net share | find /v "$" | find /v "명령" | find /v "-"                                    	 > inf_share_folder.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ☞ cacls 결과                                                                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: winver = 2000
if %WinVer% equ 1 (
	FOR /F "tokens=2 skip=3" %%j IN (inf_share_folder.txt) DO cacls %%j                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt 2>nul
)
:: winver >= 2003
if %WinVer% geq 2 (	
::::::::::::::::::::::::::::::::추가부분
	echo.                                                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	for /f "tokens=2 skip=3" %%j in (inf_share_folder.txt) do (
		echo [Share Dir] %%j                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo -----------------------------------------------------                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		call cacls %%j                                                                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	)
:::::::::::::::::::::::::::::::::::::::
	fsutil fsinfo drives 																	 > inf_using_drv_temp1.txt
	type inf_using_drv_temp1.txt | find /i "\" 												 > inf_using_drv_temp2.txt

	echo.																					 > inf_using_drv_temp3.txt
	FOR /F "tokens=1-26" %%a IN (inf_using_drv_temp2.txt) DO (
		echo %%a >> inf_using_drv_temp3.txt
		echo %%b >> inf_using_drv_temp3.txt
		echo %%c >> inf_using_drv_temp3.txt
		echo %%d >> inf_using_drv_temp3.txt
		echo %%e >> inf_using_drv_temp3.txt
		echo %%f >> inf_using_drv_temp3.txt
		echo %%g >> inf_using_drv_temp3.txt
		echo %%h >> inf_using_drv_temp3.txt
		echo %%i >> inf_using_drv_temp3.txt
		echo %%j >> inf_using_drv_temp3.txt
		echo %%k >> inf_using_drv_temp3.txt
		echo %%l >> inf_using_drv_temp3.txt
		echo %%m >> inf_using_drv_temp3.txt
		echo %%n >> inf_using_drv_temp3.txt
		echo %%o >> inf_using_drv_temp3.txt
		echo %%p >> inf_using_drv_temp3.txt
		echo %%q >> inf_using_drv_temp3.txt
		echo %%r >> inf_using_drv_temp3.txt
		echo %%s >> inf_using_drv_temp3.txt
		echo %%t >> inf_using_drv_temp3.txt
		echo %%u >> inf_using_drv_temp3.txt
		echo %%v >> inf_using_drv_temp3.txt
		echo %%w >> inf_using_drv_temp3.txt
		echo %%x >> inf_using_drv_temp3.txt
		echo %%y >> inf_using_drv_temp3.txt
		echo %%z >> inf_using_drv_temp3.txt
	)
	type inf_using_drv_temp3.txt | find /i "\" | find /v "A:\" 								 > inf_using_drv.txt
	
	FOR /F "tokens=1" %%a IN (inf_using_drv.txt) DO (
		type inf_share_folder.txt | find "%%a"												 >> inf_share_folder_temp.txt
	)
	
	sed "s/   */?/g" inf_share_folder_temp.txt 							 > inf_share_folder_temp_sed.txt
	type inf_share_folder_temp_sed.txt | findstr "^?"										 > inf_share_folder_temp_sed2.txt
	
	for /F "tokens=2 delims=?" %%a in (inf_share_folder_temp_sed.txt) do cacls ^"%%a^"		 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	for /F "tokens=1 delims=?" %%a in (inf_share_folder_temp_sed2.txt) do cacls ^"%%a^"		 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
chcp 437
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-07 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-08 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-08
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################            하드디스크 기본 공유 제거          ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 기본공유 항목(C$, D$)이 존재하지 않고 해당 레지스트리가 0일 경우 양호           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ☞ 하드디스크 기본 공유 확인                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ---------------------------------------------------------------------------------       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net share | FIND /V "IPC$" | FIND /V "command PRINT$ FAX$" | FIND "$" | findstr /I "^[A-Z]"  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ☞ Registry 설정								                                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ---------------------------------------------------------------------------------       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

::Windows Server
reg query "HKLM\SYSTEM\CurrentControlSet\Services\lanmanserver\parameters" | findstr /I "AutoShareServer" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

::Windows NT
reg query "HKLM\SYSTEM\CurrentControlSet\Services\lanmanserver\parameters" | findstr /I "AutoShareWks" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-08 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-09 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-09
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################              불필요한 서비스 제거             ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 시스템에서 필요하지 않는 취약한 서비스가 중지되어 있을 경우 양호                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (1) Alerter(서버에서 클라이언트로 경고메세지를 보냄)                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (2) Clipbook(서버내 Clipbook를 다른 클라이언트와 공유)                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (3) Messenger(Net send 명령어를 이용하여 클라이언트에 메시지를 보냄)          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (4) Simple TCP/IP Services(Echo, Discard, Character, Generator, Daytime, 등)  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net start | findstr "Alerter ClipBook Messenger"                                             > service.txt
net start | find "Simple TCP/IP Services"                                                    >> service.txt
net start | findstr "Messenger" 															>> service.txt
net start | findstr /I "Alerter ClipBook Messenger TCP/IP" service.txt > NUL
IF ERRORLEVEL 1 ECHO ☞ 불필요한 서비스가 존재하지 않음.                                     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
IF NOT ERRORLEVEL 1 (
echo ☞ 아래와 같은 불필요한 서비스가 발견되었음.                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
type service.txt                                                                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-09 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-10 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-10
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################             IIS 서비스 구동 점검             ####################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준 : IIS 서비스가 불필요하게 동작하지 않는 경우 양호(담당자 인터뷰)                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net start | find /i "world wide web publishing" > nul
if not errorlevel 1 (
	echo ☞ IIS Service Enable                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo IIS Enable                                                                           > iis-enable.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	net start | find /i "world wide web publishing"									>> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-04-enable
) else (
	echo ☞ IIS Service Disable                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-04-end
)

:2-04-enable
:: IIS Version 구하기
reg query "HKLM\SYSTEM\CurrentControlSet\Services\W3SVC\Parameters" | find /i "version" > iis-version.txt
type iis-version.txt | find /i "major"                                                        > iis-version-major.txt
for /f "tokens=3" %%a in (iis-version-major.txt) do set iis_ver_major=%%a
del iis-version-major.txt 2> nul

:: WebSite List 구하기 ( website-list.txt )
:: iis ver >= 7
if %iis_ver_major% geq 7 (
	%systemroot%\System32\inetsrv\appcmd list site | find /i "http"                             > website-list.txt
)
:: iis ver <= 6
if %iis_ver_major% leq 6 (
	cscript %script%\adsutil.vbs enum W3SVC | find /i "W3SVC" | findstr /i /v "FILTERS APPPOOLS INFO" > website-list.txt
)

:: WebSite Name 구하기 ( website-name.txt )
:: iis ver >= 7
if %iis_ver_major% geq 7 (
	for /f "tokens=1 delims=(" %%a in (website-list.txt) do (
		for /f "tokens=2-11 delims= " %%b in ("%%a") do (
			echo %%b %%c %%d %%e %%f %%g %%h %%i %%j %%k                                         >> website-name.txt
		)
	)
)
:: iis ver <= 6
if %iis_ver_major% leq 6 (
	for /f "tokens=1 delims=[]" %%i in (website-list.txt) do (
		cscript %script%\adsutil.vbs enum %%i | findstr /i "ServerComment ServerAutoStart"       >> website-name.txt
		cscript %script%\adsutil.vbs enum %%i/ROOT | find "AppRoot"                              >> website-name.txt
		echo -----------------------------------------------------------------------			 >> website-name.txt
	)
)

:: Web Site physicalpath 구하기 ( website-physicalpath.txt )
:: iis ver >= 7
if %iis_ver_major% geq 7 (
	%systemroot%\System32\inetsrv\appcmd list config -section:system.applicationHost/sites | find /i "physicalpath" > website-physicalpath-temp.txt
	for /f "tokens=3 delims= " %%a in (website-physicalpath-temp.txt) do (
		for /f "tokens=2 delims==" %%b in ("%%a") do echo %%~b >> website-physicalpath.txt
	)
	del website-physicalpath-temp.txt 2> nul
)
:: iis ver <= 6
if %iis_ver_major% leq 6 (
	for /f "tokens=1 delims=[]" %%i in (website-list.txt) do (
		cscript %script%\adsutil.vbs enum %%i/root | find /i "path" | find /i /v "AspEnableParentPaths" >> website-physicalpath-temp.txt
	)
	for /f "tokens=4-8 delims= " %%i in (website-physicalpath-temp.txt) do (
		echo %%i %%j %%k %%l %%m                                                              >> website-physicalpath.txt
	)
	del website-physicalpath-temp.txt 2> nul
)

echo [IIS Version 확인]                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo -----------------------------------------------------                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
type iis-version.txt                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo [등록 사이트]                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo -----------------------------------------------------                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: iis ver >= 7
if %iis_ver_major% geq 7 (
	type website-list.txt                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: iis ver <= 6
if %iis_ver_major% leq 6 (
	type website-name.txt                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

:2-04-end
echo W-10 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-11 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-11
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ###################           IIS 디렉토리 리스팅 제거           ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준 : 기본 설정 및 사이트별 "디렉터리 검색" 설정이 False 이면 양호                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
if exist iis-enable.txt (
	echo ☞ IIS Service Enable                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-05-enable
) else (
	echo ☞ IIS Service Disable                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-05-end
)

:2-05-enable

echo [등록 사이트]                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo -----------------------------------------------------                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: iis ver >= 7
if %iis_ver_major% geq 7 (
	type website-list.txt                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: iis ver <= 6
if %iis_ver_major% leq 6 (
	type website-name.txt                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo [기본 설정]                                                                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo -----------------------------------------------------                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: iis ver >= 7
if %iis_ver_major% geq 7 (
	%systemroot%\System32\inetsrv\appcmd list config | find /i "directoryBrowse"             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: iis ver <= 6
if %iis_ver_major% leq 6 (
	cscript %script%\adsutil.vbs get W3SVC/EnableDirBrowsing  | find /i /v "Microsoft"      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo *** 사이트별 설정 확인                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: iis ver >= 7
if %iis_ver_major% geq 7 (
	for /f "delims=" %%i in (website-name.txt) do (
		echo [WebSite Name] %%i                                                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo -----------------------------------------------------                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		%systemroot%\System32\inetsrv\appcmd list config "%%i" | find /i "directoryBrowse"       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo.                                                                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	)
)
:: iis ver <= 6
if %iis_ver_major% leq 6 (
	for /f "tokens=1 delims=[]" %%i in (website-list.txt) do (
		echo [WebSite AppRoot] %%i                                                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo -----------------------------------------------------                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		cscript %script%\adsutil.vbs enum %%i/root | find /i "EnableDirBrowsing" > nul
		if not errorlevel 1 (
			cscript %script%\adsutil.vbs enum %%i/root | find /i "EnableDirBrowsing"         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
			echo.                                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		) else (
			echo * 기본 설정이 적용되어 있음.                                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
			echo.                                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		)
	)
)

:2-05-end
echo W-11 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-12 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-12
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ###################               IIS CGI 실행 제한              ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준 : C:\inetpub\scripts 와 C:\inetpub\cgi-bin 디렉터리를 사용하지 않는 경우 양호     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : 사용 시 Everyone에 모든권한, 수정권한, 쓰기권한이 부여되어 있지 않은 경우 양호  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
if exist iis-enable.txt (
	echo ☞ IIS Service Enable                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
) else (
	echo ☞ IIS Service Disable                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

IF EXIST C:\inetpub\scripts (
	cacls C:\inetpub\scripts                                                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
) ELSE (
	echo C:\inetpub\scripts 디렉터리가 존재하지 않음.                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)

IF EXIST C:\inetpub\cgi-bin (
	cacls C:\inetpub\cgi-bin                                                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
) ELSE (
	echo C:\inetpub\cgi-bin 디렉터리가 존재하지 않음.                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo W-12 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-13 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-13
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ###################          IIS 상위 디렉토리 접근 금지         ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준 : "상위 경로 사용" 옵션이 체크되어 있지 않을 경우 양호                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : (asp enableParentPaths="false" 인 경우 양호)                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
if exist iis-enable.txt (
	echo ☞ IIS Service Enable                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-07-enable
) else (
	echo ☞ IIS Service Disable                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-07-end
)

:2-07-enable
echo [등록 사이트]                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo -----------------------------------------------------                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: iis ver >= 7
if %iis_ver_major% geq 7 (
	type website-list.txt                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: iis ver <= 6
if %iis_ver_major% leq 6 (
	type website-name.txt                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo [기본 설정]                                                                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo -----------------------------------------------------                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: iis ver >= 7
if %iis_ver_major% geq 7 (
	%systemroot%\System32\inetsrv\appcmd list config /section:asp | find /i "enableParentPaths" > nul
	IF NOT ERRORLEVEL 1 (
		%systemroot%\System32\inetsrv\appcmd list config /section:asp | find /i "enableParentPaths" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	) ELSE (
		echo * 설정값 없음 * 기본설정 : enableParentPaths=false                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	)
)
:: iis ver <= 6
if %iis_ver_major% leq 6 (
	cscript %script%\adsutil.vbs get W3SVC/AspEnableParentPaths  | find /i /v "Microsoft"    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo *** 사이트별 설정 확인                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: iis ver >= 7
if %iis_ver_major% geq 7 (
	for /f "delims=" %%i in (website-name.txt) do (
		%systemroot%\System32\inetsrv\appcmd list config %%i /section:asp | find /i "enableParentPaths" > nul
		echo [WebSite Name] %%i                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo -----------------------------------------------------                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		if not errorlevel 1 (
			%systemroot%\System32\inetsrv\appcmd list config %%i /section:asp | find /i "enableParentPaths" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
			echo.                                                                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		) else (
			echo * 설정값 없음 * 기본설정 : enableParentPaths=false                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
			echo.                                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		)
	)
)
:: iis ver <= 6
if %iis_ver_major% leq 6 (
	for /f "tokens=1 delims=[]" %%i in (website-list.txt) do (
		echo [WebSite AppRoot] %%i                                                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo -----------------------------------------------------                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		cscript %script%\adsutil.vbs enum %%i/root | find /i "AspEnableParentPaths" > nul
		if not errorlevel 1 (
			cscript %script%\adsutil.vbs enum %%i/root | find /i "AspEnableParentPaths"     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
			echo.                                                                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		) else (
			echo AspEnableParentPaths : * 기본 설정이 적용되어 있음.                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
			echo.                                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		)
	)
)

:2-07-end
echo W-13 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-14 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-14
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ###################            IIS 불필요한 파일 제거            ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준 : IISSamples, IISHelp 가상디렉터리가 존재하지 않을 경우 양호                     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo 		: IIS 7.0 이상 버전 해당 사항 없음						                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
if exist iis-enable.txt (
	echo ☞ IIS Service Enable                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-08-enable
) else (
	echo ☞ IIS Service Disable                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-08-end
)

:2-08-enable
echo [가상 디렉터리 설정 현황]                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo -----------------------------------------------------                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: iis ver >= 7
if %iis_ver_major% geq 7 (
	echo ☞ IIS 7.0 이상 버전 해당 사항 없음							                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)

::20160114 수정함(해당사항 없음으로 변경함)
::if %iis_ver_major% geq 7 (
	::%systemroot%\System32\inetsrv\appcmd list config -section:system.applicationHost/sites | find /i "virtualdirectory" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
::)

::20160114 수정함(IISSample 등 없는지 판단가능하게 변경함)
:: iis ver <= 6
::if %iis_ver_major% leq 6 (
	::reg query "HKLM\SYSTEM\CurrentControlSet\Services\W3SVC\Parameters" | find /I "Virtual Roots" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
::)

if %iis_ver_major% leq 6 (
	reg query "HKLM\SYSTEM\CurrentControlSet\Services\W3SVC\Parameters\Virtual Roots" | findstr "IISSamples IISHelp" >> sample-app.txt
	type sample-app.txt                                                                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	findstr "IISSamples IISHelp" sample-app.txt > NUL
	IF ERRORLEVEL 1 (
		ECHO * 점검결과: IISSamples, IISHelp 가상디렉터리가 존재하지 않음.                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	)	ELSE (
		ECHO * 점검결과: IISSamples, IISHelp 가상디렉터리가 존재함.                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	)
)

echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

:2-08-end
echo W-14 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-15 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-15
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ###################          IIS 웹 프로세스 권한 제한           ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준 : IIS 서비스 동작 계정이 관리자 계정으로 등록되어 있지 않으면 양호                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
if exist iis-enable.txt (
	echo ☞ IIS Service Enable                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
) else (
	echo ☞ IIS Service Disable                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo [World Wide Web Publishing Service 동작 계정]                                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo -----------------------------------------------------                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\SYSTEM\CurrentControlSet\Services\W3SVC" | find /I "ObjectName"                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo [IIS Admin Service 동작 계정]                                                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo -----------------------------------------------------                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\SYSTEM\CurrentControlSet\Services\IISADMIN" | find /I "ObjectName"              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo W-15 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-16 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-16
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ###################               IIS 링크 사용금지              ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준 : 웹 사이트 홈디렉터리에 심볼릭 링크, aliases, *.lnk 파일이 존재하지 않으면 양호 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
if exist iis-enable.txt (
	echo ☞ IIS Service Enable                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-10-enable
) else (
	echo ☞ IIS Service Disable                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-10-end
)

:2-10-enable
echo [등록 사이트]                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo -----------------------------------------------------                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: iis ver >= 7
if %iis_ver_major% geq 7 (
	type website-list.txt                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: iis ver <= 6
if %iis_ver_major% leq 6 (
	type website-name.txt                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

:: iis ver >= 7
if %iis_ver_major% geq 7 (
	echo [홈디렉토리 정보 - WEB/FTP 구분용]                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo -----------------------------------------------------                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	%systemroot%\System32\inetsrv\appcmd list config -section:system.applicationHost/sites | findstr /i "name protocol physicalpath" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)

echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo *** 사이트별 불필요 파일 체크                                                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
for /f "delims=" %%a in (website-physicalpath.txt) do (
	echo [Website HomeDir] %%a                                                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo -----------------------------------------------------                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	call cd /d %%a
	attrib /s | find /i ".lnk"                                                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	cd /d %~dp0 
	echo.                                                                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ※ 결과 값이 존재하지 않으면 양호                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

:2-10-end
echo W-16 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-17 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-17
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ###################       IIS 파일 업로드 및 다운로드 제한       ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준 : 웹 서비스의 서버 자원관리를 위해 업로드 및 다운로드 용량을 제한한 경우 양호     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 참고 : 7.0이상(maxAllowedContentLength: 콘텐츠 용량 제한 설정 /Default: 30MB)                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : 7.0이상(MaxRequestEntityAllowed: 파일 업로드 용량 제한 설정 /Default: 200000 bytes)    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : 7.0이상(bufferingLimit: 파일 다운로드 용량 제한 설정 /Default: 4MB(4194304 bytes))     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : 6.0이하(AspMaxRequestEntityAllowed : 업로드 용량 제한 설정 /Default: 200KB(204800 byte)) >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : 6.0이하(AspBufferingLimit : 다운로드 용량 제한 설정 /Default: 4MB(4194304 byte)) >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
if exist iis-enable.txt (
	echo ☞ IIS Service Enable                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-11-enable
) else (
	echo ☞ IIS Service Disable                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-11-end
)

:2-11-enable
echo [등록 사이트]                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo -----------------------------------------------------                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: iis ver >= 7
if %iis_ver_major% geq 7 (
	type website-list.txt                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: iis ver <= 6
if %iis_ver_major% leq 6 (
	type website-name.txt                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo [기본 설정]                                                                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo -----------------------------------------------------                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: iis ver >= 7
if %iis_ver_major% geq 7 (
	%systemroot%\System32\inetsrv\appcmd list config | findstr /i "maxAllowedContentLength maxRequestEntityAllowed bufferingLimit" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: iis ver <= 6
if %iis_ver_major% leq 6 (
	cscript %script%\adsutil.vbs enum W3SVC | findstr /i "AspMaxRequestEntityAllowed AspBufferingLimit" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo * 값이 없을 경우 기본 설정이 적용되어 있음.                                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo *** 사이트별 설정 확인                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: iis ver >= 7
if %iis_ver_major% geq 7 (
	for /f "delims=" %%a in (website-name.txt) do (
		echo [WebSite Name] %%a                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo -----------------------------------------------------                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		%systemroot%\System32\inetsrv\appcmd list config %%a | findstr /i "maxAllowedContentLength maxRequestEntityAllowed bufferingLimit" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo * 값이 없을 경우 기본 설정이 적용되어 있음.                                     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo.                                                                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	)
)
:: iis ver <= 6
if %iis_ver_major% leq 6 (
	for /f "tokens=1 delims=[]" %%i in (website-list.txt) do (
		echo [WebSite AppRoot] %%i                                                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo -----------------------------------------------------                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		cscript %script%\adsutil.vbs enum %%i | find /i "AspMaxRequestEntityAllowed" > nul
		if not errorlevel 1 (
			cscript %script%\adsutil.vbs enum %%i | find /i "AspMaxRequestEntityAllowed"  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		) else (
			echo AspMaxRequestEntityAllowed : * 기본 설정이 적용되어 있음.                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		)
		cscript %script%\adsutil.vbs enum %%i | find /i "AspBufferingLimit" > nul
		if not errorlevel 1 (
			cscript %script%\adsutil.vbs enum %%i | find /i "AspBufferingLimit"           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
			echo.                                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		) else (
			echo AspBufferingLimit          : * 기본 설정이 적용되어 있음.                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
			echo.                                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		)
	)
)

:2-11-end
echo W-17 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-18 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-18
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ###################           IIS DB 연결 취약점 점검            ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준 : 7.0이상- 요청 필터링에서 .asa, .asax 확장자가 False로 설정되어 있으면 양호     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : 7.0이상- 요청 필터링에서 .asa, .asax 확장자가 True로 설정되어 있을 경우        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : 7.0이상- .asa, .asax 매핑이 등록되어 있어야 양호                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : 7.0이상-(만약, Global.asa 파일을 사용하지 않는 경우 해당 사항 없음.)           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : 7.0이상-(1) fileExtension=".asa" allowed="false" 이면 양호                     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : 7.0이상-(2) fileExtension=".asa" allowed="true" 이면, .asa 맵핑 확인           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 	    : 6.0이하- .asa 매핑이 존재할 경우 양호                                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : 6.0이하- (설정 예) ".asa,C:\WINDOWS\system32\inetsrv\asp.dll,5,GET,HEAD,POST,TRACE" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : 6.0이하- GET,HEAD,POST,TRACE 동사: 다음으로 제한								 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
if exist iis-enable.txt (
	echo ☞ IIS Service Enable                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-12-enable
) else (
	echo ☞ IIS Service Disable                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-12-end
)

:2-12-enable
echo [등록 사이트]                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo -----------------------------------------------------                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: iis ver >= 7
if %iis_ver_major% geq 7 (
	type website-list.txt                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: iis ver <= 6
if %iis_ver_major% leq 6 (
	type website-name.txt                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo [기본 설정]                                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo -----------------------------------------------------                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: iis ver >= 7
if %iis_ver_major% geq 7 (
	%systemroot%\System32\inetsrv\appcmd list config | find /i ".asa" | find /i /v "httpforbiddenhandler" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: iis ver <= 6
if %iis_ver_major% leq 6 (
	cscript %script%\adsutil.vbs enum W3SVC | find /i ".asa"                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo *** 사이트별 설정 확인                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: iis ver >= 7
if %iis_ver_major% geq 7 (
	for /f "delims=" %%a in (website-name.txt) do (
		echo [WebSite Name] %%a                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo -----------------------------------------------------                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		%systemroot%\System32\inetsrv\appcmd list config %%a | find /i ".asa" | find /i /v "httpforbiddenhandler" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo.                                                                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	)
)
:: iis ver <= 6
if %iis_ver_major% leq 6 (
	for /f "tokens=1 delims=[]" %%i in (website-list.txt) do (
		echo [WebSite AppRoot] %%i                                                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo -----------------------------------------------------                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		cscript %script%\adsutil.vbs enum %%i/root | find /i ".asa" > nul
		if not errorlevel 1 (
			cscript %script%\adsutil.vbs enum %%i/root | find /i ".asa"                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
			echo.                                                                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		) else (
			cscript %script%\adsutil.vbs enum %%i/root | find /i "ScriptMaps" > nul
			if not errorlevel 1 (
				echo .asa 맵핑이 등록되어 있지 않음. [취약]                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
				echo.                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
			) else (
				echo * 기본 설정이 적용되어 있음.                                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
				echo.                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
			)
		)
	)
)

:2-12-end
echo W-18 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-19 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-19
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ###################            IIS 가상 디렉토리 삭제            ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준 : 해당 웹사이트에 IIS Admin, IIS Adminpwd 가상 디렉터리가 존재하지 않을 경우 양호 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo        : IIS 6.0 이상 버전 해당 사항 없음 												 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
if exist iis-enable.txt (
	echo ☞ IIS Service Enable                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-13-enable
) else (
	echo ☞ IIS Service Disable                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-13-end
)

:2-13-enable
echo [가상 디렉터리 설정 현황]                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo -----------------------------------------------------                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
rem ##########20160114 6.0 이상 해당 사항 없음으로 소스 수정 시작##########
:: iis ver >= 6
if %iis_ver_major% geq 6 (
echo ☞ IIS 6.0 이상 버전 해당 사항 없음 												 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt	
)

:: iis ver < 5
if %iis_ver_major% lss 5 (
	reg query "HKLM\SYSTEM\CurrentControlSet\Services\W3SVC\Parameters" |find /I "Virtual Roots" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)

echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
rem ##########20160114 6.0 이상 해당 사항 없음으로 소스 수정 끝##########


rem ##########20160114 6.0 이상 해당 사항 없음으로 소스 삭제 시작##########
:: iis ver >= 7
::if %iis_ver_major% geq 7 (
	::%systemroot%\System32\inetsrv\appcmd list config -section:system.applicationHost/sites | find /i "virtualdirectory" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
::)
:: iis ver <= 6
::if %iis_ver_major% leq 6 (
	::reg query "HKLM\SYSTEM\CurrentControlSet\Services\W3SVC\Parameters" | find /I "Virtual Roots" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
::)
rem ##########20160114 6.0 이상 해당 사항 없음으로 소스 삭제 끝##########

:2-13-end
echo W-19 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-20 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-20
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ###################           IIS 데이터 파일 ACL 적용           ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준 : 홈 디렉터리 내에 있는 파일들에 대해 Everyone 권한이 존재하지 않을 경우 양호   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : (정적컨텐트 파일은 Read 권한만)                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
if exist iis-enable.txt (
	echo ☞ IIS Service Enable                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-14-enable
) else (
	echo ☞ IIS Service Disable                                                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-14-end
)

:2-14-enable
echo [등록 사이트]                                                                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo -----------------------------------------------------                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: iis ver >= 7
if %iis_ver_major% geq 7 (
	type website-list.txt                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: iis ver <= 6
if %iis_ver_major% leq 6 (
	type website-name.txt                                                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo *** 사이트별 파일 Everyone 권한 체크                                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo (exe, dll, cmd, pl, asp, inc, shtm, shtml, txt, gif, jpg, html)                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
for /f "delims=" %%a in (website-physicalpath.txt) do (
	echo [Website HomeDir] %%a                                                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo -----------------------------------------------------                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	call cd /d %%a
	cd >nul
	cacls *.exe /t | find /i "everyone"                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	cacls *.dll /t | find /i "everyone"                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	cacls *.cmd /t | find /i "everyone"                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	cacls *.pl /t | find /i "everyone"                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	cacls *.asp /t | find /i "everyone"                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	cacls *.inc /t | find /i "everyone"                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	cacls *.shtm /t | find /i "everyone"                                                     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	cacls *.shtml /t | find /i "everyone"                                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	cacls *.txt /t | find /i "everyone"                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	cacls *.gif /t | find /i "everyone"                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	cacls *.jpg /t | find /i "everyone"                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	cacls *.html /t | find /i "everyone"                                                     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	cd /d %~dp0
	echo.                                                                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo ※ 결과 값이 존재하지 않으면 양호                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

:2-14-end
echo W-20 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-21 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-21
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ###################         IIS 미사용 스크립트 매핑 제거        ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준 : 아래와 같은 취약한 매핑이 존재하지 않을 경우 양호                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : (.htr .idc .stm .shtm .shtml .printer .htw .ida .idq)                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
if exist iis-enable.txt (
	echo ☞ IIS Service Enable                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-15-enable
) else (
	echo ☞ IIS Service Disable                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-15-end
)

:2-15-enable
echo [등록 사이트]                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo -----------------------------------------------------                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: iis ver >= 7
if %iis_ver_major% geq 7 (
	type website-list.txt                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: iis ver <= 6
if %iis_ver_major% leq 6 (
	type website-name.txt                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

:: iis ver >= 7
if %iis_ver_major% geq 7 (
	echo [미사용 스크립트 매핑 확인]                                                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo -----------------------------------------------------                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	%systemroot%\System32\inetsrv\appcmd list config | find /i "scriptprocessor" | findstr /i ".htr .idc .stm .shtm .shtml .printer .htw .ida .idq" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo ※ 결과 값이 존재하지 않으면 양호                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)

:: iis ver <= 6
if %iis_ver_major% leq 6 (
	echo [기본 설정]                                                                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo -----------------------------------------------------                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	cscript %script%\adsutil.vbs enum W3SVC | findstr /i ".htr .idc .stm .shtm .shtml .printer .htw .ida .idq" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo ※ 결과 값이 존재하지 않으면 양호                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo *** 사이트별 설정 확인                                                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	for /f "tokens=1 delims=[]" %%i in (website-list.txt) do (
		echo [WebSite AppRoot] %%i                                                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo -----------------------------------------------------------------------        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		cscript %script%\adsutil.vbs enum %%i/root | findstr /i ".htr .idc .stm .shtm .shtml .printer .htw .ida .idq" > nul
		if not errorlevel 1 (
			cscript %script%\adsutil.vbs enum %%i/root | findstr /i ".htr .idc .stm .shtm .shtml .printer .htw .ida .idq" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
			echo.                                                                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		) else (
			cscript %script%\adsutil.vbs enum %%i/root | find /i "ScriptMaps" > nul
			if not errorlevel 1 (
				echo * 취약한 맵핑이 등록되어 있지 않음. [양호]                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
				echo.                                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
			) else (
				echo * 기본 설정이 적용되어 있음.                                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
				echo.                                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
			)
		)
	)
)

:2-15-end
echo W-21 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-22 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-22
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ###################         IIS Exec 명령어 쉘 호출 진단         ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준 : 해당 서비스의 레지스트리 값이 0일 경우 양호                                     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : (참고1) IIS 5.0 버전에서 해당 레지스트리 값이 없을 경우 양호                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : (참고2) IIS 6.0 이상 양호                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
if exist iis-enable.txt (
	echo ☞ IIS Service Enable                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-16-enable
) else (
	echo ☞ IIS Service Disable                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-16-end
)

:2-16-enable
:: iis ver >= 6
if %iis_ver_major% geq 6 (
	echo ☞ IIS 6.0 이상 양호			                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)

:: iis ver < 6
if %iis_ver_major% lss 6 (
	echo [Registry 설정] 			                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo -----------------------------------------------------                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	reg query "HKLM\SYSTEM\CurrentControlSet\Services\W3SVC\Parameters" | find /I "SSIEnableCmdDirective" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)

:2-16-end
echo W-22 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-23 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-23
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ###################              IIS WebDAV 비활성화              ##################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준 : 다음 중 한 가지라도 해당되는 경우 양호                                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : 1. IIS 를 사용하지 않을 경우                                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : 2. DisableWebDAV 값이 1로 설정되어 있을경우                                     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : 3. Windows NT, 2000은 서비스팩 4 이상이 설치되어 있을 경우                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : 4. Windows 2003은 WebDAV 가 금지 되어 있을 경우                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : 5. Windows 2008은 해당 취약점에 영향을 받지 않으므로 양호                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 참고 : "0,C:\WINDOWS\system32\inetsrv\httpext.dll,0,WEBDAV,WebDAV" (WebDAV 금지-양호) >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : "1,C:\WINDOWS\system32\inetsrv\httpext.dll,0,WEBDAV,WebDAV" (WebDAV 허용-취약) >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
if exist iis-enable.txt (
	echo ☞ IIS Service Enable                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-17-enable
) else (
	echo ☞ IIS Service Disable                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-17-end
)

:2-17-enable
:: iis ver = 6
if %iis_ver_major% equ 6 (
	echo [WebDAV 동작 확인]                                                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo -----------------------------------------------------                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	%script%\adsutil.vbs enum W3SVC | find /i "webdav" | find /v "WebDAV;WEBDAV"            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)

echo [참고 - Registry 설정(DisableWebDAV)]                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo -----------------------------------------------------                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\SYSTEM\CurrentControlSet\Services\W3SVC\Parameters\registry" | find /I "DisableWebDAV" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\SYSTEM\CurrentControlSet\Services\W3SVC\Parameters" | find /I "DisableWebDAV"  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ※ 결과 값이 존재하지 않을 경우 다른 참고정보 검토                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo [참고 - OS Version, Service Pack]                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo -----------------------------------------------------                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: winver = 2000
if %WinVer% equ 1 (
	type systeminfo.txt | find /i "kernel version"                                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	type systeminfo.txt | find /i "service pack"                                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)

:: winver >= 2003
if %WinVer% geq 2 (
	type systeminfo.txt | find /i "os name"                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	type systeminfo.txt | find /i "os version" | find /i /v "bios"                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

:2-17-end
echo W-23 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-24 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-24
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################         NetBIOS 바인딩 서비스 구동 점검       ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: TCP/IP와 NetBIOS 간의 바인딩이 제거 되어있는 경우 양호                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (NetBIOS 사용 안함 설정: NetbiosOptions 0x2 양호)                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (NetBIOS 사용 설정: NetbiosOptions 0x1 취약)                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (기본 값: NetbiosOptions 0x0 양호)                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (수동점검 방법) 인터넷 프로토콜(TCP/IP)의 등록정보 ▶ 고급 ▶ Wins 탭의 TCP/IP에서 NetBIOS 사용 안함 (139포트차단) >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: winver = 2000
if %WinVer% equ 1 (
	reg query "HKLM\SYSTEM\CurrentControlSet\Services\NetBT\Parameters\Interfaces" | findstr /iv "listing" > 2-18-netbios-list.txt
	for /f "tokens=1 delims=[" %%a in (2-18-netbios-list.txt) do echo %%a >> 2-18-netbios-list-1.txt
	for /f "tokens=1 delims=]" %%a in (2-18-netbios-list-1.txt) do echo %%a >> 2-18-netbios-list-2.txt
	FOR /F %%a IN (2-18-netbios-list-2.txt) do echo HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NetBT\Parameters\Interfaces\%%a\NetbiosOptions >> 2-18-netbios-query.txt
	FOR /F %%a IN (2-18-netbios-query.txt) do %script%\reg query %%a >> 2-18-netbios-result.txt
	echo [NetBIOS over TCP/IP 설정 현황]                                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo -----------------------------------------------------                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	TYPE 2-18-netbios-result.txt	                            							>> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: winver >= 2003
if %WinVer% geq 2 (
	reg query "HKLM\SYSTEM\CurrentControlSet\Services\NetBT\Parameters\Interfaces" /s | findstr . >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt 2>nul
)
echo.                                                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-24 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-25 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-25
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo #########################        FTP 서비스 구동 점검          ######################## >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준 : FTP 서비스를 사용하지 않는 경우 양호 (이용 목적은 담당자인터뷰)                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net start | find /i "ftp" > nul
if not errorlevel 1 (
	echo ☞ FTP Service Enable                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	net start | findstr /i "ftp"                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo FTP Enable                                                                         > ftp-enable.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-19-enable
) else (
	echo ☞ FTP Service Disable                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-19-end
)

:2-19-enable
:: FTP Version 구별하기
net start | find /i "FTP Publishing Service" > nul
if not errorlevel 1 (
	set iis_ftp_ver_major=6
) else (
	net start | find /i "Microsoft FTP Service" > nul
	if not errorlevel 1 (
		set iis_ftp_ver_major=7
	) else (
		echo ☞ 윈도우 기본 FTP외 타 FTP 서비스 사용중 (수동확인)                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	)
)

:: FTP Site List 구하기 ( ftpsite-list.txt )
:: iis ver >= 7
if %iis_ftp_ver_major% geq 7 (
	%systemroot%\System32\inetsrv\appcmd list site | find /i "ftp"                           > ftpsite-list.txt
)
:: iis ver <= 6
if %iis_ftp_ver_major% leq 6 (
	cscript %script%\adsutil.vbs enum MSFTPSVC | find /i "MSFTPSVC" | findstr /i /v "FILTERS APPPOOLS INFO" > ftpsite-list.txt
)

:: FTP Site Name 구하기 ( ftpsite-name.txt )
:: iis ver >= 7
if %iis_ftp_ver_major% geq 7 (
	for /f "tokens=1 delims=(" %%a in (ftpsite-list.txt) do (
		for /f "tokens=2-11 delims= " %%b in ("%%a") do (
			echo %%b %%c %%d %%e %%f %%g %%h %%i %%j %%k                                   >> ftpsite-name.txt
		)
	)
)
:: iis ver <= 6
if %iis_ftp_ver_major% leq 6 (
	for /f "tokens=1 delims=[]" %%i in (ftpsite-list.txt) do (
		cscript %script%\adsutil.vbs enum %%i | findstr /i "ServerComment ServerState"     >> ftpsite-name.txt
		echo -----------------------------------------------------------------------	   >> ftpsite-name.txt
	)
)

:: FTP Site physicalpath 구하기 ( ftpsite-physicalpath.txt )
:: iis ver >= 7
if %iis_ftp_ver_major% geq 7 (
	%systemroot%\System32\inetsrv\appcmd list config -section:system.applicationHost/sites | find /i "physicalpath" > ftpsite-physicalpath-temp.txt
	for /f "tokens=3 delims= " %%a in (ftpsite-physicalpath-temp.txt) do (
		for /f "tokens=2 delims==" %%b in ("%%a") do echo %%~b >> ftpsite-physicalpath.txt
	)
	del ftpsite-physicalpath-temp.txt 2> nul
)
:: iis ver <= 6
if %iis_ftp_ver_major% leq 6 (
	for /f "tokens=1 delims=[]" %%i in (ftpsite-list.txt) do (
		cscript %script%\adsutil.vbs enum %%i/root | find /i "path" | find /i /v "AspEnableParentPaths" >> ftpsite-physicalpath-temp.txt
	)
	for /f "tokens=4-8 delims= " %%i in (ftpsite-physicalpath-temp.txt) do (
		echo %%i %%j %%k %%l %%m                                                              >> ftpsite-physicalpath.txt
	)
	del ftpsite-physicalpath-temp.txt 2> nul
)

echo [등록 사이트]                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo -----------------------------------------------------                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: iis ver >= 7
if %iis_ftp_ver_major% geq 7 (
	type ftpsite-list.txt                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: iis ver <= 6
if %iis_ftp_ver_major% leq 6 (
	type ftpsite-name.txt                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt


:2-19-end
echo W-25 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-26 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-26
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo #####################        FTP 디렉토리 접근권한 설정          ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준 : FTP 홈 디렉터리 권한이 아래와 같이 설정된 경우 양호				              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : (Everyone 사용자 계정이 제거되어 있으면 양호)                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
if exist ftp-enable.txt (
	echo ☞ FTP Service Enable                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	net start | findstr /i "ftp"                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-20-enable
) else (
	echo ☞ FTP Service Disable                                                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-20-end
)

:2-20-enable
echo.                                                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [등록 사이트]                                                                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo -----------------------------------------------------                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: iis ver >= 7
if %iis_ftp_ver_major% geq 7 (
	type ftpsite-list.txt                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: iis ver <= 6
if %iis_ftp_ver_major% leq 6 (
	type ftpsite-name.txt                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

:: iis ver >= 7
if %iis_ftp_ver_major% geq 7 (
	echo [홈디렉토리 정보 - WEB/FTP 구분용]                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo -----------------------------------------------------                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	%systemroot%\System32\inetsrv\appcmd list config -section:system.applicationHost/sites | findstr /i "name protocol physicalpath" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)

echo.                                                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo *** 사이트별 홈디렉토리 접근권한 확인                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
for /f "delims=" %%a in (ftpsite-physicalpath.txt) do (
	echo [FtpSite HomeDir] %%a                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo -----------------------------------------------------                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	call cacls %%a                                                                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

:2-20-end
echo W-26 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-27 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-27
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ###########################         Anonymous FTP 금지          ####################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준 : FTP를 사용하지 않거나 "익명 연결 허용"이 체크되어 있지 않은 경우 양호          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 참고 : metabase.xml 파일 기준 설명        											 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : IIsFtpService	Location ="/LM/MSFTPSVC" 는 FTP 사이트 기본 설정                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : FTP 사이트를 새로 생성 시 해당 기본 설정을 적용 받음.							 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : IIsFtpServer	Location ="/LM/MSFTPSVC/ID"는 FTP 사이트에 등록된 개별 사이트 설정 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : 개별 사이트에 AllowAnonymous 설정이 없으면 FTP 사이트 기본 설정을 적용 받음   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : IIsFtpServer	Location ="/LM/MSFTPSVC/~/Public FTP Site"는 진단 시 고려하지 안함 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
if exist ftp-enable.txt (
	echo ☞ FTP Service Enable                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	net start | findstr /i "ftp"                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-21-enable
) else (
	echo ☞ FTP Service Disable                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-21-end
)

:2-21-enable
echo.                                                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [등록 사이트]                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo -----------------------------------------------------                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: iis ver >= 7
if %iis_ftp_ver_major% geq 7 (
	type ftpsite-list.txt                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: iis ver <= 6
if %iis_ftp_ver_major% leq 6 (
	type ftpsite-name.txt                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

:: iis ver >= 7
if %iis_ftp_ver_major% geq 7 (
	echo [FTP 서버 설정 확인]                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo -----------------------------------------------------                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	%systemroot%\System32\inetsrv\appcmd list config -section:system.applicationHost/sites | findstr /i "name protocol anonymousAuthentication enabled" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: iis ver <= 6
if %iis_ftp_ver_major% leq 6 (
	echo [기본 설정]                                                                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo -----------------------------------------------------                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	cscript %script%\adsutil.vbs enum MSFTPSVC | find /i "AllowAnonymous"                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo *** 사이트별 설정 확인                                                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	for /f "tokens=1 delims=[]" %%i in (ftpsite-list.txt) do (
		echo [FtpSite AppRoot] %%i                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo -----------------------------------------------------                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		cscript %script%\adsutil.vbs enum %%i | find /i "AllowAnonymous" > nul
		if not errorlevel 1 (
			cscript %script%\adsutil.vbs enum %%i | find /i "AllowAnonymous"                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
			echo.                                                                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		) else (
			echo AllowAnonymous : 기본 설정이 적용되어 있음.                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
			echo.                                                                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		)
	)
)

:2-21-end
echo W-27 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-28 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-28
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ###########################        FTP 접근 제어 설정          ######################## >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준 : FTP 서비스에 접근제한 설정이 되어 있는 경우 양호				                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 참고 : metabase.xml 파일 기준 설명        												 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : IIsFtpService	Location ="/LM/MSFTPSVC" 는 FTP 사이트 기본 설정               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : IIsFtpVirtualDir	Location ="/LM/MSFTPSVC/ID/ROOT"는 FTP 개별 사이트 설정      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : 개별 사이트에 IPSecurity 설정이 없으면 FTP 사이트 기본 설정을 적용 받음       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : IPSecurity="" 접근제어 없음, IPSecurity="0102~" 접근제어 설정 있음.           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■      : 마지막에 사이트명이 붙지 않은 설정 내용은 점검시 고려 안함.                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
if exist ftp-enable.txt (
	echo ☞ FTP Service Enable                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	net start | findstr /i "ftp"                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-22-enable
) else (
	echo ☞ FTP Service Disable                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 2-22-end
)

:2-22-enable
echo [등록 사이트]                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo -----------------------------------------------------                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: iis ver >= 7
if %iis_ftp_ver_major% geq 7 (
	type ftpsite-list.txt                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: iis ver <= 6
if %iis_ftp_ver_major% leq 6 (
	type ftpsite-name.txt                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

:: iis ver >= 7
if %iis_ftp_ver_major% geq 7 (
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo *** 사이트별 FTP 접근제어 설정 확인                                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	for /f "delims=" %%a in (ftpsite-name.txt) do (
		%systemroot%\System32\inetsrv\appcmd list config %%a -section:ipsecurity | find /i "ipAddress" > nul
		echo [FTP-Site Name] %%a                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo -----------------------------------------------------                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		if not errorlevel 1 (
			%systemroot%\System32\inetsrv\appcmd list config %%a -section:ipsecurity | find /i "ipAddress" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
			echo.                                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		) else (
			echo * 접근제한 설정 없음                                                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
			echo.                                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		)
	)
)
:: iis ver <= 6
if %iis_ftp_ver_major% leq 6 (
	echo [FTP 접근제어 설정]                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo -----------------------------------------------------                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	cscript %script%\ftp_ipsecurity.vbs >nul
	type ftp-ipsecurity.txt                                                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)

:2-22-end
echo W-28 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-29 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-29
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################             DNS Zone Transfer 설정            ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: DNS 서비스 설정이 아래 기준 중 하나라도 해당되는 경우 양호(SecureSecondaries 2) >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (1) DNS 서비스를 사용하지 않을 경우                                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (2) 영역 전송 허용을 하지 않을 경우                                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (3) 특정 서버로만 영역 전송을 허용하는 경우                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : * 레지스트리값(영역전송 허용안함:3, 아무서버로나:0, 이름서버탭에나열된 서버로만:1, 다음서버로만:2 ) >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : [참고]                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : 결과 값이 없을 경우 DNS 서버에 등록된 정/역방향 조회 영역이 없는 것으로,      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : DNS 서비스를 사용하지 않을 경우 서비스를 중지할 것을 권고                     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net start | find "DNS Server" > NUL
IF NOT ERRORLEVEL 1 (
	ECHO ☞ DNS Service Enable                                                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)	ELSE (
	ECHO ☞ DNS Service Disable                                                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto end
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: winver = 2000
if %WinVer% equ 1 (
	reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\DNS Server\Zones" /s | find "SecureSecondaries" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: winver >= 2003
if %WinVer% geq 2 (
	reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\DNS Server\Zones" /s | findstr . | find /v "Listing of" | find /v "system was unable" >nul
	IF ERRORLEVEL 1 (
		reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\DNS Server\Zones" /s | find "SecureSecondaries" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	) else (
		reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\DNS Server\Zones" /s | find "SecureSecondaries" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	)
)
:end
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-29 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-30 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-30
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################         RDS (Remote Data Services) 제거       ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 다음의 중 한가지라도 해당되는 경우 양호                                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (1) IIS 를 사용하지 않는 경우                                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (2) Windows 2000 일 경우 서비스팩 4, Windows 2003 sp2 이상, Windows 2008이상 양호  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (3) 디폴트 웹사이트에 MSADC 가상 디렉터리가 존재하지 않을 경우                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (4) 해당 레지스트리 값이 존재하지 않을 경우                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: OS Version, Service Pack 버전 체크
echo [OS Version 확인]                                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo -----------------------------------------------------                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt	
:: winver = 2000
if %WinVer% equ 1 (
	ECHO ☞ Win 2000일 경우 서비스팩 4 이상 양호                                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	type systeminfo.txt | find /i "kernel version"                                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	type systeminfo.txt | find /i "service pack"                                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)

:: winver >= 2003
if %WinVer% geq 2 (
	ECHO ☞ Windows 2003 sp2 이상, Windows 2008 이상 양호                                     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	type systeminfo.txt | find /i "os name"                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	type systeminfo.txt | find /i "os version" | find /i /v "bios"                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [IIS 구동 확인]                                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo -----------------------------------------------------   								  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net start | find /i "world wide web publishing" > nul
if not errorlevel 1 (
	echo ☞ IIS Service Enable                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
) else (
	echo ☞ IIS Service Disable                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-30 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-31 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-31
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################               최신 서비스팩 적용              ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 최신 서비스팩이 설치되어 있을 경우 양호                                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (Windows NT 6a, Windows 2000 SP4, Windows 2003 SP2, Windows 2008 SP2)         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
type systeminfo.txt | find /i "kernel version"                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
type systeminfo.txt | find /i "service pack"                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
type systeminfo.txt | find /i "Build"                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-31 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-58 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-58
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################         터미널 서비스 암호화 수준 설정        ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 터미널 서비스를 사용하지 않는 경우 양호                                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : 터미널 서비스를 사용 시 암호화 수준을 "클라이언트와 호환가능(중간)" 이상으로 설정한 경우 양호 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (MinEncryptionLevel	2 이상이면 양호)                                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: winver >= 2008_R2
if %WinVer% geq 4 (
	net start | find /i "Remote Desktop Services" >nul
	IF NOT ERRORLEVEL 1 (
		echo ☞ Remote Desktop Services Enable                                          	>> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo.                                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo ☞ 원격 터미널 서비스 암호화 수준 설정 확인                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo --------------------------------------------------------------------------------- >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		reg query "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" | find /I "MinEncryptionLevel" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		)
	IF ERRORLEVEL 1 (
		echo ☞ Remote Desktop Services Disable                                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		)
) else (
	NET START | FIND "Terminal Service" > NUL
	IF NOT ERRORLEVEL 1 (
		echo ☞ Terminal Service Enable                                          			>> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo.                                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo ☞ 원격 터미널 서비스 암호화 수준 설정 확인                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo --------------------------------------------------------------------------------- >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		reg query "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" | find /I "MinEncryptionLevel" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		)
	IF ERRORLEVEL 1 (
		echo ☞ Terminal Service Disable                                             		 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		)
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-58 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-59 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-59
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################             IIS 웹서비스 정보 숨김            ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 등록된 웹 사이트의 [사용자 지정 오류] 탭에서                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : 400, 401, 403, 404, 500 에러에 대해 별도의 페이지가 지정되어 있는 경우 양호   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
::echo ■       : (취약 예문) prefixLanguageFilePath="%SystemDrive%\inetpub\custerr" path="401.htm" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
rem 기본 설정이기 때문에 위 설정은 취약함.
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net start | find "World Wide Web Publishing" > NUL
IF NOT ERRORLEVEL 1 (
	ECHO ☞ IIS Service Enable                                                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 1-45-enable
)	ELSE (
	ECHO ☞ IIS Service Disable                                                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	goto 46
)

:1-45-enable
echo [등록 사이트]                                                                        	>> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo -----------------------------------------------------                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: iis ver >= 7
if %iis_ver_major% geq 7 (
	type website-list.txt                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: iis ver <= 6
if %iis_ver_major% leq 6 (
	type website-name.txt                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [기본 설정]                                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo -----------------------------------------------------                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: iis ver >= 7
if %iis_ver_major% geq 7 (
	%systemroot%\System32\inetsrv\APPCMD list config | findstr "<error"                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)

:: iis ver <= 6
if %iis_ver_major% leq 6 (
cscript %script%\adsutil.vbs enum W3SVC | findstr "400, 401, 403, 404, 500,"                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo *** 사이트별 설정 확인                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: iis ver >= 7
if %iis_ver_major% geq 7 (
	for /f "delims=" %%i in (website-name.txt) do (
			echo [WebSite Name] %%i                                          						>> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
			echo ---------------------------------------------------------------                     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
			%systemroot%\System32\inetsrv\appcmd list config %%i | findstr "<error" 				>> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
			echo.                                                                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	)
)

:: iis ver <= 6
if %iis_ver_major% leq 6 (
	FOR /F "tokens=1 delims=[]" %%i in (website-list.txt) do (
		echo [WebSite AppRoot] %%i                                                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo -----------------------------------------------------------------------               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		cscript %script%\adsutil.vbs enum %%i/root | findstr "400, 401, 403, 404, 500," > nul
		IF NOT ERRORLEVEL 1 (
			cscript %script%\adsutil.vbs enum %%i/root | findstr "400, 401, 403, 404, 500,"          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
			echo.                                                                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		) ELSE (
			echo 기본 설정이 적용되어 있음.                                                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
			echo.                                                                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		)
	)
)

:46
echo W-59 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-60 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-60
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################             SNMP 서비스 구동 점검             ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: SNMP 서비스를 사용하지 않을 시 SNMP 서비스를 중지한 경우 양호                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : SNMP 서비스는 구동되고 있으나 SNMP 설정이 없는 경우 불필요하게 동작되고 있는 것으로 판단됨. >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net start | find "SNMP" > NUL
IF NOT ERRORLEVEL 1 (
	ECHO ☞ SNMP Service Enable                                                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)	ELSE (
	ECHO ☞ SNMP Service Disable                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [SNMP ValidCommunities 설정]                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo --------------------------------------------------------                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\SYSTEM\CurrentControlSet\Services\SNMP\Parameters\ValidCommunities" | findstr . >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [SNMP Trap 설정]                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo --------------------------------------------------------                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\SYSTEM\CurrentControlSet\Services\SNMP\Parameters\TrapConfiguration" /s | findstr . >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-60 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-61 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-61
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################    SNMP 서비스 커뮤니티스트링의 복잡성 설정   ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: SNMP Community 이름이 public, private 이 아닐 경우 양호                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (참고1) REG_DWORD Community String 숫자                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (참고2) 숫자: 2=알림, 4=읽기전용, 8=읽기와 쓰기, 16=읽기와 만들기             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net start | find "SNMP" > NUL
IF NOT ERRORLEVEL 1 (
	ECHO ☞ SNMP Service Enable                                                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)	ELSE (
	ECHO ☞ SNMP Service Disable                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	
)

echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [SNMP ValidCommunities 설정]                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo --------------------------------------------------------                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\SYSTEM\CurrentControlSet\Services\SNMP\Parameters\ValidCommunities" | findstr . >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [SNMP Trap Commnunities 설정]                                                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo --------------------------------------------------------                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\SYSTEM\CurrentControlSet\Services\SNMP\Parameters\TrapConfiguration" /s | findstr . >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-61 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-62 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-62
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################            SNMP Access Control 설정           ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 특정 호스트만 SNMP 패킷을 받을 수 있도록 SNMP Access Control이 설정된 경우 양호 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (PermittedManagers 설정이 있으면 양호)                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (PermittedManagers 설정이 없으면 모든 호스트에서 SNMP 패킷을 받을 수 있어 취약) >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net start | find "SNMP" > NUL
IF NOT ERRORLEVEL 1 (
	ECHO ☞ SNMP Service Enable                                                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)	ELSE (
	ECHO ☞ SNMP Service Disable                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [SNMP ValidCommunities 설정]                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo --------------------------------------------------------                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\SYSTEM\CurrentControlSet\Services\SNMP\Parameters\ValidCommunities" | findstr . >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [SNMP Access Control 설정]                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo --------------------------------------------------------                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\SYSTEM\CurrentControlSet\Services\SNMP\Parameters\PermittedManagers" | findstr . >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-62 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-63 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-63
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################              DNS 서비스 구동 점검             ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: DNS 서비스를 사용 하지 않거나 동적 업데이트 설정이 "없음"으로 설정된 경우 양호  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (AllowUpdate	0 이면 양호)                                                     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : [참고]                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : 결과 값이 없을 경우 DNS 서버에 등록된 정/역방향 조회 영역이 없는 것으로,      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : DNS 서비스를 사용하지 않을 경우 서비스를 중지할 것을 권고                     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net start | find "DNS Server" > NUL
IF NOT ERRORLEVEL 1 (
	ECHO ☞ DNS Service Enable                                                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)	ELSE (
	ECHO ☞ DNS Service Disable                                                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: winver = 2000
if %WinVer% equ 1 (
	reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\DNS Server\Zones" /s | findstr "AllowUpdate" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: winver >= 2003
if %WinVer% geq 2 (
	reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\DNS Server\Zones" /s | findstr . | find /v "Listing of" | find /v "system was unable" >nul
	IF ERRORLEVEL 1 (
		reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\DNS Server\Zones" /s | findstr "AllowUpdate" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	) else (
		reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\DNS Server\Zones" /s | findstr "AllowUpdate" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	)
)

echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-63 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-64 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-64
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################             HTTP/FTP/SMTP 배너 차단           ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: HTTP/FTP/SMTP 배너에 시스템 정보가 표시되지 않는 경우 양호                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net start | find "World Wide Web Publishing" > NUL
IF NOT ERRORLEVEL 1 (
echo ---------------------------------HTTP Banner-------------------------------------       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	cscript %script%\http_banner.vbs >nul
	type http_banner.txt								>> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt 2>nul
echo ---------------------------------------------------------------------------------       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	del http_banner.txt 2>nul
)	ELSE (
	ECHO ☞ IIS Service Disable                                                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net start | find /i "ftp" > NUL
IF NOT ERRORLEVEL 1 (
echo -----------------------------------FTP Banner------------------------------------       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	cscript %script%\ftp_banner.vbs >nul
	type ftp_banner.txt								>> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt 2>nul
echo ---------------------------------------------------------------------------------       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	del ftp_banner.txt 2>nul
)	ELSE (
	ECHO ☞ FTP Service Disable                                                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net start | find /i "smtp" > NUL
IF NOT ERRORLEVEL 1 (
echo ---------------------------------SMTP Banner-------------------------------------       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	cscript %script%\smtp_banner.vbs >nul
	type smtp_banner.txt								>> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ---------------------------------------------------------------------------------       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	del smtp_banner.txt 2>nul
)	ELSE (
	ECHO ☞ SMTP Service Disable                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-64 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-65 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-65
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################                Telnet 보안 설정               ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: Telnet 서비스가 구동 되고 있지 않거나, 인증방법이 NTLM 일 경우 양호             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : [참고]                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (SecurityMechanism 2. NTLM)                                            	 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (SecurityMechanism 6. NTLM, Password)                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (SecurityMechanism 4. Password)                                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net start | find "telnet" > NUL
IF NOT ERRORLEVEL 1 (
	ECHO ☞ TELNET Service Enable                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	reg query "HKLM\Software\Microsoft\TelnetServer\1.0" | find /I "SecurityMechanism"            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)	ELSE (
	ECHO ☞ TELNET Service Disable                                                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-65 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt





echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-66 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-66
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ################# 불필요한 ODBC/OLE-DB 데이터 소스와 드라이브 제거 #################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 시스템 DSN 부분의 Data Source를 현재 사용하고 있는 경우 양호                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : 시스템 DSN 부분의 Data Source가 사용하지 않는데 등록되어 있을 경우 취약       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

reg query "HKLM\SOFTWARE\ODBC\ODBC.INI\ODBC Data Sources" | find "REG_SZ" > nul

IF NOT ERRORLEVEL 1 (
	ECHO ☞ 아래와 같은 ODBC 데이터소스 드라이브를 발견하였음.                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)	ELSE (
	ECHO ☞ ODBC 데이터소스 드라이브가 발견되지 않았음.                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\SOFTWARE\ODBC\ODBC.INI" | find /I "ODBC Data Sources"                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-66 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt							



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-67 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-67
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################          원격터미널 접속 타임아웃 설정        ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 원격 터미널을 사용하지 않거나, 사용 시 Session Timeout이 설정되어 있는 경우 양호 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (MaxIdleTime 설정 확인 방법: 60000=1분, 300000=5분)                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: winver >= 2008_R2
if %WinVer% geq 4 (
	net start | find /i "Remote Desktop Services" >nul
	IF NOT ERRORLEVEL 1 (
		echo ☞ Remote Desktop Services Enable                                          	>> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo.                                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo ☞ 원격 터미널 Session Timeout 설정                                                     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo ---------------------------------------------------------------------------------       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services" /s | findstr "MaxIdleTime" > idletime.txt
		type idletime.txt | findstr /v "MaxIdleTime"                                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		)
	IF ERRORLEVEL 1 (
		echo ☞ Remote Desktop Services Disable                                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		)
	type idletime.txt | findstr /v "MaxIdleTime"                                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
) else (
	NET START | FIND "Terminal Service" > NUL
	IF NOT ERRORLEVEL 1 (
		echo ☞ Terminal Service Enable                                          			>> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo.                                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo ☞ 원격 터미널 Session Timeout 설정                                                     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo ---------------------------------------------------------------------------------       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		reg query "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /s | findstr "MaxIdleTime" > idletime.txt
		type idletime.txt | findstr /v "MaxIdleTime"                                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		)
	IF ERRORLEVEL 1 (
		echo ☞ Terminal Service Disable                                             		 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		)
	type idletime.txt | findstr /v "MaxIdleTime"                                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-67 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-68 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-68
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ############### 예약된 작업에 의심스러운 명령이 등록되어 있는지 점검 ################## >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 예약된 작업에 의심스러운 명령이 등록되어 있지 않은 경우 양호                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: winver >= 2003
if %WinVer% geq 2 (
	echo ☞ 예약된 작업 확인                                                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	schtasks | findstr [0-9][0-9][0-9][0-9]      	                                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ☞ at 명령어로 등록한 작업 확인                                                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
at                                                                                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: winver >= 2003
if %WinVer% geq 2 (
	echo [참고] schtasks 전체                                                      				 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	schtasks                 									                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-68 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
::2. 서비스 관리 끝

::3. 패치 관리 시작
echo.
echo [+] 3. Patch management
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##########################        3. 패치 관리       ################################## >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-32 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-32
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################                최신 HOT FIX 적용              ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 최신Hotfix 또는 PMS(Patch Management System) Agent가 설치되어 있을 경우 양호    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
type systeminfo.txt | findstr /i "hotfix kb"                                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-32 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-33 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-33
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################             백신 프로그램 업데이트            ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 바이러스 백신 프로그램의 최신 엔진 업데이트가 설치되어 있는 경우 양호(인터뷰)           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ☞ [Symantec 현재 버전 체크]                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\SOFTWARE\Symantec\Symantec Endpoint Protection\CurrentVersion" | find /I "Public-Opstate"      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: V3 버전 체크 항목 추가 시작_221109
echo -------------------------------------------------------------------                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ☞ [Ahnlab V3 Internet Security 현재 버전 체크]                                                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\SOFTWARE\Ahnlab\ASPack\9.0" | find /I "ProductName"      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\SOFTWARE\Ahnlab\ASPack\9.0" | find /I "Version"      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: V3 버전 체크 항목 추가 끝_221109

echo W-33 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-69 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-69
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################          정책에 따른 시스템 로깅 설정         ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 이벤트 감사 설정이 아래와 같이 설정되어 있는 경우 양호                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (1) 로그온 이벤트, 계정 로그온 이벤트, 정책 변경 : 성공/실패 감사             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (2) 계정 관리, 디렉터리 서비스 액세스, 권한 사용 : 실패 감사 					                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (3) 0 : 감사 안함, 2 : 실패 감사, 3 : 성공/실패 감사 					                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
secedit /export /cfg %userprofile%\Desktop\logauditpol.txt
type logauditpol.txt | findstr /I "^Audit"			                                     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-69 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
::3. 패치 관리 끝

::4. 로그 관리 시작
echo.
echo [+] 4. Log management
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##########################        4. 로그 관리       ################################## >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-34 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-34
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################           로그의 정기적 검토 및 보고          ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 로그기록에 대해 정기적 검토, 분석, 리포트 작성 및 보고 등의 조치가 이루어지는 경우 양호 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ☞ 수동 점검 (담당자 인터뷰 수행)                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-34 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-35 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-35
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################   원격으로 액세스할 수 있는 레지스트리 경로   ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: Remote Registry Service 가 중지되어 있을 경우 양호                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net start | find "Remote Registry" > NUL
IF NOT ERRORLEVEL 1 (
	ECHO ☞ Remote Registry Service Enable                                                     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)	ELSE (
	ECHO ☞ Remote Registry Service Disable                                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net start | find "Remote Registry"                                                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-35 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-70 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-70
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################              이벤트 로그 관리 설정            ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 최대 로그 크기 10240KB (10MB) 이상이고, Retention 7776000(90일) 이상이면 양호   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : "90일 이후 이벤트 덮어씀"으로 설정되어 있을 경우 양호                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (MaxSize 10485760 이상, Retention 7776000 이상)                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : Retention 0       = 필요한 경우 이벤트 덮어쓰기                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : Retention 7776000 = 다음보다 오래된 이벤트 덮어쓰기 (7776000 90일)            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : Retention -1      = 이벤트 덮어쓰지 않음(수동으로 로그 지우기)                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [Application Log Size]                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo --------------------------------------------------------                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\Application" | find /I "MaxSize"     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [Security Log Size]                                                                     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo --------------------------------------------------------                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\Security" | find /I "MaxSize"        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [System Log Size]                                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo --------------------------------------------------------                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\System" | find /I "MaxSize"          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [Application log Retention]                                                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo --------------------------------------------------------                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\Application" | find /I "Retention"   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [Security log Retention]                                                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo --------------------------------------------------------                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\Security" | find /I "Retention"      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [System log Retention]                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo --------------------------------------------------------                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\SYSTEM\CurrentControlSet\Services\Eventlog\System" | find /I "Retention"        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-70 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-71 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-71
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################      원격에서 이벤트 로그 파일 접근 차단      ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 로그 디렉터리의 권한에 Everyone 이 없는 경우 양호                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (1) 시스템 로그 디렉터리: %systemroot%\system32\config                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (2) IIS 로그 디렉터리: %systemroot%\system32\LogFiles                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
cacls %systemroot%\system32\logfiles                                                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
cacls %systemroot%\system32\config                                                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-71 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
::4. 로그 관리 끝

::5. 보안 관리 시작
echo.
echo [+] 5. Security management
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##########################        5. 보안 관리       ################################## >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-36 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-36
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################               백신 프로그램 설치              ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 바이러스 백신 프로그램이 설치되어 있는 경우 양호   (Symantec)                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ☞ [Symantec 체크]                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ☞ Tasklist(프로세스 리스트)                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
type tasklist.txt | findstr /i "ccSvcHst.exe" >nul
	if errorlevel 1 (
		echo  백신 프로세스 없음(타 백신 설치여부 수동 확인 또는 인터뷰				 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	) else (
		type tasklist.txt | findstr /i "ccSvcHst.exe"				                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ☞ Service list(서비스 리스트)                                                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net start | findstr /i "Symantec Endpoint Protection" >nul
	if errorlevel 1 (
		echo  백신 서비스 없음(타 백신 설치여부 수동 확인 또는 인터뷰				 	 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	) else (
		net start | findstr /i "Symantec"                                               	 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt	
echo -------------------------------------------------------------------                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: V3 서비스 체크 항목 추가 시작_221109
echo ☞ [Ahnlab V3 Internet Security 체크]                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ☞ Tasklist(프로세스 리스트)                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
type tasklist.txt | findstr /i "V3UI.exe" >nul
	if errorlevel 1 (
		echo  백신 프로세스 없음(타 백신 설치여부 수동 확인 또는 인터뷰				 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	) else (
		type tasklist.txt | findstr /i "V3UI.exe"				                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ☞ Service list(서비스 리스트)                                                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net start | findstr /i "Ahnlab V3" >nul
	if errorlevel 1 (
		echo  백신 서비스 없음(타 백신 설치여부 수동 확인 또는 인터뷰				 	 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	) else (
		net start | findstr /i "Ahnlab V3"                                               	 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: V3 서비스 체크 항목 추가 끝_221109
echo W-36 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-37 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-37
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################            SAM 파일 접근 통제 설정            ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: SAM 파일 접근권한에 Administrator, System 그룹만 모든권한으로 등록된 경우 양호  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
cacls %systemroot%\system32\config\SAM							                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-37 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-38 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-38
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################                화면보호기 설정                ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 화면 보호기를 설정하고, 암호를 사용하며, 대기 시간이 5분일 경우 양호            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 참고: 레지스트리 값이 없을 경우 AD 또는 OS설치 후 설정을 하지 않은 경우임             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKCU\Control Panel\Desktop" | find /I "ScreenSaveActive"                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKCU\Control Panel\Desktop" | find /I "ScreenSaverIsSecure"                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKCU\Control Panel\Desktop" | find /I "ScreenSaveTimeOut"                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [AD(Active Directory)일 경우 레지값]                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKCU\Software\Policies\Microsoft\Windows\Control Panel\Desktop" | find /I "ScreenSaverIsSecure" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKCU\Software\Policies\Microsoft\Windows\Control Panel\Desktop" | find /I "ScreenSaveTimeOut" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-38 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-39 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-39
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################        로그온하지 않고 시스템 종료 허용       ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: "로그온 하지 않고 시스템 종료 허용"이 "사용안함"으로 설정되어 있는 경우 양호    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (ShutdownWithoutLogon	0 이면 양호)                                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt 
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" | find /I "ShutdownWithoutLogon" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-39 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-40 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-40
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################     원격 시스템에서 시스템 강제 종료 차단     ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: "원격 시스템에서 강제로 시스템 종료" 정책에 "Administrators"만 존재할 경우 양호 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (Administrators = *S-1-5-32-544)                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt 
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
type Local_Security_Policy.txt | Find /I "SeRemoteShutdownPrivilege"                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-40 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-41 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-41
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ################# 보안 감사를 로그할 수 없는 경우 즉시 시스템 종료 #################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: "보안 감사를 로그할 수 없는 경우 즉시 시스템 종료" 정책이 "사용안함"으로 설정되어 있는 경우 양호 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (CrashOnAuditFail = 4,0 이면 양호)                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt 
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
type Local_Security_Policy.txt | Find /I "CrashOnAuditFail"                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-41 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-42 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-42
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################     SAM 계정과 공유의 익명 열거 허용 안 함    ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: "SAM 계정과 공유의 익명 열거 허용 안함" 정책이 "사용"이고,                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : "SAM 계정의 익명 열거 허용 안함" 정책이 "사용"으로 설정되어 있는 경우 양호    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (restrictanonymous	1 이고, RestrictAnonymousSAM	1 이면 양호)                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [SAM 계정과 공유의 익명 열거 허용 안함 설정]                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo --------------------------------------------------------                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\SYSTEM\CurrentControlSet\Control\LSA" | find /I "restrictanonymous"             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [SAM 계정의 익명 열거 허용 안함 설정]                                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo --------------------------------------------------------                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\System\CurrentControlSet\Control\Lsa" | find /I "RestrictAnonymousSAM"	         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-42 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-43 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-43
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################              Autologon 기능 제어              ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: AutoAdminLogon 값이 없거나, AutoAdminLogon 0으로 설정되어 있는 경우 양호        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (DefaultPassword 엔트리가 존재한다면 삭제할 것을 권고)                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [AutoAdminLogon (1:Enable, 0:Disable, Default:Disable)]                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo --------------------------------------------------------                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon" | find /I "AutoAdminLogon" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [Username]                                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo --------------------------------------------------------                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon" | find /I "DefaultUserName" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [DefaultPassword]                                                                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo --------------------------------------------------------                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon" | find /I "DefaultPassword" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-43 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-44 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-44
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################       이동식 미디어 포맷 및 꺼내기 허용       ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: "이동식미디어 포맷 및 꺼내기 허용" 정책이 "Administrators"으로 되어 있거나, 결과가 없는 경우 양호 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (결과가 없으면 아무 그룹도 정의되지 않음: Default Administrators만 사용 가능 양호) >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (AllocateDASD=1,"0" 이면 Administrators 양호)                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (AllocateDASD=1,"1" 이면 Administrators 및 Power Users)                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (AllocateDASD=1,"2" 이면 Administrators 및 Interactive Users)                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
type Local_Security_Policy.txt | Find /I "AllocateDASD"                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-44 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-45 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-45
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################             디스크볼륨 암호화 설정            ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: "데이터 보호를 위해 내용을 암호화" 정책이 선택 된 경우 양호                     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: winver = 2000
if %WinVer% equ 1 (
	FOR /F "tokens=1 delims=\" %%a IN ("%cd%") DO (
		echo %%a\ 																			 > inf_using_drv.txt
	)
	echo ☞ current using drive volume														 > inf_Encrypted_file_check.txt
	type inf_using_drv.txt 																	 >> inf_Encrypted_file_check.txt
	FOR /F "tokens=1" %%a IN (inf_using_drv.txt) DO (
		echo.								 												 >> inf_Encrypted_file_check.txt
		echo ☞ Search within the %%a drive...  											 >> inf_Encrypted_file_check.txt
		cipher /s:%%a | find "E "        												 	 >> inf_Encrypted_file_check.txt
		if errorlevel 1 echo Encrypted file is not exist 									 >> inf_Encrypted_file_check.txt
		echo.								 												 >> inf_Encrypted_file_check.txt
	)
	type inf_Encrypted_file_check.txt 														 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: winver = 2003
if %WinVer% equ 2 (
	echo ☞ Current using drive volume 														 > inf_Encrypted_file_check.txt
	type inf_using_drv.txt 																	 >> inf_Encrypted_file_check.txt

	FOR /F "tokens=1" %%a IN (inf_using_drv.txt) DO (
		echo.								 												 >> inf_Encrypted_file_check.txt
		echo ☞ Search within the %%a drive...  											 >> inf_Encrypted_file_check.txt
		cipher /s:%%a | find "E " | findstr "^E"											 >> inf_Encrypted_file_check.txt
		if errorlevel 1 echo Encrypted file is not exist 									 >> inf_Encrypted_file_check.txt
		echo.								 												 >> inf_Encrypted_file_check.txt
	)
	type inf_Encrypted_file_check.txt 														 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: winver <= 2008
if %WinVer% geq 3 (
	echo ☞ win 2008 이상 해당사항 없음 													 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-45 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-72 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-72
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################          Dos공격 방어 레지스트리 설정         ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: Dos 공격에 대한 방어 레지스트리가 설정되어 있는 경우 양호                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (1) SynAttackProtect = REG_DWORD 0 ▶ 1 로 변경 시 양호                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (2) EnableDeadGWDetect = REG_DWORD 1(True) ▶ 0 으로 변경 시 양호             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (3) KeepAliveTime = REG_DWORD 7,200,000(2시간) ▶ 300,000(5분)으로 변경 시 양호 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (4) NoNameReleaseOnDemand = REG_DWORD 0(False) ▶ 1 로 변경 시 양호           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: winver >= 2008
if %WinVer% geq 3 (
	echo ☞ win 2008 이상 해당사항 없음                             			 				>> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
) else (
	echo [SynAttackProtect 설정]                                                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo --------------------------------------------------------                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	reg query "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters" | find /I "SynAttackProtect" /s >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo [EnableDeadGWDetect 설정]                                                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo --------------------------------------------------------                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	reg query "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters" | find /I "EnableDeadGWDetect" /s >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo [KeepAliveTime 설정]                                                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo --------------------------------------------------------                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	reg query "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters" | find /I "KeepAliveTime" /s >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo [NoNameReleaseOnDemand 설정]                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	echo --------------------------------------------------------                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	reg query "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters" | find /I "NoNameReleaseOnDemand" /s >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-72 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-73 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-73
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################  사용자가 프린터 드라이버를 설치할 수 없게 함 ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: "사용자가 프린터 드라이버를 설치할 수 없게 함" 정책이 "사용"으로 설정된 경우 양호 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (AddPrinterDrivers=4,1 이면 양호)                                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
type Local_Security_Policy.txt | Find /I "AddPrinterDrivers"                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-73 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-74 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-74
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################   세션 연결을 중단하기 전에 필요한 유휴시간   ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: "로그온 시간이 만료되면 클라이언트 연결 끊기" 정책을 "사용"으로 설정하고,       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : "세션 연결을 중단하기 전에 필요한 유휴 시간" 정책이 "15분"으로 설정된 경우 양호 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (EnableForcedLogOff	1 이고, AutoDisconnect	15 이면 양호)                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\System\CurrentControlSet\Services\LanManServer\Parameters" | find /I "EnableForcedLogOff" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\System\CurrentControlSet\Services\LanManServer\Parameters" | find /I "AutoDisconnect" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-74 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-75 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-75
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################                경고 메시지 설정               ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 시스템의 불법적인 사용에 대한 경고 메시지/제목이 설정되어 있는 경우 양호        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" | find /I "LegalNoticeCaption" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" | find /I "LegalNoticeText" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [Win 2000이상]                                                            				>> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\policies\system" | find /I "legalnoticecaption" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
reg query "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\policies\system" | find /I "legalnoticetext" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-75 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-76 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-76
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################         사용자별 홈 디렉터리 권한 설정        ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 사용자 계정별 홈 디렉터리에 Eveyone 권한이 없을 경우 양호                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo. > home-directory.txt
dir "C:\Users\*" | find "<DIR>" | findstr /V "All Defalt ."                                  >> home-directory.txt
FOR /F "tokens=5" %%i IN (home-directory.txt) DO cacls "C:\Users\%%i" | find /I "Everyone" > nul
IF ERRORLEVEL 1 (
echo ☞ Everyone 권한이 할당된 홈디렉터리가 발견되지 않았음.                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
) ELSE (
	FOR /F "tokens=5" %%i IN (home-directory.txt) DO cacls "C:\Users\%%i" | find /I "Everyone" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-76 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-77 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-77
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################              LAN Manager 인증 수준            ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: "LAN Manager 인증 수준" 정책에 "NTLMv2 응답만 보냄"으로 설정되어 있는 경우 양호 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 참고  : (LM NTML 응답 보냄: LmCompatibilityLevel=4,0)                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (LM NTML NTLMv2세션 보안 사용(협상된 경우): LmCompatibilityLevel=4,1)         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (NTLM 응답 보냄: LmCompatibilityLevel=4,2)                                    >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (NTLMv2 응답만 보냄: LmCompatibilityLevel=4,3)                                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (NTLMv2 응답만 보냄WLM거부: LmCompatibilityLevel=4,4)                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (NTLMv2 응답만 보냄WLM거부 NTLM 거부: LmCompatibilityLevel=4,5)               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : 값이 없을 경우 아무것도 설정이 안 된 상태임                                   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 주의: 해당 설정을 수정하면 클라이언트나 서비스 또는 응용 프로그램과의 호환성에 영향을 미칠 수 있음. >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
type Local_Security_Policy.txt | Find /I "LmCompatibilityLevel"           					 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-77 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-78 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-78
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################   보안 채널 데이터 디지털 암호화 또는 서명    ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 아래 3가지 정책이 "사용" 으로 되어 있을 경우 양호                               >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 참고: (1) 도메인 구성원: 보안 채널 데이터를 디지털 암호화 또는 서명(항상)           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■     : (2) 도메인 구성원: 보안 채널 데이터를 디지털 암호화(가능한 경우)              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■     : (3) 도메인 구성원: 보안 채널 데이터를 디지털 서명(가능한 경우)                >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■     : (4,1)사용, (4,0)사용 안 함                							  		 	>> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
type Local_Security_Policy.txt | Findstr /I "RequireSignOrSeal SealSecureChannel SignSecureChannel" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-78 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-79 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-79
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################             파일 및 디렉토리 보호             ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 파일시스템이 보안 기능을 제공 해주는 NTFS일 경우 양호                           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
fsutil fsinfo volumeinfo c:\							                                     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [참고]                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo C: 드라이브 권한 확인(NTFS일 경우 계정별 권한 부여 설정이 출력됨)                       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
cacls c:\ 																					 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-79 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-80 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-80
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################        컴퓨터 계정 암호 최대 사용 기간        ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: "컴퓨터 계정 암호 변경 사용 안함" 정책 "사용안함"으로 설정 되어 있고,           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : "컴퓨터 계정 암호 최대 사용 기간" 정책이 "90일"로 설정되어 있는 경우 양호     >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (DisablePasswordChange=4,0 이고, MaximumPasswordAge=4,90 이면 양호)           >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: winver = 2000
if %WinVer% equ 1 (
	echo Win 2000 해당사항 없음                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: winver >= 2003
if %WinVer% geq 2 (
	type Local_Security_Policy.txt | Findstr /I "\MaximumPasswordAge disablepasswordchange"      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-80 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-81 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-81
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################             시작프로그램 목록 분석            ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: 시작 프로그램에서 불필요한 서비스가 등록되어 있지 않고, 주기적으로 점검하는 경우 양호 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (담당자 인터뷰 및 시작 프로그램 점검관련 보고서 확인)                         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ☞ 시작 프로그램 확인(HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run)  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ---------------------------------------------------------------------------------       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: winver = 2000
if %WinVer% equ 1 (
	reg query "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion" | find /I "Run"         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: winver >= 2003
if %WinVer% geq 2 (
	reg query "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run" | findstr . | find /v "Listing of" | find /v "system was unable" >nul
	IF ERRORLEVEL 1 (
		reg query "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	) else (
		reg query "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion" | find /I "Run" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	)
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ☞ 시작 프로그램 확인(HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run) >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ---------------------------------------------------------------------------------       >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: winver = 2000
if %WinVer% equ 1 (
	reg query "HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion" | find /I "Run"        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: winver >= 2003
if %WinVer% geq 2 (
	reg query "HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run" | findstr . | find /v "Listing of" | find /v "system was unable" >nul
	IF ERRORLEVEL 1 (
		reg query "HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	) else (
		reg query "HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion" | find /I "Run" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	)
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-81 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
::5. 보안 관리 끝

::6. DB 관리 시작
echo.
echo [+] 6. DB management
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ############################        6. DB 관리       ################################## >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt



echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-82 START >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] W-82
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################            Windows 인증 모드 사용             ###################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: Windows 인증 모드로 설정되어 있는 경우 양호 (LoginMode 1 이면 양호)             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (1) LoginMode 1 이면 Windows 인증 모드                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■       : (2) LoginMode 2 이면 SQL Server 및 Windows 인증 모드                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
:: winver = 2000
if %WinVer% equ 1 (
	echo Win 2000 해당사항 없음                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
:: winver >= 2003
if %WinVer% geq 2 (
	net start | find "SQL Server" > NUL
	IF NOT ERRORLEVEL 1 (
		ECHO ☞ SQL Server Enable                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo.                                                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft SQL Server" /s | find "LoginMode" >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo.                                                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	)	ELSE (
		ECHO ☞ SQL Server Disable                                                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
		echo.                                                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
	)
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo W-82 END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
::6. DB 관리 끝


secedit /EXPORT /CFG Local_Security_Policy.txt >nul

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:::::::::::::::::::::::::::::::::::::::::::::::: 공통 부분 시작2::::::::::::::::::::::::::::::::::::::::::
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::


echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo #################################  Port Information  ################################## >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
netstat -an | find /v "TIME_WAIT"                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ############################  Service Daemon Information  ############################# >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net start | find /v "started" | find /v "completed"                                          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
					 
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##########################  Environment Variable Information  ######################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
set											                                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################  metabase.xml  ################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
IF EXIST C:\WINDOWS\system32\inetsrv\MetaBase.xml (
	type C:\WINDOWS\system32\inetsrv\MetaBase.xml                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
) ELSE (
	echo C:\WINDOWS\system32\inetsrv\MetaBase.xml 존재하지 않음.                             	 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
)
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ###############                      계정 정보                     #################### 	 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ****************************  User Accounts List  *****************************         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net user | find /V "successfully"                                                            >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ************************  Group List - net localgroup  ************************         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
net localgroup | find /V "successfully"                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo *****************************  Account Information  ***************************         >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
FOR /F "tokens=1 skip=4" %%j IN ('net user') DO net user %%j                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt 2>nul
FOR /F "tokens=2 skip=4" %%j IN ('net user') DO net user %%j                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt 2>nul
FOR /F "tokens=3 skip=4" %%j IN ('net user') DO net user %%j                                 >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt 2>nul


echo 1.7A START                                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] 1.7A
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################            사용자 계정 DB 파일             ####################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: Administrators, System 그룹만 존재해야 양호          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
cacls C:\Windows\system32\config\SAM                                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo 1.7A END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt


echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo 1.7B START                                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] 1.7B
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################            cmd.exe 파일에 대한 접근 권한             ####################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: Administrators( 각 버전별 추가되는 기본 System계정 추가 )그룹만 존재해야 양호          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [32bit]                                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
cacls C:\Windows\system32\cmd.exe                                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [64bit]                                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
cacls C:\Windows\SysWOW64\cmd.exe                                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo 1.7B END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt


echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo 1.7C START                                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] 1.7C
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################            command.com 파일에 대한 접근 권한             ####################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: Administrators( 각 버전별 추가되는 기본 System계정 추가 )그룹만 존재해야 양호          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
cacls C:\Windows\system32\command.com                                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo 1.7C END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo 1.7D START                                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] 1.7D
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################            PowerShell.exe 파일에 대한 접근 권한             ####################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: Administrators( 각 버전별 추가되는 기본 System계정 추가 )그룹만 존재해야 양호          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [32bit]                                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
cacls C:\Windows\system32\WindowsPowerShell\v1.0\powershell.exe                                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [64bit]                                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
cacls C:\Windows\SysWOW64\WindowsPowerShell\v1.0\powershell.exe
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo 1.7D END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo 1.7E START                                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [+] 1.7E
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ##################            PowerShell.exe 로 실행 가능한 파일에 대한 제한 설정             ####################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ####################################################################################### >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 기준: Restricted 또는 RemoteSigned 확인          >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■ 현황                                                                                  >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [powershell]                                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
powershell.exe -Command Get-ExecutionPolicy                                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo [-List]                                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
powershell.exe -Command Get-ExecutionPolicy -List                                             >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo 1.7E END >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt

echo.>> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.>> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo END_RESULT                                                                              >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
del account.txt 2>nul
del account_temp1.txt 2>nul
del account_temp2.txt 2>nul
del admin-account.txt 2>nul
del service.txt 2>nul
del idletime.txt 2>nul
del home-directory.txt 2>nul
del home-directory-acl.txt 2>nul
del Local_Security_Policy.txt 2>nul
del net-accounts.txt 2>nul
del reg-website-list.txt 2>nul
del systeminfo.txt 2>nul
del systeminfo_ko.txt 2>nul
del tasklist.txt 2>nul
del real_ver.txt 2>nul
del inf_share_folder.txt 2>nul
del inf_share_folder_temp.txt 2>nul
del inf_share_folder_temp_sed.txt 2>nul
del inf_share_folder_temp_sed2.txt 2>nul
del inf_Encrypted_file_check.txt 2>nul
del logauditpol.txt 2>nul

rem Netbios 관련
del 2-18-netbios-list-1.txt 2> nul
del 2-18-netbios-list-2.txt 2> nul
del 2-18-netbios-list.txt 2> nul
del 2-18-netbios-query.txt 2> nul
del 2-18-netbios-result.txt 2> nul


rem DB 관리 관련
del unnecessary-user.txt 2>nul
del password-null.txt 2>nul


rem IIS 관련 del
del iis-enable.txt 2>nul
del iis-version.txt 2>nul
del website-list.txt 2>nul
del website-name.txt 2>nul
del website-physicalpath.txt 2>nul
del sample-app.txt 2>nul


rem FTP 관련 del
del ftp-enable.txt 2>nul
del ftpsite-list.txt 2>nul
del ftpsite-name.txt 2>nul
del ftpsite-physicalpath.txt 2>nul
del ftp-ipsecurity.txt 2>nul


rem 파일 드라이브 경로 관련 del
del inf_using_drv_temp3.txt 2>nul
del inf_using_drv_temp2.txt 2>nul
del inf_using_drv_temp1.txt 2>nul
del inf_using_drv.txt 2>nul


secedit /EXPORT /CFG Local_Security_Policy.txt >nul


echo.                                                                                        >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■   END Time  ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
date /t                                                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
time /t                                                                                      >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt


echo.
echo ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■■■                                                              ■■■   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■■■       Windows %WinVer_name% Security Check is Finished       ■■■   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■■■                                                              ■■■   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■   >> %~dp0%COMPUTERNAME%-%WinVer_name%-result.txt
echo.
echo [+] Windows Security Check is Finished


::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:::::::::::::::::::::::::::::::::::::::::::::::: 공통 부분 끝2::::::::::::::::::::::::::::::::::::::::::::
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

